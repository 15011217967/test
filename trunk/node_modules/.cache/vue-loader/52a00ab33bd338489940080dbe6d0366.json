{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\uploadImg\\el_upload_img.vue?vue&type=style&index=0&id=1f5cc7f0&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\uploadImg\\el_upload_img.vue","mtime":1573608893391},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\css-loader\\index.js","mtime":1558492728478},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1558492728890},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\postcss-loader\\src\\index.js","mtime":1558492728823},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\less-loader\\dist\\cjs.js","mtime":1566193719488},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.hide /deep/ .el-upload--picture-card {\r\n    display: none;\r\n}\r\n.imgdisabled /deep/ .el-upload-list__item-delete {\r\n    display: none !important;\r\n}\r\n",{"version":3,"sources":["el_upload_img.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2LA;AACA;AACA;AACA;AACA;AACA","file":"el_upload_img.vue","sourceRoot":"src/components/uploadImg","sourcesContent":["<template>\r\n  <div>\r\n    <el-upload\r\n      :class=\"{hide:hideUpload,imgdisabled:disabled}\"\r\n      :action=\"imgAction()\"\r\n      :list-type=\"lssListType\"\r\n      accept=\"image/*\"\r\n      :limit=\"LssUpimgLimit\"\r\n      :headers=\"tokenHeaders\"\r\n      :file-list=\"productImgs\"\r\n      :multiple=\"isMultiple\"\r\n      :on-preview=\"handlePictureCardPreview\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleAvatarSuccess\"\r\n      :on-change=\"handleChange\"\r\n      :data=\"uploadData\"\r\n      :before-upload=\"beforeAvatarUpload\"\r\n      :on-exceed=\"handleExceed\"\r\n      :on-error=\"imgUploadError\"\r\n    >\r\n      <el-button v-if=\"lssListType == 'picture'\" :disabled=\"disabled\" size=\"small\" type=\"primary\">上传图片</el-button>\r\n      <i  v-else class=\"el-icon-plus\"></i>\r\n    </el-upload>\r\n     <p class=\"img-tips\">{{imgTxt}}</p>\r\n    <el-dialog :visible.sync=\"dialogImgVisible\"  append-to-body>\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\n/**\r\n * 因时间问题\r\n * 部分功能未从父级传入\r\n * 如有调用 请 梳理并增加默认参数\r\n *\r\n */\r\nimport { getToken } from \"@/utils/auth\";\r\nlet token = getToken(); /// localStorage.getItem('token') // 要保证取到\r\nexport default {\r\n  name: \"el-upload-img\",\r\n  model:{\r\n      prop:\"productImg\",\r\n      event:'parentRef'\r\n  },\r\n  props: {\r\n    productImg:[Array,String],\r\n    disabled:{ //禁用\r\n      default: false,\r\n      type:Boolean\r\n    },\r\n    LssUpimgLimit:{ //图片上传限制  已做 超出隐藏\r\n      default: 1,\r\n      type:[Number,String]\r\n    },\r\n    CatalogName:{  //catalog名称\r\n      default: 'product',\r\n      type: String\r\n    },\r\n    //上传显示样式\r\n    lssListType:{\r\n      default:'picture-card',\r\n      type:String\r\n    },\r\n    // 回显 图片\r\n    EchoDisplayImages:{\r\n      type: Array,\r\n       default() {\r\n      return []\r\n    }\r\n    },\r\n    //图片大小\r\n    ImgSize:{\r\n      default:2,\r\n      type:[Number,String]\r\n    },\r\n    ImgTips:{\r\n      default:'',\r\n      type:String\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      hideUpload: false,\r\n      elImgSize:null,\r\n      //单图上传\r\n      dialogImageUrl: \"\",\r\n      dialogImgVisible: false,\r\n      productImgs: [],\r\n      isMultiple: false,\r\n      imgLimit: 6,\r\n      tokenHeaders:{accessToken: token},\r\n      uploadData:{},\r\n      imgTxt: '',\r\n      //多图上传\r\n      arrMultiple: true //是否支持多选文件\r\n    };\r\n  },\r\n  created() {\r\n  this.init();\r\n   this.productImgs=this.EchoDisplayImages;\r\n   this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\r\n   this.imgTxt = !!this.ImgTips ? this.ImgTips : `只能上传单张图片，大小不超过${this.ImgSize}M`;\r\n\r\n  },\r\n  watch: {\r\n    EchoDisplayImages(){\r\n      this.productImgs = this.EchoDisplayImages;\r\n      this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\r\n    }\r\n  },\r\n  methods: {\r\n    init(){\r\n      this.uploadData = { catalog: this.CatalogName};\r\n      this.elImgSize=Number(this.ImgSize)\r\n    },\r\n    imgAction() {\r\n      return this.api.FN_ALLPATH(this.api.content.picture_upload);\r\n    },\r\n    handlePictureCardPreview(file) {\r\n      //预览图片时调用\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogImgVisible = true;\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      //文件上传之前调用做一些拦截限制\r\n      this.uploadData = { catalog: \"content\", name: \"photo\" };\r\n      let isJPG = true;\r\n      let isLtM = true;\r\n      if(this.elImgSize < 1){\r\n        isLtM = file.size / 1024 < Number(this.elImgSize) * 1000;\r\n      }else{\r\n        isLtM = file.size / 1024 / 1024 < Number(this.elImgSize);\r\n      }\r\n      if (!isLtM) {\r\n        if(this.elImgSize < 1){\r\n          let _size= Number(this.elImgSize) * 1000;\r\n          this.$message.error('上传图片大小不能超过'+_size+'KB!');\r\n        }else{\r\n          this.$message.error('上传图片大小不能超过'+this.elImgSize+'MB!');\r\n        }\r\n      }\r\n      return isJPG && isLtM;\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      //图片上传成功\r\n      //console.log(res.data.imageUrl);\r\n      this.$emit('parentRef',res.data.imageUrl);\r\n      // this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    handleExceed(files, fileList) {\r\n      //图片上传超过数量限制\r\n      this.$message.error(\"只能上传一张!\");\r\n    },\r\n    imgUploadError(err, file, fileList) {\r\n      //图片上传失败调用\r\n      this.$message.error(\"上传图片失败!\");\r\n    },\r\n    /**\r\n     * @Date: 2019-10-24 14:39:10\r\n     * @description: 删除图片  TODO 不能通过服务器删除 因为卡券使用的了默认图片 删除后影响数据\r\n     * @author: elephant\r\n     * @param {file,fileList} \r\n     * @return: \r\n     */\r\n    handleRemove(file, fileList) {\r\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\r\n      //移除图片\r\n      // let fileImgUrl = null;\r\n      // if (file.response) {\r\n      //   fileImgUrl = file.response.data.imageUrl;\r\n      // } else {\r\n      //   fileImgUrl = file.url;\r\n      // }\r\n      // let imgArr = this.productImgs;\r\n      // let index = imgArr.findIndex(item => item.path == fileImgUrl);\r\n      // if(imgArr[index].id != undefined){\r\n      //     this.request(this.api.product.enterpriseArchivalInformation_logicDelete,{id:imgArr[index].id});\r\n      // }\r\n      // imgArr.splice(index, 1);\r\n    },\r\n    handleChange(files, fileList){\r\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.hide /deep/ .el-upload--picture-card {\r\n    display: none;\r\n}\r\n.imgdisabled /deep/ .el-upload-list__item-delete {\r\n    display: none !important;\r\n}\r\n</style>\r\n\r\n"]}]}