{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\orders\\business\\purchase\\arrivalNotice_add.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\orders\\business\\purchase\\arrivalNotice_add.vue","mtime":1572415125096},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport codeSet from \"@/components/codeSet\";\r\nimport treeDept from \"@/components/treeDept\";\r\nimport { constants } from \"crypto\";\r\nexport default {\r\n  components: {\r\n    codeSet,\r\n    treeDept\r\n  },\r\n  data() {\r\n    return {\r\n      //采购订单号标识\r\n      supplierStatus: true,\r\n      //供应商标识\r\n      supplierNameStatus: false,\r\n      //标识门店或仓库(默认仓库)\r\n      selectStore:true,\r\n      signData: {\r\n        //标识是仓库(030101)还是门店(030102)\r\n        orderType:\"\",\r\n        //组织机构\r\n        organization: \"\",\r\n        organizationCode: \"\",\r\n        //供应商\r\n        supplier: \"\",\r\n        //收货类型\r\n        deliveryType: \"\",\r\n        arrivalSn: \"\",\r\n        orderSn: \"\",\r\n        //收货仓库\r\n        warehouseCode: \"\",\r\n        warehouse: \"\",\r\n        //门店\r\n        storeName:'',\r\n        storeId:'',\r\n        //货主\r\n        goodsOwner:'',\r\n        expectTime: \"\",\r\n        //供货商编码\r\n        supplierCode: \"\",\r\n        contractNum: \"\",\r\n        //采购备注\r\n        remarks: \"\",\r\n        //采购单号\r\n        orderSnList: \"\",\r\n        //物流公司名称\r\n        logisticsCompany: \"\",\r\n        //物流编码\r\n        logisticsCompanyCode: \"\",\r\n        //商品数据表\r\n        channelPurchaseArrivalOrderGoodsVOList: []\r\n      },\r\n      rules: {\r\n        supplier: [\r\n          { required: true, message: \"供货商不能为空\", trigger: \"change\" }\r\n        ],\r\n        orderSn: [\r\n          { required: true, message: \"采购单号不能为空\", trigger: \"change\" }\r\n        ],\r\n        organization: [\r\n          { required: true, message: \"组织机构不能为空\", trigger: \"change\" }\r\n        ],\r\n        deliveryType: [\r\n          { required: true, message: \"收货类型不能为空\", trigger: \"change\" }\r\n        ],\r\n        arrivalSn: [\r\n          { required: true, message: \"到货单号不能为空\", trigger: \"change\" }\r\n        ],\r\n        warehouse: [\r\n          { required: true, message: \"仓库不能为空\", trigger: \"change\" }\r\n        ],\r\n        storeName: [\r\n          { required: true, message: \"门店不能为空\", trigger: \"change\" }\r\n        ]\r\n      },\r\n      optionData: [],\r\n      //采购单号数据\r\n      OrderSnListData: [],\r\n      //收货仓库--合格的仓库\r\n      WarehouseCodeData: [],\r\n      //获取物流数据\r\n      logisticsListData: [],\r\n      //获取门店列表数据\r\n      storeListData:[],\r\n      //填写的优惠金额\r\n      price: \"\",\r\n      formInline: {\r\n        user: \"\",\r\n        region: \"\"\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    //得到组织机构数据\r\n    this.getWarehouseListData();\r\n    //获取物流数据\r\n    this.getLogisticsList();\r\n    if (this.$route.query.orderSn) {\r\n      this.supplierNameStatus = true;\r\n      console.log(this.$route.query.orderSn);\r\n      this.getPurchasDetailListMsg(this.$route.query.orderSn);\r\n      return;\r\n    }\r\n  },\r\n  watch: {\r\n    \"signData.deliveryType\":function(newValue){\r\n      switch (newValue) {\r\n        case \"仓库收货\":\r\n          this.signData.orderType=\"030101\",\r\n          this.selectStore=true\r\n          this.signData.storeName=''\r\n          this.signData.warehouse=''\r\n          this.signData.storeId=''\r\n          break;\r\n        case '门店收货':\r\n          this.signData.orderType=\"030102\",\r\n          this.selectStore=false\r\n          this.signData.warehouse=''\r\n          this.signData.storeName=''\r\n          this.signData.warehouseCode=''\r\n          break;\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    //得到组织机构数据\r\n    async getWarehouseListData() {\r\n      let info = await this.request(this.api.user.get_userinfo, {}, true);\r\n      console.log(info);\r\n      //得到部门Id\r\n      this.signData.relationDepId = info.departId;\r\n\r\n      this.request(this.api.user.userCompany_getUserOrgByUserId, {\r\n        userId: info.userId,\r\n        type: 0\r\n      }).then(data => {\r\n        console.log(data);\r\n        // this.organizationListData=data\r\n        //得到机构\r\n        this.signData.organization = data.name;\r\n        //得到机构code\r\n        this.signData.organizationCode = data.id;\r\n        //得到供货商数据\r\n        this.getSupplierListData(this.signData.organizationCode);\r\n        //获取货主列表\r\n        this.getGoodsOwnerListData(this.signData.organizationCode);\r\n        //得到仓库数据\r\n        this.getWarehouseList(this.signData.organizationCode);\r\n        //得到门店列表数据\r\n        this.getStoreBasicListData(this.signData.organizationCode)\r\n      });\r\n    },\r\n    //得到门店列表数据\r\n    getStoreBasicListData(organizationId){\r\n      this.request(this.api.retailStore.storeBasic_listByOrganizationId,{organizationId:organizationId}).then(res=>{\r\n        console.log(res)\r\n        this.storeListData=res\r\n      })\r\n    },\r\n    //获取货主列表\r\n    getGoodsOwnerListData(organizationId) {\r\n      this.request(this.api.system.goodsOwner_list, {\r\n        orgId: organizationId\r\n      }).then(data => {\r\n        console.log(data.data);\r\n        this.signData.goodsOwner = data.data[0].code;\r\n      });\r\n    },\r\n    //得到表格数据\r\n    getPurchasDetailListMsg(orderSn) {\r\n      this.request(this.api.order.channelPurchaseOrder_getByOrderSn, {\r\n        orderSn: orderSn,\r\n        pageIndex:'',\r\n        pageSize:''\r\n      }).then(data => {\r\n        this.signData.supplier = data.supplier;\r\n        this.signData.orderSn = data.orderSn;\r\n        this.signData.supplierCode = data.supplierCode;\r\n        if (data.channelOrderGoodsVOList) {\r\n          data.channelOrderGoodsVOList.data.forEach(item => {\r\n            item.tax = data.tax;\r\n            item.amount = item.num * item.actualAmount;\r\n          });\r\n        }\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = data.channelOrderGoodsVOList.data;\r\n      });\r\n    },\r\n    //获取物流数据\r\n    getLogisticsList() {\r\n      this.request(this.api.order.expressCompany_list, {}).then(data => {\r\n        console.log(data);\r\n        this.logisticsListData = data.data;\r\n      });\r\n    },\r\n    //得到仓库列表\r\n    getWarehouseList(orgId) {\r\n      console.log(orgId);\r\n      this.request(this.api.system.warehouse_list, {\r\n        used: true,\r\n        orgId: orgId\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.WarehouseCodeData = data.data;\r\n      });\r\n    },\r\n    //得到物流编码\r\n    selectLogisticsData(val) {\r\n      var logisticsCode = this.logisticsListData.find(\r\n        item => item.company == val\r\n      ).code;\r\n      this.signData.logisticsCompanyCode = logisticsCode;\r\n    },\r\n    //得到采购单号的数据\r\n    getOrderSnListData(supplierId) {\r\n      this.request(this.api.order.channelPurchaseArrivalOrder_orderSnList, {\r\n        supplierCode: supplierId\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.OrderSnListData = data;\r\n      });\r\n    },\r\n    //得到供货商数据\r\n    getSupplierListData(organizationId) {\r\n      console.log(246);\r\n      this.request(this.api.product.supplier_list, {\r\n        organizationId: organizationId,\r\n        cooperation: true\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.optionData = data.data;\r\n      });\r\n    },\r\n    //采购单号,渲染列表数据\r\n    selectOrderSnListDataChange(val) {\r\n      this.request(this.api.order.channelPurchaseArrivalOrder_goods, {\r\n        orderSn: val\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = data;\r\n      });\r\n    },\r\n    //存储供应商编码\r\n    selectSupplierChange(val) {\r\n      this.signData.orderSn = \"\";\r\n      console.log(val);\r\n      this.supplierStatus = false;\r\n      let suppliceObj = this.optionData.find(item => item.name == val);\r\n      this.signData.supplierCode = suppliceObj.code;\r\n      this.getOrderSnListData(suppliceObj.code);\r\n    },\r\n    //收货仓库\r\n    selectwarehouseCodeChange(val) {\r\n      let warehouseObj = this.WarehouseCodeData.find(item => item.name == val);\r\n      this.signData.warehouseCode = warehouseObj.code;\r\n    },\r\n    //收货门店\r\n    selectStoreNameChange(val){\r\n      let storeId = this.storeListData.find(item => item.name == val).id;\r\n      this.signData.warehouse=this.signData.storeName\r\n      this.signData.warehouseCode = storeId;\r\n    },\r\n    //价格变化事件\r\n    priceInputChangeEvent() {\r\n      console.log(this.price);\r\n    },\r\n    //选择支付方式\r\n    paySelectWay(item) {\r\n      console.log(item);\r\n    },\r\n    //确认按钮的点击事件\r\n    primaryBtnClick() {\r\n      console.log(\"primaryBtnClick\");\r\n      this.signData.channelPurchaseArrivalOrderGoodsVOList.forEach(item => {\r\n        item.quantity = item.num;\r\n        if (!item.actualQuantity) {\r\n          item.actualQuantity = 0;\r\n        }\r\n      });\r\n\r\n      var filterData = this.signData.channelPurchaseArrivalOrderGoodsVOList.filter(item=>{\r\n        return item.currentQuantity && item.currentQuantity!=\"0\"\r\n      })\r\n      if(filterData.length>0){\r\n      }else{\r\n        this.$message.error('到货数量不能全部为0');\r\n        return\r\n      }\r\n      this.$refs.ruleForm.validate(valid => {\r\n        if (valid) {\r\n          switch (this.signData.deliveryType) {\r\n            case \"仓库收货\":\r\n              this.showBoxTipMsg(\"收货仓库：\")\r\n              break;\r\n            case \"门店收货\":\r\n              this.showBoxTipMsg(\"收货门店：\")\r\n              break;\r\n          }\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //弹框提示(仓库或门店)\r\n    showBoxTipMsg(name,fileteData){\r\n      this.$confirm(\r\n        \"确认后，\"+name+this.signData.warehouse+\",将收到采购到货单？\",\r\n        \"确认到货通知\",\r\n        {\r\n          confirmButtonText: \"确定\",\r\n          cancelButtonText: \"取消\",\r\n          type: \"warning\"\r\n        }\r\n      ).then(() => {\r\n        this.saveWarehouseDataOrStoreData()\r\n      }).catch(action=>{\r\n\r\n      })\r\n    },\r\n    //仓库或门店收货接口\r\n    saveWarehouseDataOrStoreData() {\r\n      console.log(\"saveWarehouseDataOrStoreData\")\r\n      this.signData.channelPurchaseArrivalOrderGoodsVOList=this.signData.channelPurchaseArrivalOrderGoodsVOList.filter(item=>{\r\n        return item.currentQuantity && item.currentQuantity!=\"0\"\r\n      })\r\n      // this.signData.channelPurchaseArrivalOrderGoodsVOList.forEach(item => {\r\n      //   item.currentQuantity=item.arrivalQuantity\r\n      // });\r\n      console.log(\"saveWarehouseData\")\r\n      this.request(\r\n        this.api.order.channelPurchaseArrivalOrder_insert,\r\n        this.signData\r\n      ).then(data => {\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = [];\r\n        //此处应该时上传成功后，再删除\r\n        localStorage.removeItem(\"localTableData\");\r\n        this.$router.go(-1);\r\n      });\r\n    },\r\n    //取消按钮的点击事件\r\n    plainBtnClick() {\r\n      this.$router.go(-1);\r\n    },\r\n    //当前商品数量发生改变了\r\n    shopNumberChange(count, row) {\r\n      console.log(\"227===========count\");\r\n      // row.actualQuantity = count;\r\n      // console.log(this.signData.channelPurchaseArrivalOrderGoodsVOList);\r\n    }\r\n  }\r\n};\r\n",{"version":3,"sources":["arrivalNotice_add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"arrivalNotice_add.vue","sourceRoot":"src/views/orders/business/purchase","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"middle\">\r\n      <span>基本信息</span>\r\n      <div class=\"input-div\">\r\n        <el-form\r\n          ref=\"ruleForm\"\r\n          :inline=\"true\"\r\n          :model=\"signData\"\r\n          label-width=\"120px\"\r\n          :rules=\"rules\"\r\n          class=\"demo-ruleForm\"\r\n        >\r\n          <div class=\"data-div\">\r\n            <div>\r\n              <el-form-item label=\"组织机构：\" prop=\"organization\">\r\n                <el-input v-model=\"signData.organization\" disabled></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"采购单号：\" prop=\"orderSn\">\r\n                <el-select\r\n                  :disabled=\"supplierStatus\"\r\n                  @change=\"selectOrderSnListDataChange\"\r\n                  v-model=\"signData.orderSn\"\r\n                  placeholder=\"请选择单号\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"(item,index) in OrderSnListData\"\r\n                    :label=\"item\"\r\n                    :key=\"index\"\r\n                    :value=\"item\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"收货类型：\" prop=\"deliveryType\">\r\n                <el-select v-model=\"signData.deliveryType\" placeholder=\"请选择供应商\">\r\n                  <el-option value=\"仓库收货\"></el-option>\r\n                  <el-option value=\"门店收货\"></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"物流公司：\">\r\n                <el-select\r\n                  v-model=\"signData.logisticsCompany\"\r\n                  @change=\"selectLogisticsData\"\r\n                  placeholder=\"请选择物流公司\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in logisticsListData\"\r\n                    :label=\"item.company\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.company\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"物流单号：\">\r\n                <el-input placeholder=\"请输入内容\" v-model=\"signData.logisticsOrderSn\"></el-input>\r\n              </el-form-item>\r\n            </div>\r\n            <div>\r\n              <el-form-item label=\"供应商：\" prop=\"supplier\">\r\n                <el-select\r\n                  :disabled=\"supplierNameStatus\"\r\n                  @change=\"selectSupplierChange\"\r\n                  v-model=\"signData.supplier\"\r\n                  placeholder=\"请选择供应商\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in optionData\"\r\n                    :label=\"item.name\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.name\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"到货单号：\" prop=\"arrivalSn\">\r\n                <el-input placeholder=\"请输入内容\" v-model=\"signData.arrivalSn\"></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"收货仓库：\" prop=\"warehouse\" v-if=\"selectStore\">\r\n                <el-select\r\n                  @change=\"selectwarehouseCodeChange\"\r\n                  v-model=\"signData.warehouse\"\r\n                  placeholder=\"请选择仓库\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in WarehouseCodeData\"\r\n                    :label=\"item.name\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.name\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <el-form-item label=\"收货门店：\" prop=\"storeName\" v-else>\r\n                <el-select\r\n                  @change=\"selectStoreNameChange\"\r\n                  v-model=\"signData.storeName\"\r\n                  placeholder=\"请选择门店\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in storeListData\"\r\n                    :label=\"item.name\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.name\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"预计到货日期：\" prop>\r\n                <el-date-picker v-model=\"signData.expectTime\" type=\"date\" placeholder=\"选择日期\"></el-date-picker>\r\n              </el-form-item>\r\n            </div>\r\n          </div>\r\n        </el-form>\r\n      </div>\r\n\r\n      <div class=\"table-view\">\r\n        <div class=\"title-div\">\r\n          <span>选择到货商品</span>\r\n          <!-- <span @click=\"selectShopClickEvent\">选择商品</span> -->\r\n        </div>\r\n        <div class=\"table-div\">\r\n          <el-table\r\n            :data=\"signData.channelPurchaseArrivalOrderGoodsVOList\"\r\n            style=\"width: 100%\"\r\n            header-row-class-name=\"item-table-header\"\r\n            max-height=\"400\"\r\n          >\r\n            <el-table-column prop=\"productCode\" label=\"商品款号\" width=\"160\"></el-table-column>\r\n            <el-table-column prop=\"code\" label=\"商品货号\" width=\"150\" align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"image\" label=\"商品图片\" width=\"260\" align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <img :src=\"scope.row.image\" style=\"width:32px;height:32px;\" />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"name\" label=\"商品名称\" width=\"260\" align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"brandName\" label=\"品牌\" width=\"160\" align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"category\" label=\"商品品类\" width=\"260\" align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <span>{{scope.row.category?scope.row.category:'--'}}</span>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"specifications\" label=\"规格属性\" width=\"160\" align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <div class=\"span-btn\">\r\n                  <span>颜色：{{scope.row.color}}</span>\r\n                  <span>尺码：{{scope.row.size}}</span>\r\n                </div>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"num\" label=\"采购总量\" width=\"260\" align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"actualQuantity\" label=\"实收数量\" width=\"160\" align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <span>{{scope.row.actualQuantity?scope.row.actualQuantity:'0'}}</span>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"currentQuantity\" label=\"本次到货数量\" align=\"center\" width=\"150\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input\r\n                  @change=\"shopNumberChange($event,scope.row)\"\r\n                  min=\"0\"\r\n                  max=\"9\"\r\n                  type=\"number\"\r\n                  v-model=\"scope.row.currentQuantity\"\r\n                  placeholder=\"填写数量\"\r\n                  v-enter-number\r\n                ></el-input>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n        </div>\r\n      </div>\r\n      <div class=\"price-msg\">\r\n        <span class=\"other-msg\">其他信息</span>\r\n        <div class=\"remarks-textarea\">\r\n          <span>采购备注：</span>\r\n          <el-input\r\n            class=\"textarea\"\r\n            type=\"textarea\"\r\n            :rows=\"2\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"signData.remarks\"\r\n            resize=\"none\"\r\n          ></el-input>\r\n        </div>\r\n        <div class=\"btn-div\">\r\n          <el-button type=\"primary\" @click=\"primaryBtnClick\" size=\"small\">确认</el-button>\r\n          <el-button plain @click=\"plainBtnClick\" size=\"small\">取消</el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport codeSet from \"@/components/codeSet\";\r\nimport treeDept from \"@/components/treeDept\";\r\nimport { constants } from \"crypto\";\r\nexport default {\r\n  components: {\r\n    codeSet,\r\n    treeDept\r\n  },\r\n  data() {\r\n    return {\r\n      //采购订单号标识\r\n      supplierStatus: true,\r\n      //供应商标识\r\n      supplierNameStatus: false,\r\n      //标识门店或仓库(默认仓库)\r\n      selectStore:true,\r\n      signData: {\r\n        //标识是仓库(030101)还是门店(030102)\r\n        orderType:\"\",\r\n        //组织机构\r\n        organization: \"\",\r\n        organizationCode: \"\",\r\n        //供应商\r\n        supplier: \"\",\r\n        //收货类型\r\n        deliveryType: \"\",\r\n        arrivalSn: \"\",\r\n        orderSn: \"\",\r\n        //收货仓库\r\n        warehouseCode: \"\",\r\n        warehouse: \"\",\r\n        //门店\r\n        storeName:'',\r\n        storeId:'',\r\n        //货主\r\n        goodsOwner:'',\r\n        expectTime: \"\",\r\n        //供货商编码\r\n        supplierCode: \"\",\r\n        contractNum: \"\",\r\n        //采购备注\r\n        remarks: \"\",\r\n        //采购单号\r\n        orderSnList: \"\",\r\n        //物流公司名称\r\n        logisticsCompany: \"\",\r\n        //物流编码\r\n        logisticsCompanyCode: \"\",\r\n        //商品数据表\r\n        channelPurchaseArrivalOrderGoodsVOList: []\r\n      },\r\n      rules: {\r\n        supplier: [\r\n          { required: true, message: \"供货商不能为空\", trigger: \"change\" }\r\n        ],\r\n        orderSn: [\r\n          { required: true, message: \"采购单号不能为空\", trigger: \"change\" }\r\n        ],\r\n        organization: [\r\n          { required: true, message: \"组织机构不能为空\", trigger: \"change\" }\r\n        ],\r\n        deliveryType: [\r\n          { required: true, message: \"收货类型不能为空\", trigger: \"change\" }\r\n        ],\r\n        arrivalSn: [\r\n          { required: true, message: \"到货单号不能为空\", trigger: \"change\" }\r\n        ],\r\n        warehouse: [\r\n          { required: true, message: \"仓库不能为空\", trigger: \"change\" }\r\n        ],\r\n        storeName: [\r\n          { required: true, message: \"门店不能为空\", trigger: \"change\" }\r\n        ]\r\n      },\r\n      optionData: [],\r\n      //采购单号数据\r\n      OrderSnListData: [],\r\n      //收货仓库--合格的仓库\r\n      WarehouseCodeData: [],\r\n      //获取物流数据\r\n      logisticsListData: [],\r\n      //获取门店列表数据\r\n      storeListData:[],\r\n      //填写的优惠金额\r\n      price: \"\",\r\n      formInline: {\r\n        user: \"\",\r\n        region: \"\"\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    //得到组织机构数据\r\n    this.getWarehouseListData();\r\n    //获取物流数据\r\n    this.getLogisticsList();\r\n    if (this.$route.query.orderSn) {\r\n      this.supplierNameStatus = true;\r\n      console.log(this.$route.query.orderSn);\r\n      this.getPurchasDetailListMsg(this.$route.query.orderSn);\r\n      return;\r\n    }\r\n  },\r\n  watch: {\r\n    \"signData.deliveryType\":function(newValue){\r\n      switch (newValue) {\r\n        case \"仓库收货\":\r\n          this.signData.orderType=\"030101\",\r\n          this.selectStore=true\r\n          this.signData.storeName=''\r\n          this.signData.warehouse=''\r\n          this.signData.storeId=''\r\n          break;\r\n        case '门店收货':\r\n          this.signData.orderType=\"030102\",\r\n          this.selectStore=false\r\n          this.signData.warehouse=''\r\n          this.signData.storeName=''\r\n          this.signData.warehouseCode=''\r\n          break;\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    //得到组织机构数据\r\n    async getWarehouseListData() {\r\n      let info = await this.request(this.api.user.get_userinfo, {}, true);\r\n      console.log(info);\r\n      //得到部门Id\r\n      this.signData.relationDepId = info.departId;\r\n\r\n      this.request(this.api.user.userCompany_getUserOrgByUserId, {\r\n        userId: info.userId,\r\n        type: 0\r\n      }).then(data => {\r\n        console.log(data);\r\n        // this.organizationListData=data\r\n        //得到机构\r\n        this.signData.organization = data.name;\r\n        //得到机构code\r\n        this.signData.organizationCode = data.id;\r\n        //得到供货商数据\r\n        this.getSupplierListData(this.signData.organizationCode);\r\n        //获取货主列表\r\n        this.getGoodsOwnerListData(this.signData.organizationCode);\r\n        //得到仓库数据\r\n        this.getWarehouseList(this.signData.organizationCode);\r\n        //得到门店列表数据\r\n        this.getStoreBasicListData(this.signData.organizationCode)\r\n      });\r\n    },\r\n    //得到门店列表数据\r\n    getStoreBasicListData(organizationId){\r\n      this.request(this.api.retailStore.storeBasic_listByOrganizationId,{organizationId:organizationId}).then(res=>{\r\n        console.log(res)\r\n        this.storeListData=res\r\n      })\r\n    },\r\n    //获取货主列表\r\n    getGoodsOwnerListData(organizationId) {\r\n      this.request(this.api.system.goodsOwner_list, {\r\n        orgId: organizationId\r\n      }).then(data => {\r\n        console.log(data.data);\r\n        this.signData.goodsOwner = data.data[0].code;\r\n      });\r\n    },\r\n    //得到表格数据\r\n    getPurchasDetailListMsg(orderSn) {\r\n      this.request(this.api.order.channelPurchaseOrder_getByOrderSn, {\r\n        orderSn: orderSn,\r\n        pageIndex:'',\r\n        pageSize:''\r\n      }).then(data => {\r\n        this.signData.supplier = data.supplier;\r\n        this.signData.orderSn = data.orderSn;\r\n        this.signData.supplierCode = data.supplierCode;\r\n        if (data.channelOrderGoodsVOList) {\r\n          data.channelOrderGoodsVOList.data.forEach(item => {\r\n            item.tax = data.tax;\r\n            item.amount = item.num * item.actualAmount;\r\n          });\r\n        }\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = data.channelOrderGoodsVOList.data;\r\n      });\r\n    },\r\n    //获取物流数据\r\n    getLogisticsList() {\r\n      this.request(this.api.order.expressCompany_list, {}).then(data => {\r\n        console.log(data);\r\n        this.logisticsListData = data.data;\r\n      });\r\n    },\r\n    //得到仓库列表\r\n    getWarehouseList(orgId) {\r\n      console.log(orgId);\r\n      this.request(this.api.system.warehouse_list, {\r\n        used: true,\r\n        orgId: orgId\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.WarehouseCodeData = data.data;\r\n      });\r\n    },\r\n    //得到物流编码\r\n    selectLogisticsData(val) {\r\n      var logisticsCode = this.logisticsListData.find(\r\n        item => item.company == val\r\n      ).code;\r\n      this.signData.logisticsCompanyCode = logisticsCode;\r\n    },\r\n    //得到采购单号的数据\r\n    getOrderSnListData(supplierId) {\r\n      this.request(this.api.order.channelPurchaseArrivalOrder_orderSnList, {\r\n        supplierCode: supplierId\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.OrderSnListData = data;\r\n      });\r\n    },\r\n    //得到供货商数据\r\n    getSupplierListData(organizationId) {\r\n      console.log(246);\r\n      this.request(this.api.product.supplier_list, {\r\n        organizationId: organizationId,\r\n        cooperation: true\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.optionData = data.data;\r\n      });\r\n    },\r\n    //采购单号,渲染列表数据\r\n    selectOrderSnListDataChange(val) {\r\n      this.request(this.api.order.channelPurchaseArrivalOrder_goods, {\r\n        orderSn: val\r\n      }).then(data => {\r\n        console.log(data);\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = data;\r\n      });\r\n    },\r\n    //存储供应商编码\r\n    selectSupplierChange(val) {\r\n      this.signData.orderSn = \"\";\r\n      console.log(val);\r\n      this.supplierStatus = false;\r\n      let suppliceObj = this.optionData.find(item => item.name == val);\r\n      this.signData.supplierCode = suppliceObj.code;\r\n      this.getOrderSnListData(suppliceObj.code);\r\n    },\r\n    //收货仓库\r\n    selectwarehouseCodeChange(val) {\r\n      let warehouseObj = this.WarehouseCodeData.find(item => item.name == val);\r\n      this.signData.warehouseCode = warehouseObj.code;\r\n    },\r\n    //收货门店\r\n    selectStoreNameChange(val){\r\n      let storeId = this.storeListData.find(item => item.name == val).id;\r\n      this.signData.warehouse=this.signData.storeName\r\n      this.signData.warehouseCode = storeId;\r\n    },\r\n    //价格变化事件\r\n    priceInputChangeEvent() {\r\n      console.log(this.price);\r\n    },\r\n    //选择支付方式\r\n    paySelectWay(item) {\r\n      console.log(item);\r\n    },\r\n    //确认按钮的点击事件\r\n    primaryBtnClick() {\r\n      console.log(\"primaryBtnClick\");\r\n      this.signData.channelPurchaseArrivalOrderGoodsVOList.forEach(item => {\r\n        item.quantity = item.num;\r\n        if (!item.actualQuantity) {\r\n          item.actualQuantity = 0;\r\n        }\r\n      });\r\n\r\n      var filterData = this.signData.channelPurchaseArrivalOrderGoodsVOList.filter(item=>{\r\n        return item.currentQuantity && item.currentQuantity!=\"0\"\r\n      })\r\n      if(filterData.length>0){\r\n      }else{\r\n        this.$message.error('到货数量不能全部为0');\r\n        return\r\n      }\r\n      this.$refs.ruleForm.validate(valid => {\r\n        if (valid) {\r\n          switch (this.signData.deliveryType) {\r\n            case \"仓库收货\":\r\n              this.showBoxTipMsg(\"收货仓库：\")\r\n              break;\r\n            case \"门店收货\":\r\n              this.showBoxTipMsg(\"收货门店：\")\r\n              break;\r\n          }\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //弹框提示(仓库或门店)\r\n    showBoxTipMsg(name,fileteData){\r\n      this.$confirm(\r\n        \"确认后，\"+name+this.signData.warehouse+\",将收到采购到货单？\",\r\n        \"确认到货通知\",\r\n        {\r\n          confirmButtonText: \"确定\",\r\n          cancelButtonText: \"取消\",\r\n          type: \"warning\"\r\n        }\r\n      ).then(() => {\r\n        this.saveWarehouseDataOrStoreData()\r\n      }).catch(action=>{\r\n\r\n      })\r\n    },\r\n    //仓库或门店收货接口\r\n    saveWarehouseDataOrStoreData() {\r\n      console.log(\"saveWarehouseDataOrStoreData\")\r\n      this.signData.channelPurchaseArrivalOrderGoodsVOList=this.signData.channelPurchaseArrivalOrderGoodsVOList.filter(item=>{\r\n        return item.currentQuantity && item.currentQuantity!=\"0\"\r\n      })\r\n      // this.signData.channelPurchaseArrivalOrderGoodsVOList.forEach(item => {\r\n      //   item.currentQuantity=item.arrivalQuantity\r\n      // });\r\n      console.log(\"saveWarehouseData\")\r\n      this.request(\r\n        this.api.order.channelPurchaseArrivalOrder_insert,\r\n        this.signData\r\n      ).then(data => {\r\n        this.signData.channelPurchaseArrivalOrderGoodsVOList = [];\r\n        //此处应该时上传成功后，再删除\r\n        localStorage.removeItem(\"localTableData\");\r\n        this.$router.go(-1);\r\n      });\r\n    },\r\n    //取消按钮的点击事件\r\n    plainBtnClick() {\r\n      this.$router.go(-1);\r\n    },\r\n    //当前商品数量发生改变了\r\n    shopNumberChange(count, row) {\r\n      console.log(\"227===========count\");\r\n      // row.actualQuantity = count;\r\n      // console.log(this.signData.channelPurchaseArrivalOrderGoodsVOList);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n/* .treeDept{\r\n backgroun\r\n} */\r\n.input-div {\r\n  .data-div {\r\n    width: 100%;\r\n    display: flex;\r\n    div:first-child {\r\n      margin-right: 120px;\r\n      // flex: 1;\r\n    }\r\n  }\r\n  .last-data-div {\r\n    width: 100%;\r\n    display: flex;\r\n    div:first-child {\r\n      margin-right: 110px;\r\n      // flex: 1;\r\n    }\r\n  }\r\n  .orderNumber-div {\r\n    display: flex;\r\n    div:first-child {\r\n      margin-right: 104px;\r\n      // flex: 1;\r\n    }\r\n  }\r\n}\r\n.span-btn {\r\n  width: 100px;\r\n  text-align: center;\r\n}\r\n.recoment-input .contentInput {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.remarks-textarea {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.remarks-textarea .textarea {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.label-style {\r\n  display: inline-block;\r\n  width: 68px;\r\n}\r\n.title {\r\n  background-color: #fff;\r\n  padding: 15px 0 15px 30px;\r\n}\r\n.title > span {\r\n  display: inline-block;\r\n  background-color: #fff;\r\n  margin-left: 3px;\r\n}\r\n.middle {\r\n  background-color: #fff;\r\n  margin: 8px;\r\n  margin-bottom: 0;\r\n  height: 100%;\r\n}\r\n.middle > span {\r\n  display: inline-block;\r\n  margin: 20px 0 30px 30px;\r\n}\r\n.el-form-item__content {\r\n  line-height: 40px;\r\n  /* position: relative; */\r\n  font-size: 14px;\r\n  display: inline-block;\r\n  /* margin-right: 150px; */\r\n  // width: 300px;\r\n  white-space: nowrap;\r\n}\r\n.el-select {\r\n  display: inline-block;\r\n  /* position: relative; */\r\n  width: 130px;\r\n  margin-right: 10px;\r\n}\r\n.table-view {\r\n  /* margin-left: 30px; */\r\n  /* margin-bottom: 20px; */\r\n  padding: 0 30px;\r\n  background-color: #fff;\r\n}\r\n.title-div {\r\n  margin: 20px 0 30px;\r\n}\r\n.title-div span {\r\n  background-color: #409eff;\r\n  padding: 8px 20px;\r\n  color: #fff;\r\n  border-radius: 5px;\r\n}\r\n.title-div span:first-child {\r\n  background-color: #fff;\r\n  color: #222;\r\n  padding: 0 8px;\r\n  margin-right: 40px;\r\n}\r\n.money-div {\r\n  background-color: #fff;\r\n  width: 100%;\r\n  text-align: right;\r\n  padding-right: 30px;\r\n  margin-top: 30px;\r\n}\r\n.input-price {\r\n  display: inline-block;\r\n  padding: 10px;\r\n  width: 100px;\r\n  border-radius: 5px;\r\n}\r\n.money-content {\r\n  margin: 10px 0;\r\n}\r\n.price-msg {\r\n  padding: 30px;\r\n  background-color: #fff;\r\n}\r\n.price-msg > span {\r\n  display: inline-block;\r\n  margin-bottom: 20px;\r\n}\r\n.block {\r\n  display: flex;\r\n}\r\n.block > span {\r\n  display: inline-block;\r\n  margin-right: 10px;\r\n}\r\n\r\n.btn-div {\r\n  margin-left: 70px;\r\n  margin-top: 30px;\r\n}\r\n.division-type {\r\n  widows: 100%;\r\n  // background-color: aquamarine;\r\n  display: flex;\r\n  justify-items: center;\r\n}\r\n</style>\r\n"]}]}