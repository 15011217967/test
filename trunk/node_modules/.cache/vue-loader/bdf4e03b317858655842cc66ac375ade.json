{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OC\\user\\userCompany_auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OC\\user\\userCompany_auth.vue","mtime":1572415125216},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport treePer from \"@/components/treePermission\";\nexport default {\n  components: { treePer },\n  data() {\n    return {\n      // url传参账户id及userId\n      user_id: '',\n      _id: '',\n      // 是否全选\n      topChecked: false,\n      // 列表数据\n      tableData: [],\n      // 数据权限\n      dataAuthList: [\n        {name: '个人', authType: 0},\n        {name: '部门', authType: 1},\n        {name: '部门及以下', authType: 2},\n        {name: '机构', authType: 3}\n      ]\n    };\n  },\n  created(){\n    this.user_id = this.$route.query.userId\n    this._id = this.$route.query.id\n  },\n  mounted(){\n    this.$nextTick(()=> {\n      this.getData()\n    })\n  },\n  methods: {\n    // 后退\n    routerback() {\n      this.$router.go(-1);\n    },\n    // 获取数据\n    getData() {\n      this.request(this.api.system.user_Auth_Tree, {\n        userId: this.user_id\n      }).then(data=> {\n        this.tableDataInit(data);\n        this.tableData = data;\n        this.topChecked = data.findIndex(f => f.checked) > -1;\n      })\n    },\n    tableDataInit(data){\n      if(data && data.length){\n        data.forEach(item => {\n          if(item.leaf){\n            let dataAuthChecked = item.sublist.find(item => item.type === 'dataAuth');\n            if(dataAuthChecked){\n              item._dataAuthChecked = dataAuthChecked.authType;\n            }else {\n              item._dataAuthChecked = 0\n            }\n            item.sublist = item.sublist.filter(item => item.type === 'auth' );\n            item._dataAuthList = this.dataAuthList.map(auth => {\n              return {\n                name: auth.name,\n                authType: auth.authType,\n                menuId: item.id\n              }\n            })\n          }else{\n            this.tableDataInit(item.sublist);\n          }\n        })\n      }\n    },\n    // 返回权限设置是否全选\n    treeChange(topChecked) {\n      var hasChecked = this.tableData.findIndex(f => f.checked) > -1;\n      if (hasChecked) {\n        this.topChecked = hasChecked;\n      } else {\n        this.topChecked = topChecked;\n      }\n    },\n    // 新增和编辑提交\n    submitForm(formName) {\n      let perDa = this.combinaParams();\n      let postDa = {\n        id: this._id,\n        menuList: perDa.menus,\n        authList: perDa.ops,\n        dataAuthList: perDa.dataAuthList\n      };\n      this.request(this.api.user.crm_userCompany_saveUserAuth, postDa).then(data => {\n        this.routerback();\n      });\n    },\n    // 获取参数权限设置参数\n    combinaParams() {\n      var list = this.tableData;\n      let allList = {\n        menus: [],\n        ops: [],\n        dataAuthList: []\n      };\n      this.recurveData(allList, list);\n      return allList;\n    },\n    recurveData(allList, list) {\n      list.forEach(f => {\n        if(f.leaf){\n          let dataAuth = f._dataAuthList.find(item => {\n            return item.authType === f._dataAuthChecked\n          });\n          allList.dataAuthList.push(dataAuth);\n        }\n        if (f.checked) {\n          switch (f.type) {\n            case \"menu\":\n              allList.menus.push(f.id);\n              break;\n            case \"auth\":\n              allList.ops.push(f.id);\n              break;\n          }\n        }\n        if (f.sublist && f.sublist.length > 0) {\n          this.recurveData(allList, f.sublist);\n        }\n      });\n    },\n    // 功能权限全选\n    perChange(val) {\n      this.tableData.forEach(f => {\n        f.checked = val;\n        if (f.sublist && f.sublist.length > 0) {\n          this.cbChange(f.sublist, val);\n        }\n      });\n    },\n    cbChange(list, checked) {\n      list.forEach(f => {\n        f.checked = checked;\n        if (f.sublist && f.sublist.length > 0) {\n          this.cbChange(f.sublist, checked);\n        }\n      });\n    }\n  },\n  computed: {\n\n  },\n  watch: {\n\n  },\n};\n",{"version":3,"sources":["userCompany_auth.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA","file":"userCompany_auth.vue","sourceRoot":"src/views/OC/user","sourcesContent":["<style scoped lang=\"less\">\r\n  .rebort_table /deep/ .el-radio {margin-right: 10px;}\r\n  .titles {\r\n    width: 100%;\r\n    height: 80px;\r\n    background: #fff;\r\n    display: flex;\r\n    align-items: center;\r\n    padding-left: 18px;\r\n    box-sizing: border-box;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .rebort_table {\r\n    padding: 0 18px;\r\n    box-sizing: border-box;\r\n    background: #fff;\r\n  }\r\n  .rebort_table_title {\r\n    display: flex;\r\n    border: 1px solid #ccc;\r\n    border-right: none;\r\n    border-top: none;\r\n  }\r\n  .rebort_table_title {\r\n    border-top: 1px solid #ccc;\r\n  }\r\n  .rebort_table_title li {\r\n    width: calc(25%-13px);\r\n  }\r\n  .rebort_table_title:last-child,\r\n  .rebort_table_list:last-child {\r\n    border-bottom: 1px solid #ccc;\r\n  }\r\n  .rebort_table_title li,\r\n  .rebort_table_list li {\r\n    width: 25.6%;\r\n    height: 47px;\r\n    display: flex;\r\n    align-items: center;\r\n    border-right: 1px solid #ccc;\r\n    padding-left: 18px;\r\n    /* box-sizing: border-box; */\r\n  }\r\n  .rebort_table_title li:last-child {\r\n    /* background-color: rebeccapurple; */\r\n    width: 25.6%;\r\n  }\r\n  .el-checkbox {\r\n    margin-right: 10px;\r\n  }\r\n  .item-footer {\r\n    background: #fff;\r\n    padding: 18px;\r\n  }\r\n  .rebort_table_title_top {\r\n    overflow-y: scroll;\r\n  }\r\n\r\n  .rebort_table_title_top::-webkit-scrollbar-thumb {\r\n    background: #fff;\r\n  }\r\n  .rebort_table_title_top::-webkit-scrollbar-track {\r\n    background: #fff;\r\n    border-right: 1px solid #ccc !important;\r\n  }\r\n  .lasttopli {\r\n    border-right: none !important;\r\n  }\r\n</style>\r\n\r\n<template>\r\n  <div class=\"rebort_table\">\r\n    <div class=\"titles\">按用户授权</div>\r\n    <ul class=\"rebort_table_title rebort_table_title_top\">\r\n      <li>\r\n        <el-checkbox v-model=\"topChecked\" @change=\"perChange\">功能权限</el-checkbox>\r\n      </li>\r\n      <li>操作权限</li>\r\n      <li>字段权限</li>\r\n      <li class=\"lasttopli\">数据权限</li>\r\n    </ul>\r\n    <tree-per :data=\"tableData\" @item-change=\"treeChange\"></tree-per>\r\n    <div class=\"item-footer\">\r\n      <el-button @click=\"submitForm('filtersForm')\" type=\"primary\" size=\"small\">确定</el-button>\r\n      <el-button @click=\"routerback('filtersForm')\" size=\"small\">取消</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import treePer from \"@/components/treePermission\";\r\n  export default {\r\n    components: { treePer },\r\n    data() {\r\n      return {\r\n        // url传参账户id及userId\r\n        user_id: '',\r\n        _id: '',\r\n        // 是否全选\r\n        topChecked: false,\r\n        // 列表数据\r\n        tableData: [],\r\n        // 数据权限\r\n        dataAuthList: [\r\n          {name: '个人', authType: 0},\r\n          {name: '部门', authType: 1},\r\n          {name: '部门及以下', authType: 2},\r\n          {name: '机构', authType: 3}\r\n        ]\r\n      };\r\n    },\r\n    created(){\r\n      this.user_id = this.$route.query.userId\r\n      this._id = this.$route.query.id\r\n    },\r\n    mounted(){\r\n      this.$nextTick(()=> {\r\n        this.getData()\r\n      })\r\n    },\r\n    methods: {\r\n      // 后退\r\n      routerback() {\r\n        this.$router.go(-1);\r\n      },\r\n      // 获取数据\r\n      getData() {\r\n        this.request(this.api.system.user_Auth_Tree, {\r\n          userId: this.user_id\r\n        }).then(data=> {\r\n          this.tableDataInit(data);\r\n          this.tableData = data;\r\n          this.topChecked = data.findIndex(f => f.checked) > -1;\r\n        })\r\n      },\r\n      tableDataInit(data){\r\n        if(data && data.length){\r\n          data.forEach(item => {\r\n            if(item.leaf){\r\n              let dataAuthChecked = item.sublist.find(item => item.type === 'dataAuth');\r\n              if(dataAuthChecked){\r\n                item._dataAuthChecked = dataAuthChecked.authType;\r\n              }else {\r\n                item._dataAuthChecked = 0\r\n              }\r\n              item.sublist = item.sublist.filter(item => item.type === 'auth' );\r\n              item._dataAuthList = this.dataAuthList.map(auth => {\r\n                return {\r\n                  name: auth.name,\r\n                  authType: auth.authType,\r\n                  menuId: item.id\r\n                }\r\n              })\r\n            }else{\r\n              this.tableDataInit(item.sublist);\r\n            }\r\n          })\r\n        }\r\n      },\r\n      // 返回权限设置是否全选\r\n      treeChange(topChecked) {\r\n        var hasChecked = this.tableData.findIndex(f => f.checked) > -1;\r\n        if (hasChecked) {\r\n          this.topChecked = hasChecked;\r\n        } else {\r\n          this.topChecked = topChecked;\r\n        }\r\n      },\r\n      // 新增和编辑提交\r\n      submitForm(formName) {\r\n        let perDa = this.combinaParams();\r\n        let postDa = {\r\n          id: this._id,\r\n          menuList: perDa.menus,\r\n          authList: perDa.ops,\r\n          dataAuthList: perDa.dataAuthList\r\n        };\r\n        this.request(this.api.user.crm_userCompany_saveUserAuth, postDa).then(data => {\r\n          this.routerback();\r\n        });\r\n      },\r\n      // 获取参数权限设置参数\r\n      combinaParams() {\r\n        var list = this.tableData;\r\n        let allList = {\r\n          menus: [],\r\n          ops: [],\r\n          dataAuthList: []\r\n        };\r\n        this.recurveData(allList, list);\r\n        return allList;\r\n      },\r\n      recurveData(allList, list) {\r\n        list.forEach(f => {\r\n          if(f.leaf){\r\n            let dataAuth = f._dataAuthList.find(item => {\r\n              return item.authType === f._dataAuthChecked\r\n            });\r\n            allList.dataAuthList.push(dataAuth);\r\n          }\r\n          if (f.checked) {\r\n            switch (f.type) {\r\n              case \"menu\":\r\n                allList.menus.push(f.id);\r\n                break;\r\n              case \"auth\":\r\n                allList.ops.push(f.id);\r\n                break;\r\n            }\r\n          }\r\n          if (f.sublist && f.sublist.length > 0) {\r\n            this.recurveData(allList, f.sublist);\r\n          }\r\n        });\r\n      },\r\n      // 功能权限全选\r\n      perChange(val) {\r\n        this.tableData.forEach(f => {\r\n          f.checked = val;\r\n          if (f.sublist && f.sublist.length > 0) {\r\n            this.cbChange(f.sublist, val);\r\n          }\r\n        });\r\n      },\r\n      cbChange(list, checked) {\r\n        list.forEach(f => {\r\n          f.checked = checked;\r\n          if (f.sublist && f.sublist.length > 0) {\r\n            this.cbChange(f.sublist, checked);\r\n          }\r\n        });\r\n      }\r\n    },\r\n    computed: {\r\n\r\n    },\r\n    watch: {\r\n\r\n    },\r\n  };\r\n</script>\r\n\r\n"]}]}