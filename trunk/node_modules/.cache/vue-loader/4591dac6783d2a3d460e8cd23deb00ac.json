{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\components\\upload_video.vue?vue&type=style&index=0&id=5fa51068&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\components\\upload_video.vue","mtime":1572415123952},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\css-loader\\index.js","mtime":1558492728478},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1558492728890},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\postcss-loader\\src\\index.js","mtime":1558492728823},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\less-loader\\dist\\cjs.js","mtime":1566193719488},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.upload-video {\r\n  width: 120px;\r\n  height: 150px;\r\n  .btn-wrap {\r\n    width: 120px;\r\n    height: 150px;\r\n    line-height: 150px;\r\n    border: 1px dashed #c0ccda;\r\n    border-radius: 6px;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    i {\r\n      font-size: 28px;\r\n      color: #8c939d;\r\n    }\r\n  }\r\n  .video-wrap {\r\n    position: relative;\r\n    width: 120px;\r\n    height: 150px;\r\n    border: 1px solid #c0ccda;\r\n    border-radius: 6px;\r\n    text-align: center;\r\n\r\n    cursor: pointer;\r\n    img,\r\n    video {\r\n      width: 120px;\r\n      height: 150px;\r\n    }\r\n    .abs-cont {\r\n      width: 120px;\r\n      height: 150px;\r\n      position: absolute;\r\n      left: 0;\r\n      top: -1px;\r\n      font-size: 12px;\r\n      color: #ffffff;\r\n      padding: 4px 2px 4px 4px;\r\n      border-radius: 6px;\r\n      background-color: #000000;\r\n      opacity: 0.5;\r\n      display: none;\r\n      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);\r\n      .remove {\r\n        position: absolute;\r\n        right: 10px;\r\n        bottom: 10px;\r\n        cursor: pointer;\r\n        font-size: 18px;\r\n      }\r\n      .play {\r\n        position: absolute;\r\n        left: 35%;\r\n        top: 35%;\r\n        cursor: pointer;\r\n        font-size: 40px;\r\n      }\r\n    }\r\n  }\r\n  .video-wrap:hover .abs-cont {\r\n    display: block;\r\n  }\r\n}\r\n.btn-wrap /deep/ .el-loading-spinner {\r\n  top: 0;\r\n  margin: 0;\r\n}\r\n",{"version":3,"sources":["upload_video.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload_video.vue","sourceRoot":"src/views/product/components","sourcesContent":["<!--\r\n * @Description: 商品中心上传视频\r\n * @Author: elephant\r\n * @Date: 2019-08-20 14:03:36\r\n * @LastEditTime: 2019-08-20 17:32:44\r\n * @LastEditors: Please set LastEditors\r\n -->\r\n<template>\r\n  <div class=\"upload-video\">\r\n    <form ref=\"upLoadForm\">\r\n      <input\r\n        type=\"file\"\r\n        style=\"display: none;\"\r\n        accept=\"video/mp4\"\r\n        ref=\"videoInput\"\r\n        @change=\"setVideoInfo()\"\r\n      />\r\n    </form>\r\n    <div v-if=\"isVideo\" class=\"video-wrap\">\r\n      <img v-if=\"isImg\" :src=\"imgUrl\" />\r\n      <video v-else :src=\"videoUrl\"></video>\r\n      <div class=\"abs-cont\">\r\n        <i v-if=\"!isEdit\" @click.stop=\"iconRemove()\" class=\"remove el-icon-delete\"></i>\r\n        <i @click.stop=\"iconPlay()\" class=\"play el-icon-video-play\"></i>\r\n      </div>\r\n    </div>\r\n    <div v-else class=\"btn-wrap\" @click.stop=\"addVideo\" v-loading=\"loading\">\r\n      <i class=\"el-icon-plus\"></i>\r\n    </div>\r\n    <!-- 视频组件 -->\r\n    <video-play-view ref=\"videoRef\"></video-play-view>\r\n  </div>\r\n</template>\r\n<script>\r\nimport TcVod from \"vod-js-sdk-v6/lib/tc_vod\";\r\nimport VideoPlayView from \"./videoPlay.vue\";\r\nexport default {\r\n  name: \"upload-video\",\r\n  // 数据\r\n  data() {\r\n    return {\r\n      isVideo: false,\r\n      isImg: false,\r\n      // 上传实例\r\n      tcVod: \"\",\r\n      videoInfoOld: null,\r\n      videoInfo: null,\r\n      // 最终后台参数\r\n      videoParams: null,\r\n      // 页面回显路径\r\n      videoUrl: \"\",\r\n      //图片回显路径\r\n      imgUrl: \"\",\r\n      // 签名\r\n      signature: null,\r\n      loading: false,\r\n      isEdit: false\r\n    };\r\n  },\r\n  created() {\r\n    this.init();\r\n  },\r\n  // 初始化数据\r\n  mounted() {\r\n    this.$nextTick(() => {});\r\n  },\r\n  // 方法\r\n  methods: {\r\n    // 初始化\r\n    init() {\r\n      this.isEdit = false;\r\n      this.videoInfoOld = null;\r\n      this.videoInfo = null;\r\n      this.videoParams = {};\r\n      this.videoUrl = \"\";\r\n      this.tcVod = new TcVod({\r\n        getSignature: this.getSignature\r\n      });\r\n    },\r\n    //修改返回初始化\r\n    propInit(params) {\r\n      this.videoUrl = params.url;\r\n      //图片回显路径\r\n      this.imgUrl = params.cover;\r\n      this.isVideo = true;\r\n      this.isImg = true;\r\n      this.isEdit = true;\r\n    },\r\n    // 获取签名\r\n    getSignature() {\r\n      if (this.signature) {\r\n        return this.signature;\r\n      } else {\r\n        this.request(this.api.contentCore.picture_get, {}).then(data => {\r\n          this.signature = data.signature;\r\n          return data.signature;\r\n        });\r\n      }\r\n    },\r\n    // 添加视频\r\n    addVideo() {\r\n      if (this.loading) return;\r\n      this.$refs.videoInput.click();\r\n    },\r\n    // 判断上传文件是否是视频\r\n    checkVideoType(type) {\r\n      if (!type) {\r\n        this.$message.error(\"视频类型必须是,mp4中的一种\");\r\n        this.loading = false;\r\n        return false;\r\n      }\r\n      const str = type.split(\"/\")[1].toLowerCase();\r\n      if (!str.match(/mp4/)) {\r\n        this.loading = false;\r\n        this.$message.error(\"视频类型必须是,mp4中的一种\");\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    },\r\n    // 上传的视频信息\r\n    setVideoInfo() {\r\n      let _file = this.$refs.videoInput.files[0];\r\n      const isLtM = _file.size / 1024 / 1024 < 20;\r\n      if (!isLtM) {\r\n        this.$message.error(\"上传视频大小不能超过\" + 20 + \"MB!\");\r\n        return false;\r\n      }\r\n      this.loading = true;\r\n      this.videoInfo = _file;\r\n      // 解决 chrome input 上传取消bug\r\n      if (!this.videoInfo) {\r\n        this.videoInfo = this.videoInfoOld.get(\"imgInfo\");\r\n      } else {\r\n        this.videoInfoOld = new FormData();\r\n        this.videoInfoOld.set(\"imgInfo\", this.videoInfo);\r\n      }\r\n      const flag = this.checkVideoType(this.videoInfo.type);\r\n      if (flag) {\r\n        this.addUpload();\r\n      }\r\n    },\r\n    // 上传过程\r\n    addUpload() {\r\n      let self = this;\r\n      let uploader = this.tcVod.upload({\r\n        mediaFile: this.videoInfo\r\n      });\r\n      // 视频上传进度\r\n      uploader.on(\"media_progress\", function(info) {});\r\n      // 视频上传完成时\r\n      uploader.on(\"media_upload\", function(info) {});\r\n      // 完成回调\r\n      uploader\r\n        .done()\r\n        .then(function(doneResult) {\r\n          self.videoSave(doneResult);\r\n        })\r\n        .catch(function(err) {\r\n          this.loading = false;\r\n        });\r\n    },\r\n    // 保存视频\r\n    videoSave(params) {\r\n      setTimeout(() => {\r\n        this.loading = false;\r\n        this.videoParams = {\r\n          fileId: params.fileId,\r\n          url: params.video.url\r\n        };\r\n        this.videoUrl = params.video.url;\r\n        this.isVideo = true;\r\n        this.isImg = false;\r\n        this.$emit(\"setVideoParams\", this.videoParams);\r\n      }, 500);\r\n    },\r\n    //删除当前视频\r\n    iconRemove() {\r\n      if (!this.isEdit) {\r\n        this.request(this.api.product.video_deleteMedia, {\r\n          fileId: this.videoParams.fileId\r\n        }).then(res => {\r\n          console.log(res);\r\n          this.$message.success(\"删除视频成功\");\r\n          this.videoParams = {\r\n            fileId: \"\",\r\n            url: \"\"\r\n          };\r\n          this.videoUrl = \"\";\r\n          this.isVideo = false;\r\n          this.isImg = true;\r\n        });\r\n      } else {\r\n        this.videoParams = {\r\n          fileId: \"\",\r\n          url: \"\"\r\n        };\r\n        this.videoUrl = \"\";\r\n        this.isVideo = false;\r\n        this.isImg = true;\r\n      }\r\n    },\r\n    //播放当前视频\r\n    iconPlay() {\r\n      this.$refs.videoRef.videoInit(this.videoUrl);\r\n    },\r\n    getUploadVideoInfo() {\r\n      return this.videoParams;\r\n    }\r\n  },\r\n  components: {\r\n    VideoPlayView\r\n  }\r\n};\r\n</script>\r\n <style lang=\"less\" scoped>\r\n.upload-video {\r\n  width: 120px;\r\n  height: 150px;\r\n  .btn-wrap {\r\n    width: 120px;\r\n    height: 150px;\r\n    line-height: 150px;\r\n    border: 1px dashed #c0ccda;\r\n    border-radius: 6px;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    i {\r\n      font-size: 28px;\r\n      color: #8c939d;\r\n    }\r\n  }\r\n  .video-wrap {\r\n    position: relative;\r\n    width: 120px;\r\n    height: 150px;\r\n    border: 1px solid #c0ccda;\r\n    border-radius: 6px;\r\n    text-align: center;\r\n\r\n    cursor: pointer;\r\n    img,\r\n    video {\r\n      width: 120px;\r\n      height: 150px;\r\n    }\r\n    .abs-cont {\r\n      width: 120px;\r\n      height: 150px;\r\n      position: absolute;\r\n      left: 0;\r\n      top: -1px;\r\n      font-size: 12px;\r\n      color: #ffffff;\r\n      padding: 4px 2px 4px 4px;\r\n      border-radius: 6px;\r\n      background-color: #000000;\r\n      opacity: 0.5;\r\n      display: none;\r\n      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);\r\n      .remove {\r\n        position: absolute;\r\n        right: 10px;\r\n        bottom: 10px;\r\n        cursor: pointer;\r\n        font-size: 18px;\r\n      }\r\n      .play {\r\n        position: absolute;\r\n        left: 35%;\r\n        top: 35%;\r\n        cursor: pointer;\r\n        font-size: 40px;\r\n      }\r\n    }\r\n  }\r\n  .video-wrap:hover .abs-cont {\r\n    display: block;\r\n  }\r\n}\r\n.btn-wrap /deep/ .el-loading-spinner {\r\n  top: 0;\r\n  margin: 0;\r\n}\r\n</style>\r\n"]}]}