{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OS\\ditch\\ditch_add.vue?vue&type=style&index=0&id=2b856d6a&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OS\\ditch\\ditch_add.vue","mtime":1576527812255},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\css-loader\\index.js","mtime":1558492728478},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1558492728890},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\postcss-loader\\src\\index.js","mtime":1558492728823},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\less-loader\\dist\\cjs.js","mtime":1566193719488},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.input-div {\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n}\r\n.tag_div {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.recoment-input {\r\n  // background-color: #222;\r\n  padding-left: 12px;\r\n}\r\n.recoment-input .contentInput {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.remarks-textarea {\r\n  margin-top: 20px;\r\n  position: relative;\r\n}\r\n.remarks-textarea span{\r\n  position: relative;\r\n  top: -24px;\r\n}\r\n.remarks-textarea .textarea {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.label-style {\r\n  display: inline-block;\r\n  width: 68px;\r\n}\r\n.title {\r\n  background-color: #fff;\r\n  padding: 15px 0 15px 30px;\r\n}\r\n.title > span {\r\n  display: inline-block;\r\n  background-color: #fff;\r\n  margin-left: 3px;\r\n}\r\n.middle {\r\n  background-color: #fff;\r\n  margin: 8px;\r\n  margin-bottom: 0;\r\n  height: 100%;\r\n}\r\n.middle > span {\r\n  display: inline-block;\r\n  margin: 20px 0 30px 30px;\r\n}\r\n.el-form-item__content {\r\n  line-height: 40px;\r\n  /* position: relative; */\r\n  font-size: 14px;\r\n  display: inline-block;\r\n  /* margin-right: 150px; */\r\n  // width: 300px;\r\n  white-space: nowrap;\r\n}\r\n.el-select {\r\n  display: inline-block;\r\n  /* position: relative; */\r\n  width: 130px;\r\n  margin-right: 10px;\r\n}\r\n.table-view {\r\n  /* margin-left: 30px; */\r\n  /* margin-bottom: 20px; */\r\n  padding: 0 30px;\r\n  background-color: #fff;\r\n}\r\n.title-div {\r\n  margin: 20px 0 30px;\r\n}\r\n.title-div span {\r\n  background-color: #409eff;\r\n  padding: 8px 20px;\r\n  color: #fff;\r\n  border-radius: 5px;\r\n}\r\n.title-div span:first-child {\r\n  background-color: #fff;\r\n  color: #222;\r\n  padding: 0 8px;\r\n  margin-right: 40px;\r\n}\r\n.money-div {\r\n  background-color: #fff;\r\n  width: 100%;\r\n  text-align: right;\r\n  padding-right: 30px;\r\n  margin-top: 30px;\r\n}\r\n.input-price {\r\n  display: inline-block;\r\n  padding: 10px;\r\n  width: 100px;\r\n  border-radius: 5px;\r\n}\r\n.money-content {\r\n  margin: 10px 0;\r\n}\r\n.price-msg {\r\n  padding: 30px;\r\n  background-color: #fff;\r\n}\r\n.price-msg > span {\r\n  display: inline-block;\r\n  margin-bottom: 20px;\r\n}\r\n.block {\r\n  display: flex;\r\n}\r\n.block > span {\r\n  display: inline-block;\r\n  margin-right: 10px;\r\n}\r\n.other-msg {\r\n  display: inline-block;\r\n  margin-top: 20px;\r\n}\r\n.btn-div {\r\n  margin-left: 70px;\r\n  margin-top: 30px;\r\n}\r\n.division-type {\r\n  widows: 100%;\r\n  // background-color: aquamarine;\r\n  display: flex;\r\n  justify-items: center;\r\n}\r\n",{"version":3,"sources":["ditch_add.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAirBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ditch_add.vue","sourceRoot":"src/views/OS/ditch","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"middle\">\r\n      <span>基本信息</span>\r\n      <div>\r\n        <el-form\r\n          :inline=\"true\"\r\n          :model=\"shop_user\"\r\n          :rules=\"rules\"\r\n          ref=\"ruleForm\"\r\n          label-width=\"120px\"\r\n          class=\"demo-ruleForm\"\r\n        >\r\n          <div class=\"input-div\">\r\n            <div class=\"left_div\">\r\n              <!-- <el-form-item label=\"商户名称：\" prop=\"storeName\">\r\n                            <el-input placeholder='请输入商户名称' v-model=\"shop_user.storeName\"></el-input>\r\n              </el-form-item>-->\r\n              <el-form-item label=\"组织机构：\" prop=\"organization\">\r\n                <el-input v-model=\"shop_user.organization\" disabled></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"收货人：\" prop=\"receiverName\">\r\n                <el-input\r\n                  placeholder=\"请输入收货人名称\"\r\n                  v-model=\"shop_user.receiverName\"\r\n                  @input=\"receiverNameValueChange\"\r\n                ></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item prop=\"addressId\" label=\"收货地址：\">\r\n                <division @set-division=\"setDivision\" v-model=\"shop_user.addressId\"></division>\r\n              </el-form-item>\r\n              <br />\r\n              <!-- <el-form-item label=\"出库仓库：\" prop=\"warehouse\">\r\n                <el-select\r\n                  v-model=\"shop_user.warehouse\"\r\n                  @change=\"getWarehouseCode\"\r\n                  placeholder=\"请选择仓库\"\r\n                  :disabled=\"isDisable\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in WarehouseCodeData\"\r\n                    :label=\"item.name\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.name\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item> \r\n              <br />-->\r\n              <el-form-item label=\"物流公司：\">\r\n                <el-select\r\n                  v-model=\"shop_user.logisticsCompany\"\r\n                  @change=\"selectLogisticsData\"\r\n                  placeholder=\"请选择物流公司\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in logisticsListData\"\r\n                    :label=\"item.name\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.name\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n            </div>\r\n\r\n            <div class=\"right_div\">\r\n              <el-form-item label=\"店铺名称：\" prop=\"storeName\">\r\n                <el-select\r\n                  v-model=\"shop_user.storeName\"\r\n                  @change=\"storeShopDataChanegEvent\"\r\n                  placeholder=\"请选择店铺\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in storeShopData\"\r\n                    :label=\"item.storeName\"\r\n                    :key=\"item.id\"\r\n                    :value=\"item.storeName\"\r\n                  ></el-option>\r\n                </el-select>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"联系电话：\" prop=\"receiverMobile\">\r\n                <el-input placeholder=\"请输入联系电话\" v-model=\"shop_user.receiverMobile\"></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"详细地址：\" prop=\"addressInfo\">\r\n                <el-input placeholder=\"请输入详细地址\" v-model=\"shop_user.addressInfo\"></el-input>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"订单来源：\" prop=\"channelCode\">\r\n                <code-set v-model=\"shop_user.channelCode\" code=\"ORD001\" style=\"width:180px;\"/>\r\n              </el-form-item>\r\n              <br />\r\n              <el-form-item label=\"物流单号：\">\r\n                <el-input placeholder=\"请输入单号\" v-model=\"shop_user.logisticsOrderSn\"></el-input>\r\n              </el-form-item>\r\n            </div>\r\n          </div>\r\n        </el-form>\r\n      </div>\r\n\r\n      <div class=\"table-view\">\r\n        <div class=\"title-div\">\r\n          <span>商品信息</span>\r\n          <span @click=\"selectShopClickEvent\">选择商品</span>\r\n        </div>\r\n        <div class=\"table-div\">\r\n          <el-table\r\n            :data=\"shop_user.channelSaleOrderGoodsVOList\"\r\n            style=\"width: 100%\"\r\n            header-row-class-name=\"item-table-header\"\r\n            max-height='400'\r\n          >\r\n            <el-table-column prop=\"productCode\" label=\"商品款号\" width align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"code\" label=\"商品货号\" width=\"200\" align=\"center\"></el-table-column>\r\n            <el-table-column prop label=\"商品图片\" width>\r\n              <template slot-scope=\"scope\">\r\n                <img :src=\"scope.row.image\" style=\"width:64px;height:64px;\" />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"name\" label=\"商品名称\" width align=\"center\"></el-table-column>\r\n            <el-table-column prop label=\"商品类型\" width align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <span>{{scope.row.type!=null?scope.row.type:'成品'}}</span>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"brandName\" label=\"品牌\" width align=\"center\"></el-table-column>\r\n            <el-table-column prop=\"fullCateName\" label=\"商品品类\" width=\"120\" align=\"center\"></el-table-column>\r\n            <el-table-column prop label=\"商品规格\" width align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <span>颜色：{{scope.row.color}}</span>\r\n                <br />\r\n                <span>尺寸：{{scope.row.size}}</span>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"销售单价\" width align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <div class=\"tag_div\">\r\n                  <span>￥</span>\r\n                  <el-input\r\n                    v-model=\"scope.row.retailPrice\"\r\n                    @input=\"retailPriceValueChangeEvent\"\r\n                    placeholder=\"0.00\"\r\n                  ></el-input>\r\n                </div>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"num\" label=\"数量\" align=\"center\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input-number\r\n                  v-model=\"scope.row.num\"\r\n                  @change=\"currentNumberChange\"\r\n                  :min=\"0\"\r\n                  :max=\"scope.row.availableQuantity\"\r\n                  v-enter-number\r\n                ></el-input-number>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n        </div>\r\n\r\n        <div class=\"money-div\">\r\n          <span>商品总金额：￥{{shop_user.amount?shop_user.amount:'0.00'}}</span>\r\n          <div class=\"money-content\">\r\n            <span>优惠金额：</span>\r\n            <input type=\"text\" class=\"input-price\" v-model=\"shop_user.preferentialRemarks\" placeholder=\"填写优惠项\" @input='preferentialRemarksInputChange' />\r\n            <span>￥</span>\r\n            <input\r\n              type=\"number\"\r\n              @input=\"preferentialAmountInputValueChange\"\r\n              class=\"input-price\"\r\n              v-model=\"shop_user.preferentialAmount\"\r\n              :disabled=\"!shop_user.amount\"\r\n              placeholder=\"0.00\"\r\n            />\r\n          </div>\r\n          <span>订单金额：￥{{shop_user.actualAmount?shop_user.actualAmount:'0.00'}}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"price-msg\">\r\n        <span>付款信息</span>\r\n        <el-form :inline=\"true\" :model=\"shop_user\" ref=\"formInlineFrom\" class=\"demo-form-inline\">\r\n          <el-form-item label=\"实付金额：\">\r\n            <el-input type=\"number\" v-model=\"shop_user.validAmount\" @input=\"validAmountValueChangeEvent\" placeholder=\"0.00\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"支付流水号(支付单据)：\">\r\n            <el-input v-model=\"shop_user.orderTradeNo\" placeholder=\"请输入内容\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"支付方式：\">\r\n            <code-set v-model=\"shop_user.paymentCode\" code=\"COM003\" />\r\n          </el-form-item>\r\n          <el-form-item>\r\n            <div class=\"block\">\r\n              <span class=\"demonstration\">支付时间:</span>\r\n              <el-date-picker v-model=\"shop_user.paymentTime\" type=\"date\" placeholder=\"选择日期\"></el-date-picker>\r\n            </div>\r\n          </el-form-item>\r\n        </el-form>\r\n\r\n        <span class=\"other-msg\">其他信息</span>\r\n\r\n        <div class=\"recoment-input\">\r\n          <span>推荐人：</span>\r\n          <el-input class=\"contentInput\" v-model=\"shop_user.recommend\" @input=\"recommendValueChange\" placeholder=\"请输入内容\"></el-input>\r\n        </div>\r\n        <div class=\"remarks-textarea\">\r\n          <span>订单备注：</span>\r\n          <el-input\r\n            class=\"textarea\"\r\n            type=\"textarea\"\r\n            :rows=\"2\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"shop_user.remarks\"\r\n            resize=\"none\"\r\n            @input=\"remarksValueChange\"\r\n          ></el-input>\r\n        </div>\r\n        <div class=\"btn-div\">\r\n          <el-button type=\"primary\" @click=\"primaryBtnClick\" size=\"small\">确认</el-button>\r\n          <el-button plain @click=\"plainBtnClick\" size=\"small\">取消</el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport codeSet from \"@/components/codeSet\";\r\nimport division from \"@/components/division\";\r\nimport treeDept from \"@/components/treeDept\";\r\nimport { isvalidPhone } from \"@/utils/phonevalide\";\r\nimport { async } from \"q\";\r\nvar validPhone = (rule, value, callback) => {\r\n  if (!value) {\r\n    callback(new Error(\"请输入电话号码\"));\r\n  } else if (!isvalidPhone(value)) {\r\n    callback(new Error(\"请输入正确的11位手机号码\"));\r\n  } else {\r\n    callback();\r\n  }\r\n};\r\n\r\nexport default {\r\n  components: {\r\n    codeSet,\r\n    division,\r\n    treeDept\r\n  },\r\n  data() {\r\n    return {\r\n      shop_user: {\r\n        orderType: \"0101\",\r\n        channelCode: \"\",\r\n        //组织机构编码\r\n        organizationCode: \"\",\r\n        //机构名称\r\n        organization: \"\",\r\n        //机构Id\r\n        organizationId: \"\",\r\n        //物流公司名称\r\n        logisticsCompany: \"\",\r\n        //货主名称\r\n        goodsOwner: \"\",\r\n        //物流公司编码\r\n        logisticsCompanyCode: \"\",\r\n        //出库仓库-名称\r\n        // warehouse: \"\",\r\n        //出库仓库-编码\r\n        // warehouseCode: \"\",\r\n        //部门Id\r\n        relationDepId: \"\",\r\n        //购买商户\r\n        storeName: \"\",\r\n        //商户Id\r\n        storeId:'',\r\n        //物流单号\r\n        logisticsOrderSn: \"\",\r\n        //出货日期\r\n        warehouseTime: \"\",\r\n        receiverName: \"\",\r\n        receiverMobile: \"\",\r\n        orderTradeNo: \"\",\r\n        //支付方式\r\n        paymentCode: \"\",\r\n        //选择日期\r\n        paymentTime: \"\",\r\n        //商品总金额\r\n        amount: \"\",\r\n        //优惠项内容\r\n        preferentialRemarks:\"\",\r\n        //优惠金额\r\n        preferentialAmount: \"\",\r\n        //订单金额\r\n        actualAmount: \"\",\r\n        //实付金额\r\n        validAmount: '0.00',\r\n        //订单备注\r\n        remarks: \"\",\r\n        //推荐人\r\n        agent: \"\",\r\n        addressId: \"\",\r\n        provinceName: \"\",\r\n        provinceCode: \"\",\r\n        cityName: \"\",\r\n        cityCode: \"\",\r\n        areaName: \"\",\r\n        areaCode: \"\",\r\n        addressInfo: \"\",\r\n        //商品数据表\r\n        channelSaleOrderGoodsVOList: []\r\n      },\r\n\r\n      rules: {\r\n        orderSources: [\r\n          { required: true, message: \"订单来源不能为空\", trigger: \"change\" }\r\n        ],\r\n        storeName: [\r\n          { required: true, message: \"商户名称不能为空\", trigger: \"blur\" }\r\n        ],\r\n        receiverName: [\r\n          { required: true, message: \"收货人不能为空\", trigger: \"blur\" }\r\n        ],\r\n        receiverMobile: [\r\n          { required: true, trigger: \"blur\", validator: validPhone }\r\n        ],\r\n        addressId: [\r\n          { required: true, message: \"地址不能为空\", trigger: \"blur\" }\r\n        ],\r\n        addressInfo: [\r\n          { required: true, message: \"详细地址不能为空\", trigger: \"blur\" }\r\n        ],\r\n        organization: [\r\n          { required: true, message: \"组织机构不能为空\", trigger: \"change\" }\r\n        ],\r\n        // warehouse: [\r\n        //   { required: true, message: \"出库仓库不能为空\", trigger: \"blur\" }\r\n        // ],\r\n        channelCode:[\r\n          { required: true, message: \"订单来源不能为空\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      //获取组织机构数据\r\n      organizationListData: [],\r\n      //获取物流数据\r\n      logisticsListData: [],\r\n      //收货仓库--合格的仓库\r\n      WarehouseCodeData: [],\r\n      //商铺名称联想数据\r\n      restaurants: [],\r\n      //标识仓库和商户\r\n      isDisable: true,\r\n      //选中的仓库Id\r\n      warehouseId: \"\",\r\n      //保存仓库当前的名称\r\n      tmpWarehouse: \"\",\r\n      //店铺数据\r\n      storeShopData:[]\r\n    };\r\n  },\r\n  watch: {\r\n    \"shop_user.preferentialAmount\": function(newPrice) {\r\n      //计算金额\r\n      var actualAmount = this.shop_user.amount - newPrice;\r\n      this.shop_user.actualAmount=actualAmount.toFixed(2)\r\n\r\n    },\r\n    \"shop_user.organization\": function(newPrice) {\r\n      if (newPrice == \"\") {\r\n        this.isDisable = true;\r\n      } else {\r\n        this.isDisable = false;\r\n      }\r\n    },\r\n    \"shop_user.warehouse\": function(newValue, oldValue) {\r\n      this.tmpWarehouse = oldValue;\r\n    }\r\n  },\r\n  created() {\r\n    let _type = localStorage.getItem(\"type\") || \"\";\r\n    //得到组织机构数据\r\n    this.getWarehouseListData();\r\n    //获取物流数据\r\n    this.getLogisticsList();\r\n    console.log(_type);\r\n    if (_type == \"add\") {\r\n      localStorage.removeItem(\"localTableData\");\r\n      localStorage.removeItem(\"shopMsgData\");\r\n      localStorage.removeItem(\"allShopPrice\");\r\n      this.isDisable = true;\r\n      this.shop_user.channelSaleOrderGoodsVOList = [];\r\n    } else {\r\n      var localTableData = localStorage.getItem(\"localTableData\");\r\n      var shopData = localStorage.getItem(\"shopMsgData\");\r\n      this.$nextTick(() => {\r\n        this.isDisable = false;\r\n        this.shop_user = JSON.parse(shopData);\r\n        this.shop_user.channelSaleOrderGoodsVOList = JSON.parse(localTableData);\r\n        if(this.shop_user.channelSaleOrderGoodsVOList && this.shop_user.channelSaleOrderGoodsVOList.length>0){\r\n          this.shop_user.channelSaleOrderGoodsVOList.forEach(item=>{\r\n            item.sellPrice=item.retailPrice\r\n          })\r\n        }\r\n        //赋值订单总金额\r\n        var amount = localStorage.getItem(\"allShopPrice\");\r\n        this.shop_user.amount = parseFloat(amount).toFixed(2);\r\n        this.shop_user.actualAmount =  parseFloat(amount).toFixed(2);\r\n\r\n        //得到当前的仓库名称\r\n        this.tmpWarehouse = this.shop_user.warehouse;\r\n        //得到仓库数据\r\n        this.getWarehouseList(this.shop_user.organizationId);\r\n        console.log(\"259========1\");\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    //得到组织机构数据\r\n    async getWarehouseListData() {\r\n      let info = await this.request(this.api.user.get_userinfo, {}, true);\r\n      console.log(info);\r\n      //得到部门Id\r\n      this.shop_user.relationDepId = info.departId;\r\n\r\n      this.request(this.api.user.userCompany_getUserOrgByUserId, {\r\n        userId: info.userId,\r\n        type: 0\r\n      }).then(data => {\r\n        console.log(data);\r\n        // this.organizationListData=data\r\n        //得到机构\r\n        this.shop_user.organization = data.name;\r\n        //得到机构code\r\n        this.shop_user.organizationCode = data.id;\r\n        //得到机构id\r\n        this.shop_user.organizationId = data.id;\r\n        //获取货主列表\r\n        this.getGoodsOwnerListData(this.shop_user.organizationId);\r\n        //得到店铺数据\r\n        this.getShopNameData(this.shop_user.organizationCode)\r\n        //得到仓库数据\r\n        this.getWarehouseList(this.shop_user.organizationId);\r\n      });\r\n    },\r\n    //获取货主列表\r\n    getGoodsOwnerListData(organizationId) {\r\n      this.request(this.api.system.goodsOwner_list, {\r\n        orgId: organizationId\r\n      }).then(data => {\r\n        console.log(data.data);\r\n        this.shop_user.goodsOwner = data.data[0].code;\r\n      });\r\n    },\r\n    //获取物流数据\r\n    getLogisticsList() {\r\n      this.request(this.api.warehouse.warehouseBase_logistics_list , {isValid:true}).then(res => {\r\n        console.log(res);\r\n        this.logisticsListData = res.data;\r\n      });\r\n    },\r\n    //得到物流编码\r\n    selectLogisticsData(val) {\r\n      var logisticsCode = this.logisticsListData.find(\r\n        item => item.name == val\r\n      ).code;\r\n      this.shop_user.logisticsCompanyCode = logisticsCode;\r\n    },\r\n    //得到仓库列表\r\n    getWarehouseList(id) {\r\n      //departId--根据组织机构得到相对应的仓库\r\n      this.request(this.api.system.warehouse_list, {\r\n        used: true,\r\n        orgId: id\r\n      }).then(data => {\r\n        this.WarehouseCodeData = data.data;\r\n      });\r\n    },\r\n    //得到仓库编码\r\n    getWarehouseCode(val) {\r\n      if (\r\n        this.shop_user.channelSaleOrderGoodsVOList &&\r\n        this.shop_user.channelSaleOrderGoodsVOList.length > 0\r\n      ) {\r\n        this.$confirm(\"切换仓库后，已选商品会清除，确认切换仓库吗？\", \"提示\", {\r\n          confirmButtonText: \"确定\",\r\n          cancelButtonText: \"取消\",\r\n          type: \"warning\"\r\n        })\r\n          .then(() => {\r\n            this.shop_user.channelSaleOrderGoodsVOList = [];\r\n            localStorage.removeItem(\"localTableData\");\r\n            this.shop_user.actualAmount = this.shop_user.amount = '';\r\n            localStorage.removeItem(\"allShopPrice\")\r\n            this.getWarehouseIdAndCode(val);\r\n          })\r\n          .catch(action => {\r\n            this.shop_user.warehouse = this.tmpWarehouse;\r\n            this.getWarehouseIdAndCode(this.shop_user.warehouse);\r\n          });\r\n      } else {\r\n        this.getWarehouseIdAndCode(val);\r\n      }\r\n    },\r\n    //得到仓库编码和Id\r\n    getWarehouseIdAndCode(val) {\r\n      // var warehouseId = this.WarehouseCodeData.find(item => item.name == val).id;\r\n      // var code = this.WarehouseCodeData.find(item => item.name == val).code;\r\n      // this.shop_user.warehouseCode = code;\r\n      // this.warehouseId = warehouseId;\r\n    },\r\n    setDivision(var1) {\r\n      this.shop_user.provinceName = var1.province;\r\n      this.shop_user.provinceCode = var1.provinceCode;\r\n      this.shop_user.cityName = var1.municipality;\r\n      this.shop_user.cityCode = var1.municipalityCode;\r\n      this.shop_user.areaName = var1.area;\r\n      this.shop_user.areaCode = var1.areaCode;\r\n      this.shop_user.addressId = var1.divisionId;\r\n    },\r\n    currentNumberChange() {\r\n      var amount = 0;\r\n      this.shop_user.channelSaleOrderGoodsVOList.forEach(item => {\r\n        amount += item.num * item.retailPrice;\r\n      });\r\n      this.shop_user.amount=amount.toFixed(2);\r\n      this.shop_user.actualAmount = amount.toFixed(2);\r\n    },\r\n    //优惠项内容改变\r\n    preferentialRemarksInputChange(val){\r\n      if (val.target.value.length > 10) {\r\n        this.shop_user.preferentialRemarks = val.target.value.substr(0, 10);\r\n      }\r\n    },\r\n    //优惠金额改变\r\n    preferentialAmountInputValueChange(val){\r\n      var preferential=val.target.value.match(/^\\d*(\\.?\\d{0,2})/g)\r\n      this.shop_user.preferentialAmount=preferential[0]\r\n    },\r\n    //选择支付方式\r\n    paySelectWay(item) {\r\n      console.log(item);\r\n    },\r\n    //点击选择商品\r\n    selectShopClickEvent() {\r\n      // && this.shop_user.warehouse\r\n      if (this.shop_user.organization) {\r\n        this.$router.push({\r\n          path: \"/OS/ditch/select_shop\",\r\n          name: \"select_shop\",\r\n          query: {\r\n            ownerId: this.shop_user.goodsOwner,\r\n            organizationName: this.shop_user.organization,\r\n            warehouseId: this.shop_user.warehouseCode,\r\n            warehouseName: this.shop_user.warehouse\r\n          }\r\n        });\r\n        //存储填写的信息\r\n        localStorage.setItem(\"shopMsgData\", JSON.stringify(this.shop_user));\r\n        localStorage.setItem(\"localTableData\",JSON.stringify(this.shop_user.channelSaleOrderGoodsVOList));\r\n      } else {\r\n        this.$message.error(\"组织机构或者出库仓库为空\");\r\n      }\r\n    },\r\n    //确认按钮的点击事件\r\n    primaryBtnClick() {\r\n      // this.shop_user.organization = this.$refs.treeDept.$refs.input.value;\r\n      if(this.shop_user.channelSaleOrderGoodsVOList && this.shop_user.channelSaleOrderGoodsVOList.length>0){\r\n        var tmpPrice=''\r\n        this.shop_user.channelSaleOrderGoodsVOList.forEach(item=>{\r\n          item.amount= parseInt(item.retailPrice)*item.num\r\n          item.tmpPrice=item.sellPrice\r\n          item.sellPrice=item.retailPrice\r\n          item.retailPrice=item.tmpPrice\r\n        })\r\n      }\r\n      this.$refs.ruleForm.validate(valid => {\r\n        if (valid) {\r\n          let channelSaleOrderGoodsVOList = this.shop_user.channelSaleOrderGoodsVOList.filter(item => {\r\n            return item.num != 0;\r\n          })\r\n          this.shop_user.channelSaleOrderGoodsVOList=channelSaleOrderGoodsVOList\r\n          this.request(\r\n            this.api.order.channelSaleOrder_save,\r\n            this.shop_user\r\n          ).then(data => {\r\n            console.log(\"270===========\");\r\n            if (data && data.length) {\r\n              let html = \"\";\r\n              data.forEach(errItem => {\r\n                for (let i = 0; i <  this.shop_user.channelSaleOrderGoodsVOList.length; i++) {\r\n                  if ( this.shop_user.channelSaleOrderGoodsVOList[i].code == errItem.code) {\r\n                    if (errItem.qty == 0) {\r\n                      this.shop_user.channelSaleOrderGoodsVOList.splice(i, 1);\r\n                      html += \"<p>\" + errItem.code + \"：可用库存为0，已删除该商品；</p>\";\r\n                    } else {\r\n                      html += \"<p>\" + errItem.code + \"：可用库存不足，已更新为最大值\" + errItem.qty + \"；</p>\";\r\n                      this.shop_user.channelSaleOrderGoodsVOList[i].availableQuantity = errItem.qty;\r\n                      this.shop_user.channelSaleOrderGoodsVOList[i].num = errItem.qty;\r\n                    }\r\n                    break;\r\n                  }\r\n                }\r\n              });\r\n              this.$notify({\r\n                title: \"提示\",\r\n                duration: 0,\r\n                dangerouslyUseHTMLString: true,\r\n                message: html\r\n              });\r\n            } else {\r\n              this.$notify.success({ title: \"成功\", message: \"新增成功\" });  \r\n              //重置\r\n              localStorage.removeItem(\"localTableData\");\r\n              this.$refs.ruleForm.resetFields();\r\n              this.shop_user.channelSaleOrderGoodsVOList = [];\r\n              this.$router.go(-1)\r\n            }    \r\n          });\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //取消按钮的点击事件\r\n    plainBtnClick() {\r\n      this.$router.go(-1)\r\n    },\r\n    //收货人内容输入时的事件\r\n    receiverNameValueChange(val) {\r\n      if (val.length > 10) {\r\n        this.shop_user.receiverName = val.substr(0, 10);\r\n      }\r\n    },\r\n    //得到店铺数据\r\n    getShopNameData(organizationId) {\r\n      // symbol 1--网销 2--渠销\r\n      this.request(\r\n        this.api.order.orderStore_orderStoreList,\r\n        {\r\n          symbol: 1,\r\n          organizationCode:organizationId ,\r\n        },\r\n      ).then(data=>{\r\n        console.log(data)\r\n        this.storeShopData=data\r\n      })\r\n    },\r\n    //\r\n    storeShopDataChanegEvent(val){\r\n      console.log(val)\r\n      var storeId=this.storeShopData.find(item=>item.storeName==val).id\r\n      this.shop_user.storeId=storeId\r\n    },\r\n    //销售单价改变事件\r\n    retailPriceValueChangeEvent(){\r\n      var allPrice=0\r\n      this.shop_user.preferentialAmount='0.00'\r\n      this.shop_user.channelSaleOrderGoodsVOList.forEach(item=>{\r\n        if(item.retailPrice){\r\n          allPrice+=parseInt(item.retailPrice)*item.num\r\n        }\r\n      })\r\n      this.shop_user.amount=allPrice.toFixed(2)\r\n      this.shop_user.actualAmount=allPrice.toFixed(2)\r\n      localStorage.setItem(\"allShopPrice\",allPrice)\r\n    },\r\n    //实付金额值改变的事件\r\n    validAmountValueChangeEvent(val){\r\n      var validAmount=val.match(/^\\d*(\\.?\\d{0,2})/g)\r\n      this.shop_user.validAmount=validAmount[0]\r\n    },\r\n    //推荐人值改变的事件\r\n    recommendValueChange(val){\r\n      if (val.length > 10) {\r\n        this.shop_user.recommend = val.substr(0, 10);\r\n      }\r\n    },\r\n    //订单备注值改变的事件\r\n    remarksValueChange(val){\r\n      if (val.length > 100) {\r\n        this.shop_user.remarks = val.substr(0, 100);\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.input-div {\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: row;\r\n}\r\n.tag_div {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.recoment-input {\r\n  // background-color: #222;\r\n  padding-left: 12px;\r\n}\r\n.recoment-input .contentInput {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.remarks-textarea {\r\n  margin-top: 20px;\r\n  position: relative;\r\n}\r\n.remarks-textarea span{\r\n  position: relative;\r\n  top: -24px;\r\n}\r\n.remarks-textarea .textarea {\r\n  display: inline-block;\r\n  width: 300px;\r\n}\r\n.label-style {\r\n  display: inline-block;\r\n  width: 68px;\r\n}\r\n.title {\r\n  background-color: #fff;\r\n  padding: 15px 0 15px 30px;\r\n}\r\n.title > span {\r\n  display: inline-block;\r\n  background-color: #fff;\r\n  margin-left: 3px;\r\n}\r\n.middle {\r\n  background-color: #fff;\r\n  margin: 8px;\r\n  margin-bottom: 0;\r\n  height: 100%;\r\n}\r\n.middle > span {\r\n  display: inline-block;\r\n  margin: 20px 0 30px 30px;\r\n}\r\n.el-form-item__content {\r\n  line-height: 40px;\r\n  /* position: relative; */\r\n  font-size: 14px;\r\n  display: inline-block;\r\n  /* margin-right: 150px; */\r\n  // width: 300px;\r\n  white-space: nowrap;\r\n}\r\n.el-select {\r\n  display: inline-block;\r\n  /* position: relative; */\r\n  width: 130px;\r\n  margin-right: 10px;\r\n}\r\n.table-view {\r\n  /* margin-left: 30px; */\r\n  /* margin-bottom: 20px; */\r\n  padding: 0 30px;\r\n  background-color: #fff;\r\n}\r\n.title-div {\r\n  margin: 20px 0 30px;\r\n}\r\n.title-div span {\r\n  background-color: #409eff;\r\n  padding: 8px 20px;\r\n  color: #fff;\r\n  border-radius: 5px;\r\n}\r\n.title-div span:first-child {\r\n  background-color: #fff;\r\n  color: #222;\r\n  padding: 0 8px;\r\n  margin-right: 40px;\r\n}\r\n.money-div {\r\n  background-color: #fff;\r\n  width: 100%;\r\n  text-align: right;\r\n  padding-right: 30px;\r\n  margin-top: 30px;\r\n}\r\n.input-price {\r\n  display: inline-block;\r\n  padding: 10px;\r\n  width: 100px;\r\n  border-radius: 5px;\r\n}\r\n.money-content {\r\n  margin: 10px 0;\r\n}\r\n.price-msg {\r\n  padding: 30px;\r\n  background-color: #fff;\r\n}\r\n.price-msg > span {\r\n  display: inline-block;\r\n  margin-bottom: 20px;\r\n}\r\n.block {\r\n  display: flex;\r\n}\r\n.block > span {\r\n  display: inline-block;\r\n  margin-right: 10px;\r\n}\r\n.other-msg {\r\n  display: inline-block;\r\n  margin-top: 20px;\r\n}\r\n.btn-div {\r\n  margin-left: 70px;\r\n  margin-top: 30px;\r\n}\r\n.division-type {\r\n  widows: 100%;\r\n  // background-color: aquamarine;\r\n  display: flex;\r\n  justify-items: center;\r\n}\r\n</style>\r\n"]}]}