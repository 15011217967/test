{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\technology_details.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\technology_details.vue","mtime":1572415124048},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nlet mirroringMaterialCates = [];\r\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\r\nimport { numberPrice } from \"@/utils/validate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        type: 1, //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\r\n        materialCateId: \"\",\r\n        name: \"\",\r\n        unitPrice: \"\",\r\n        image: \"\",\r\n        costPrice: null,\r\n        valid: true,\r\n        description: \"\",\r\n        productionMaterialCates: [], //商品分类数组\r\n        productionMaterialExclusions: [] //工艺互斥\r\n      },\r\n      productImages: [], //回显图片\r\n      showDisabled: false,\r\n      editDisabled: false,\r\n      _type: \"\",\r\n      _id: \"\",\r\n      rules: {\r\n        //规则验证\r\n        materialCateId: [\r\n          { required: true, message: \"请选择属性分类\", trigger: \"change\" }\r\n        ],\r\n        productionMaterialCates: [\r\n          { required: true, message: \"请选择商品分类\", trigger: \"change\" }\r\n        ],\r\n        name: [{ required: true, message: \"输入原料名称\", trigger: \"blur\" }],\r\n        unitPrice: [\r\n          { required: true, message: \"请输入销售价格\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      //分类使用\r\n      cateIdArr: [],\r\n      classData: [], // 商品分类树 数据\r\n      listData: [], // 商品 分类 一维数据\r\n      attrClassData: [], //原料分类树数据\r\n      attrListData: [], //原料 一维数据\r\n      attrCateArr: [],\r\n      cateArr: [],\r\n      props: {\r\n        value: \"id\",\r\n        label: \"name\",\r\n        children: \"children\"\r\n      },\r\n      productionMaterialExclusions:[],\r\n      cateNames: \"\",\r\n      mutexList: [],\r\n      setMutexData: [] //获得到的互斥ID 需要做处理\r\n    };\r\n  },\r\n  created() {\r\n    this.getQueryparams();\r\n\r\n    this.getMutexData();\r\n  },\r\n  methods: {\r\n    setNumberPrice(_t) {\r\n      numberPrice(_t);\r\n    },\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      this._type = this.$route.query._type;\r\n      this._id = this.$route.query._id;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n          this.getClassData();\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getEchoDisplayData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getEchoDisplayData();\r\n          break;\r\n      }\r\n    },\r\n    getClassData(_disabledIds) {\r\n      // 获取商品分类  type 1\r\n      this.$common.getClassSelect(this, 1, _disabledIds).then(res => {\r\n        this.classData = res.ztree;\r\n        this.listData = res.list;\r\n      });\r\n      //获取属性分类  type 1\r\n      this.$common.getClassSelect(this, 3).then(res => {\r\n        this.attrClassData = res.ztree;\r\n        this.attrListData = res.list;\r\n      });\r\n    },\r\n    cateChangeGet(e) {\r\n      let careIdArr = this.cateIdArr,\r\n        careIdLen = careIdArr.length;\r\n      let list = this.listData,\r\n        listLen = list.length;\r\n      let categories = [];\r\n      for (let i = 0; i < careIdLen; i++) {\r\n        for (let k = 0; k < listLen; k++) {\r\n          if (careIdArr[i] == list[k].id) {\r\n            categories.push({\r\n              cateId: list[k].id,\r\n              cateName: list[k].name,\r\n              cateIdentifier: list[k].identifier,\r\n              fullCateName: list[k].fullCateName\r\n            });\r\n          }\r\n        }\r\n      }\r\n      this.filtersData.productionMaterialCates = [\r\n        ...categories,\r\n        ...mirroringMaterialCates\r\n      ];\r\n    },\r\n    attrCascaderGet(e) {\r\n      let cateId = JSON.parse(JSON.stringify(e)).pop();\r\n      let obj = this.attrListData.find(item => item.id == cateId);\r\n      this.filtersData.materialCateId = obj.id;\r\n      this.filtersData.materialCateName = obj.name;\r\n      this.filtersData.materialCateIdentifier = obj.identifier;\r\n      this.filtersData.materialFullCateName = obj.fullCateName;\r\n    },\r\n    removeTag(item) {\r\n      if(this._type == 'edit'){\r\n        let exclusions= this.filtersData.productionMaterialExclusions;\r\n        if(exclusions.length >0){\r\n          let flag =false;\r\n          for (let i = 0; i < exclusions.length; i++) {\r\n            if(exclusions[i].exclusionMaterialId == item && exclusions[i].id != null){\r\n                flag=true;\r\n                exclusions[i].status = 9;\r\n            }\r\n          }\r\n          if(!flag){\r\n            let index = exclusions.findIndex((elem) => (elem.exclusionMaterialId ==item));\r\n            if(index != -1){\r\n              this.filtersData.productionMaterialExclusions.splice(index,1)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //互斥处理\r\n    setMutexGet(item) {\r\n      let mutex = this.setMutexData,\r\n          mutexLen = mutex.length;\r\n        let mutexList = this.mutexList,\r\n          mutexListLen = mutexList.length;\r\n        let categories = [];\r\n        for (let i = 0; i < mutexLen; i++) {\r\n          for (let k = 0; k < mutexListLen; k++) {\r\n            if (mutex[i] == mutexList[k].id) {\r\n              categories.push({\r\n                exclusionMaterialId: mutexList[k].id,\r\n                exclusionMaterialName:mutexList[k].name\r\n              });\r\n            }\r\n          }\r\n        }\r\n        if(this._type == 'edit'){\r\n          let exclusions= this.filtersData.productionMaterialExclusions;\r\n          let list =[];\r\n            for (let i = 0; i < categories.length; i++) {\r\n              let flag=false;\r\n              for (let k = 0; k < exclusions.length; k++) {\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId){\r\n                  flag=true;\r\n                }\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId && exclusions[k].id!= null){\r\n                  exclusions[k].status=1;\r\n                }\r\n              }\r\n              if(!flag){\r\n                list.push(categories[i])\r\n              }else{\r\n              }\r\n            }\r\n           this.filtersData.productionMaterialExclusions = [...list,...exclusions];\r\n        }else{\r\n          this.filtersData.productionMaterialExclusions = categories;\r\n        }\r\n    },\r\n    //提交\r\n    submitForm(formName) {\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          let Exclusions = this.filtersData.productionMaterialExclusions;\r\n          for (let i = 0; i < Exclusions.length; i++) {\r\n            Exclusions[i].materialId =\r\n              this.filtersData.id != \"\" ? this.filtersData.id : \"\";\r\n            Exclusions[i].materialName = this.filtersData.name;\r\n          }\r\n          this.request(\r\n            this.api.product.productionMaterial_save,\r\n            this.filtersData\r\n          ).then(res => {\r\n            this.$message.success(\"保存成功\");\r\n            setTimeout(() => {\r\n              this.routerback();\r\n            }, 500);\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n\r\n    //回显\r\n    getEchoDisplayData() {\r\n      this.request(this.api.product.productionMaterial_get, {\r\n        id: this._id\r\n      }).then(res => {\r\n        this.filtersData = res;\r\n        if (!!res.image) {\r\n          this.productImages = [{ url: res.image }];\r\n        }\r\n        this.cateArr = [res.cateId];\r\n        this.attrCateArr = [res.materialCateId];\r\n        let Exclusion = res.productionMaterialExclusions;\r\n        let list = [];\r\n        for (let i = 0; i < Exclusion.length; i++) {\r\n          list.push(Exclusion[i].exclusionMaterialId);\r\n        }\r\n        this.setMutexData = list;\r\n        //回显 商品分类已选置灰\r\n        let arr = [],\r\n          cateIds = [];\r\n        let Categories = res.productionMaterialCates;\r\n        mirroringMaterialCates = [...Categories];\r\n        if (Categories.length > 0) {\r\n          for (let i = 0; i < Categories.length; i++) {\r\n            arr.push(Categories[i].fullCateName); //此处的字段是错误的\r\n            cateIds.push(Categories[i].cateId);\r\n          }\r\n          this.cateNames = arr.join(\"、\");\r\n        }\r\n        this.getClassData(cateIds);\r\n      });\r\n    },\r\n    //互斥\r\n    getMutexData() {\r\n      this.request(this.api.product.productionMaterial_list, {\r\n        type: 1,\r\n        valid: true\r\n      }).then(res => {\r\n        let _data = res.data;\r\n        if(!!this._id){\r\n          for (let i = 0; i < _data.length; i++) {\r\n            if(_data[i].id == this._id){\r\n              _data.splice(i,1)\r\n              break;\r\n            }\r\n          }\r\n          this.mutexList = _data;\r\n        }else{\r\n          this.mutexList = _data;\r\n        }\r\n      });\r\n    },\r\n    //后退\r\n    routerback() {\r\n      this.$router.go(-1);\r\n    }\r\n  },\r\n  components: {\r\n    ElUploadImg\r\n  }\r\n};\r\n",{"version":3,"sources":["technology_details.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4IA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"technology_details.vue","sourceRoot":"src/views/product/custom_attrs","sourcesContent":["<template>\r\n  <div>\r\n    <el-form :rules=\"rules\" label-width=\"110px\" :model=\"filtersData\" size=\"small\" ref=\"filtersForm\">\r\n      <div class=\"tlogy-item\">\r\n        <h5 class=\"tlogy-title\">基本信息</h5>\r\n        <el-form-item prop=\"materialCateId\" label=\"属性分类：\">\r\n          <el-cascader\r\n            v-if=\"_type == 'add'\"\r\n            class=\"input-w-2\"\r\n            :disabled=\"editDisabled\"\r\n            :options=\"attrClassData\"\r\n            v-model=\"attrCateArr\"\r\n            :value=\"attrCateArr\"\r\n            @change=\"attrCascaderGet\"\r\n            :show-all-levels=\"false\"\r\n            :props=\"props\"\r\n          ></el-cascader>\r\n          <el-select\r\n            v-else\r\n            placeholder=\"请选择\"\r\n            class=\"input-w-2\"\r\n            :disabled=\"editDisabled\"\r\n            :value=\"filtersData.materialCateId\"\r\n            v-model=\"filtersData.materialCateId\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in attrListData\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.id\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item v-if=\"_type != 'add'\" label=\"已选分类：\">\r\n          <div>{{cateNames}}</div>\r\n        </el-form-item>\r\n        <el-form-item :prop=\"_type == 'add'?'productionMaterialCates':''\" label=\"商品分类：\">\r\n          <div class=\"input-w-2\">\r\n            <el-cascader-multi\r\n              v-model=\"cateIdArr\"\r\n              :disabled=\"showDisabled\"\r\n              @change=\"cateChangeGet\"\r\n              :data=\"classData\"\r\n              :only-last=\"true\"\r\n              :clearable=\"true\"\r\n              :is-two-dimension-value=\"false\"\r\n              separator=\"/\"\r\n              value-key=\"id\"\r\n              label-key=\"name\"\r\n              children-key=\"children\"\r\n            ></el-cascader-multi>\r\n          </div>\r\n        </el-form-item>\r\n        <el-form-item prop=\"name\" label=\"工艺名称：\">\r\n          <el-input\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.name\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"unitPrice\" label=\"销售价格：\">\r\n          <el-input\r\n            @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.unitPrice\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"工艺成本：\">\r\n          <el-input\r\n            @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.costPrice\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"image\" label=\"工艺图片：\">\r\n          <el-upload-img\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.image\"\r\n            :EchoDisplayImages=\"productImages\"\r\n            CatalogName=\"product\"\r\n          ></el-upload-img>\r\n        </el-form-item>\r\n        <el-form-item prop=\"valid\" label=\"使用状态：\">\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"true\">使用中</el-radio>\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"false\">未使用</el-radio>\r\n        </el-form-item>\r\n        <el-form-item prop=\"description\" label=\"备注：\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            class=\"input-w-2\"\r\n            autosize\r\n            :disabled=\"showDisabled\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"filtersData.description\"\r\n          ></el-input>\r\n        </el-form-item>\r\n      </div>\r\n      <div class=\"tlogy-footer\">\r\n        <h5 class=\"tlogy-title\">\r\n          互斥规则\r\n          <em>该工艺不能与哪些工艺同时选择</em>\r\n        </h5>\r\n        <el-form-item label=\"互斥工艺：\">\r\n          <el-select\r\n            class=\"input-w-2\"\r\n            placeholder=\"可多选\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"setMutexData\"\r\n            @change=\"setMutexGet\"\r\n            @remove-tag=\"removeTag\"\r\n            multiple\r\n          >\r\n            <el-option v-for=\"item in mutexList\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <div class=\"item-footer\">\r\n          <el-button\r\n            v-if=\"_type == 'add'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >确定</el-button>\r\n          <el-button\r\n            v-else-if=\"_type == 'edit'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >修改</el-button>\r\n          <el-button size=\"small\" @click=\"routerback('filtersForm')\">取消</el-button>\r\n        </div>\r\n      </div>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n<script>\r\nlet mirroringMaterialCates = [];\r\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\r\nimport { numberPrice } from \"@/utils/validate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        type: 1, //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\r\n        materialCateId: \"\",\r\n        name: \"\",\r\n        unitPrice: \"\",\r\n        image: \"\",\r\n        costPrice: null,\r\n        valid: true,\r\n        description: \"\",\r\n        productionMaterialCates: [], //商品分类数组\r\n        productionMaterialExclusions: [] //工艺互斥\r\n      },\r\n      productImages: [], //回显图片\r\n      showDisabled: false,\r\n      editDisabled: false,\r\n      _type: \"\",\r\n      _id: \"\",\r\n      rules: {\r\n        //规则验证\r\n        materialCateId: [\r\n          { required: true, message: \"请选择属性分类\", trigger: \"change\" }\r\n        ],\r\n        productionMaterialCates: [\r\n          { required: true, message: \"请选择商品分类\", trigger: \"change\" }\r\n        ],\r\n        name: [{ required: true, message: \"输入原料名称\", trigger: \"blur\" }],\r\n        unitPrice: [\r\n          { required: true, message: \"请输入销售价格\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      //分类使用\r\n      cateIdArr: [],\r\n      classData: [], // 商品分类树 数据\r\n      listData: [], // 商品 分类 一维数据\r\n      attrClassData: [], //原料分类树数据\r\n      attrListData: [], //原料 一维数据\r\n      attrCateArr: [],\r\n      cateArr: [],\r\n      props: {\r\n        value: \"id\",\r\n        label: \"name\",\r\n        children: \"children\"\r\n      },\r\n      productionMaterialExclusions:[],\r\n      cateNames: \"\",\r\n      mutexList: [],\r\n      setMutexData: [] //获得到的互斥ID 需要做处理\r\n    };\r\n  },\r\n  created() {\r\n    this.getQueryparams();\r\n\r\n    this.getMutexData();\r\n  },\r\n  methods: {\r\n    setNumberPrice(_t) {\r\n      numberPrice(_t);\r\n    },\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      this._type = this.$route.query._type;\r\n      this._id = this.$route.query._id;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n          this.getClassData();\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getEchoDisplayData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getEchoDisplayData();\r\n          break;\r\n      }\r\n    },\r\n    getClassData(_disabledIds) {\r\n      // 获取商品分类  type 1\r\n      this.$common.getClassSelect(this, 1, _disabledIds).then(res => {\r\n        this.classData = res.ztree;\r\n        this.listData = res.list;\r\n      });\r\n      //获取属性分类  type 1\r\n      this.$common.getClassSelect(this, 3).then(res => {\r\n        this.attrClassData = res.ztree;\r\n        this.attrListData = res.list;\r\n      });\r\n    },\r\n    cateChangeGet(e) {\r\n      let careIdArr = this.cateIdArr,\r\n        careIdLen = careIdArr.length;\r\n      let list = this.listData,\r\n        listLen = list.length;\r\n      let categories = [];\r\n      for (let i = 0; i < careIdLen; i++) {\r\n        for (let k = 0; k < listLen; k++) {\r\n          if (careIdArr[i] == list[k].id) {\r\n            categories.push({\r\n              cateId: list[k].id,\r\n              cateName: list[k].name,\r\n              cateIdentifier: list[k].identifier,\r\n              fullCateName: list[k].fullCateName\r\n            });\r\n          }\r\n        }\r\n      }\r\n      this.filtersData.productionMaterialCates = [\r\n        ...categories,\r\n        ...mirroringMaterialCates\r\n      ];\r\n    },\r\n    attrCascaderGet(e) {\r\n      let cateId = JSON.parse(JSON.stringify(e)).pop();\r\n      let obj = this.attrListData.find(item => item.id == cateId);\r\n      this.filtersData.materialCateId = obj.id;\r\n      this.filtersData.materialCateName = obj.name;\r\n      this.filtersData.materialCateIdentifier = obj.identifier;\r\n      this.filtersData.materialFullCateName = obj.fullCateName;\r\n    },\r\n    removeTag(item) {\r\n      if(this._type == 'edit'){\r\n        let exclusions= this.filtersData.productionMaterialExclusions;\r\n        if(exclusions.length >0){\r\n          let flag =false;\r\n          for (let i = 0; i < exclusions.length; i++) {\r\n            if(exclusions[i].exclusionMaterialId == item && exclusions[i].id != null){\r\n                flag=true;\r\n                exclusions[i].status = 9;\r\n            }\r\n          }\r\n          if(!flag){\r\n            let index = exclusions.findIndex((elem) => (elem.exclusionMaterialId ==item));\r\n            if(index != -1){\r\n              this.filtersData.productionMaterialExclusions.splice(index,1)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //互斥处理\r\n    setMutexGet(item) {\r\n      let mutex = this.setMutexData,\r\n          mutexLen = mutex.length;\r\n        let mutexList = this.mutexList,\r\n          mutexListLen = mutexList.length;\r\n        let categories = [];\r\n        for (let i = 0; i < mutexLen; i++) {\r\n          for (let k = 0; k < mutexListLen; k++) {\r\n            if (mutex[i] == mutexList[k].id) {\r\n              categories.push({\r\n                exclusionMaterialId: mutexList[k].id,\r\n                exclusionMaterialName:mutexList[k].name\r\n              });\r\n            }\r\n          }\r\n        }\r\n        if(this._type == 'edit'){\r\n          let exclusions= this.filtersData.productionMaterialExclusions;\r\n          let list =[];\r\n            for (let i = 0; i < categories.length; i++) {\r\n              let flag=false;\r\n              for (let k = 0; k < exclusions.length; k++) {\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId){\r\n                  flag=true;\r\n                }\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId && exclusions[k].id!= null){\r\n                  exclusions[k].status=1;\r\n                }\r\n              }\r\n              if(!flag){\r\n                list.push(categories[i])\r\n              }else{\r\n              }\r\n            }\r\n           this.filtersData.productionMaterialExclusions = [...list,...exclusions];\r\n        }else{\r\n          this.filtersData.productionMaterialExclusions = categories;\r\n        }\r\n    },\r\n    //提交\r\n    submitForm(formName) {\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          let Exclusions = this.filtersData.productionMaterialExclusions;\r\n          for (let i = 0; i < Exclusions.length; i++) {\r\n            Exclusions[i].materialId =\r\n              this.filtersData.id != \"\" ? this.filtersData.id : \"\";\r\n            Exclusions[i].materialName = this.filtersData.name;\r\n          }\r\n          this.request(\r\n            this.api.product.productionMaterial_save,\r\n            this.filtersData\r\n          ).then(res => {\r\n            this.$message.success(\"保存成功\");\r\n            setTimeout(() => {\r\n              this.routerback();\r\n            }, 500);\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n\r\n    //回显\r\n    getEchoDisplayData() {\r\n      this.request(this.api.product.productionMaterial_get, {\r\n        id: this._id\r\n      }).then(res => {\r\n        this.filtersData = res;\r\n        if (!!res.image) {\r\n          this.productImages = [{ url: res.image }];\r\n        }\r\n        this.cateArr = [res.cateId];\r\n        this.attrCateArr = [res.materialCateId];\r\n        let Exclusion = res.productionMaterialExclusions;\r\n        let list = [];\r\n        for (let i = 0; i < Exclusion.length; i++) {\r\n          list.push(Exclusion[i].exclusionMaterialId);\r\n        }\r\n        this.setMutexData = list;\r\n        //回显 商品分类已选置灰\r\n        let arr = [],\r\n          cateIds = [];\r\n        let Categories = res.productionMaterialCates;\r\n        mirroringMaterialCates = [...Categories];\r\n        if (Categories.length > 0) {\r\n          for (let i = 0; i < Categories.length; i++) {\r\n            arr.push(Categories[i].fullCateName); //此处的字段是错误的\r\n            cateIds.push(Categories[i].cateId);\r\n          }\r\n          this.cateNames = arr.join(\"、\");\r\n        }\r\n        this.getClassData(cateIds);\r\n      });\r\n    },\r\n    //互斥\r\n    getMutexData() {\r\n      this.request(this.api.product.productionMaterial_list, {\r\n        type: 1,\r\n        valid: true\r\n      }).then(res => {\r\n        let _data = res.data;\r\n        if(!!this._id){\r\n          for (let i = 0; i < _data.length; i++) {\r\n            if(_data[i].id == this._id){\r\n              _data.splice(i,1)\r\n              break;\r\n            }\r\n          }\r\n          this.mutexList = _data;\r\n        }else{\r\n          this.mutexList = _data;\r\n        }\r\n      });\r\n    },\r\n    //后退\r\n    routerback() {\r\n      this.$router.go(-1);\r\n    }\r\n  },\r\n  components: {\r\n    ElUploadImg\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.tlogy-item {\r\n  background-color: #ffffff;\r\n  margin: 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-footer {\r\n  background-color: #ffffff;\r\n  margin: 0 10px 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-title {\r\n  font-size: 22px;\r\n  height: 50px;\r\n  line-height: 50px;\r\n  text-indent: 40px;\r\n  border-bottom: 1px solid #eeeeee;\r\n  margin-bottom: 20px;\r\n  em {\r\n    margin-left: 20px;\r\n    font-size: 14px;\r\n    color: #ff6677;\r\n  }\r\n}\r\n</style>\r\n"]}]}