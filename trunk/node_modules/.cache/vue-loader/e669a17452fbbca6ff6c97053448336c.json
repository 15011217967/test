{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\market\\discount\\discount_manage_list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\market\\discount\\discount_manage_list.vue","mtime":1574160265399},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport axios from 'axios'\r\nimport {getToken} from '@/utils/auth'\r\nimport codeSet from '@/components/codeSet'\r\nimport treeDept from '@/components/treeDept'\r\nimport { filter } from 'minimatch';\r\nimport { get } from 'http';\r\n\r\nlet token=getToken()\r\n\r\nexport default {\r\n   name:'discount_manage_list',\r\n   data() {\r\n      return{\r\n         // 折扣列表\r\n         discountData:[],\r\n         data_obj:{},\r\n         // 折扣类型\r\n         discountType:[\r\n            '预约折扣',\r\n            '阶梯折扣',\r\n            '单品折扣'\r\n         ],\r\n         // 门店列表\r\n         storeList:{},\r\n         // 检索\r\n         filtersData:{\r\n            pageIndex: 1,// 当前页码\r\n            pageSize: 10,// 每页数量\r\n            type:'',// 门店类型\r\n            storeName:'' // 门店名称\r\n         }\r\n      }\r\n   },\r\n   created() {\r\n      const that = this;\r\n      this.getStoreList();\r\n      this.marketingMiddleground_discountList();// 获取折扣列表\r\n   },\r\n   activated() {\r\n      this.marketingMiddleground_discountList();\r\n   },\r\n   methods: {\r\n      /**\r\n       * 删除折扣\r\n       */\r\n      removeDiscount(item) {\r\n         this.$confirm('确定删除吗？', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning'\r\n         }).then(() => {\r\n            switch(item.type) {\r\n               case 0:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteDiscountSetting,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n               case 1:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteDiscountParameterS,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n               case 2:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteSingleProductDiscount,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n            }\r\n         }).catch(() => {\r\n            this.warn('取消删除!','info');\r\n         });\r\n      },\r\n      /**\r\n       * 查询门店列表\r\n       */\r\n      getStoreList() {\r\n         const that = this;\r\n\r\n         this.request(\r\n         that.api.store.storeBasic_list,\r\n         {\r\n            pricingPower:0\r\n         },\r\n         true\r\n         ).then(res => {\r\n            that.storeList = res;\r\n         });\r\n      },\r\n      /**\r\n       * 提示\r\n       * @param { String } message 提示文案\r\n       * @param { String } type 提示类型\r\n       */\r\n      warn(message, type) {\r\n         this.$message({\r\n         message: message,\r\n         type: type || 'success'\r\n         });\r\n      },\r\n      /**  \r\n       * 编辑\r\n       * @param { Object } item 当前对象\r\n       * @param { Boolean } isRead 是否可对写\r\n       * @property { Boolean }isEcho 是否是编辑\r\n       * @return { Object } Obj 返回对象\r\n       */\r\n      timeRedact(item) {\r\n         var Obj = {};\r\n         this.href('market/discount/discount_order_edit',{\r\n            isEdit:true,\r\n            discountId:item.discountId,\r\n            type:item.type\r\n         })\r\n      },\r\n       /**  \r\n       * 快速创建\r\n       * @param { Object } item 当前对象\r\n       * @param { Boolean } isRead 是否可对写\r\n       * @property { Boolean }isEcho 是否是编辑\r\n       * @return { Object } Obj 返回对象\r\n       */\r\n      fastCreate(item) {\r\n         var Obj = {};\r\n         this.href('market/discount/discount_order_add',{\r\n            isFastCreate:true,\r\n            discountId:item.discountId,\r\n            type:item.type\r\n         })\r\n      },\r\n      /**\r\n       * 获取折扣列表\r\n       */\r\n      marketingMiddleground_discountList() {\r\n         this.request(\r\n            this.api.market.marketingMiddleground_discountList,\r\n            this.filtersData     \r\n         ).then(res => {\r\n            this.discountData = res;\r\n         });\r\n      },\r\n      /**\r\n       * 跳转工单详情\r\n       */\r\n      href(routeName, param) {\r\n         this.$router.push({\r\n            path: '/' + routeName,\r\n            query: param\r\n         })\r\n      },\r\n      /**\r\n       * 模糊搜索\r\n       */\r\n      handleSearch() {\r\n         this.filtersData.pageIndex = 1;\r\n         this.filtersData.storeName = this.filtersData.storeName.replace(/(^\\s)|(\\s$)/g, '');\r\n         this.marketingMiddleground_discountList();\r\n      },\r\n      /**\r\n       * 搜索重置\r\n       */\r\n      handleResetFilters() {\r\n         Object.assign(this.filtersData,{\r\n            pageIndex: 1,// 当前页码\r\n            pageSize: 10,// 每页数量\r\n            type:'',// 门店类型\r\n            storeName:'' // 门店名称\r\n         });\r\n      },\r\n      /**\r\n       * 点击页数\r\n       * @param { Number } pageIndex 当前页\r\n       */\r\n      handleCurrentChange(pageIndex){\r\n         this.filtersData.pageIndex = pageIndex;\r\n         this.marketingMiddleground_discountList();\r\n      },\r\n      /**\r\n       *  选择每页多少条数\r\n       *  @param { Number } pageSize 每页条数\r\n       */\r\n      handleSizeChange(pageSize){\r\n         this.filtersData.pageSize = pageSize;  \r\n         this.marketingMiddleground_discountList();\r\n      },\r\n   },\r\n   components:{\r\n      codeSet,\r\n      treeDept\r\n   },\r\n}\r\n",{"version":3,"sources":["discount_manage_list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"discount_manage_list.vue","sourceRoot":"src/views/market/discount","sourcesContent":["<template>\r\n   <div>\r\n      <!-- 模糊搜索 -->\r\n      <div class=\"item-margin\">\r\n         <el-form\r\n            class=\"item-form\"\r\n            size=\"small\"\r\n            :inline=\"true\"\r\n            :model=\"filtersData\">\r\n            <!-- 模糊查询 -->\r\n            <el-form-item label=\"折扣类型：\">\r\n               <el-select v-model=\"filtersData.type\" clearable placeholder=\"请选择\">\r\n                  <el-option v-for=\"(item, index) in discountType\" :key=\"index\" :label=\"item\" :value=\"index\"></el-option>\r\n               </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"适用门店：\" prop=\"storeId\">\r\n               <el-select \r\n               clearable \r\n               filterable \r\n               v-model=\"filtersData.storeName\" \r\n               class=\"el-input-short\">\r\n               <el-option v-for=\"(item, index) in storeList.data\" :key=\"index\" :label=\"item.name\" :value=\"item.name\"></el-option>\r\n               </el-select>\r\n            </el-form-item>\r\n            <!-- 搜索，重置 -->\r\n            <el-form-item>\r\n               <el-button size=\"small\" @click=\"handleSearch\" type=\"primary\" plain>搜索</el-button>\r\n               <el-button size=\"small\" @click=\"handleResetFilters\">重置</el-button>\r\n            </el-form-item>\r\n         </el-form>\r\n      </div>\r\n      <!-- 模糊搜索 -->\r\n      <!-- 列表 -->\r\n      <div class=\"box\">\r\n         <el-button size=\"small\" type=\"primary\" class=\"ml-20 mt-24\" @click=\"href('market/discount/discount_order_add')\">创建折扣</el-button>\r\n         <el-table\r\n               class=\"mt-20\"\r\n            :data=\"discountData.data\"\r\n            stripe\r\n            empty-text=\"暂无数据\"\r\n            header-align=\"center\"\r\n            header-row-class-name=\"item-table-header\"\r\n            :highlight-current-row=\"true\">\r\n            <el-table-column prop=\"\" align=\"center\" :show-overflow-tooltip=\"true\" label=\"折扣类型\" min-width=\"100\">\r\n               <template  slot-scope=\"scope\">{{ discountType[scope.row.type] }}</template>\r\n            </el-table-column>\r\n               <el-table-column prop=\"\" align=\"center\" :show-overflow-tooltip=\"true\" label=\"折扣力度\" min-width=\"100\">\r\n               <template  slot-scope=\"scope\">{{ scope.row.discountValueStr }}</template>\r\n            </el-table-column>\r\n               <el-table-column prop=\"\" align=\"center\" :show-overflow-tooltip=\"true\" label=\"适用门店\" min-width=\"100\">\r\n               <template  slot-scope=\"scope\">{{ scope.row.storeName  }}</template>\r\n            </el-table-column>\r\n               <el-table-column prop=\"\" align=\"center\" :show-overflow-tooltip=\"true\" label=\"适用范围\" min-width=\"100\">\r\n               <template  slot-scope=\"scope\">{{ scope.row.scope  }}</template>\r\n            </el-table-column>\r\n            <!-- 操作 -->\r\n            <el-table-column\r\n               fixed=\"right\"\r\n               label-class-name=\"text-center\"\r\n               class-name=\"text-center\"\r\n               align=\"center\"\r\n               label=\"操作\"\r\n               width=\"180\">\r\n               <template slot-scope=\"scope\">\r\n                  <el-button type=\"text\" size=\"small\" @click=\"fastCreate(scope.row)\">快速创建</el-button>\r\n                  <el-button type=\"text\" size=\"small\" @click=\"timeRedact(scope.row)\">修改</el-button>\r\n                  <el-button type=\"text\" size=\"small\" @click=\"removeDiscount(scope.row)\">删除</el-button>\r\n               </template>\r\n            </el-table-column>\r\n         </el-table>\r\n         <div class=\"pagination mt-10 mb-20\">\r\n            <!-- 分页 -->\r\n            <el-pagination\r\n               class=\"mr-20\"\r\n               @size-change=\"handleSizeChange\"\r\n               @current-change=\"handleCurrentChange\"\r\n               :current-page=\"filtersData.pageIndex\"\r\n               :page-sizes=\"[10,20,30,40,50]\"\r\n               :page-size=\"filtersData.pageSize\"\r\n               layout=\"total, sizes, prev, pager, next, jumper\"\r\n               :total=\"discountData.totalCount\"\r\n            ></el-pagination>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</template>\r\n<!-- 工单池 -->\r\n<script>\r\nimport axios from 'axios'\r\nimport {getToken} from '@/utils/auth'\r\nimport codeSet from '@/components/codeSet'\r\nimport treeDept from '@/components/treeDept'\r\nimport { filter } from 'minimatch';\r\nimport { get } from 'http';\r\n\r\nlet token=getToken()\r\n\r\nexport default {\r\n   name:'discount_manage_list',\r\n   data() {\r\n      return{\r\n         // 折扣列表\r\n         discountData:[],\r\n         data_obj:{},\r\n         // 折扣类型\r\n         discountType:[\r\n            '预约折扣',\r\n            '阶梯折扣',\r\n            '单品折扣'\r\n         ],\r\n         // 门店列表\r\n         storeList:{},\r\n         // 检索\r\n         filtersData:{\r\n            pageIndex: 1,// 当前页码\r\n            pageSize: 10,// 每页数量\r\n            type:'',// 门店类型\r\n            storeName:'' // 门店名称\r\n         }\r\n      }\r\n   },\r\n   created() {\r\n      const that = this;\r\n      this.getStoreList();\r\n      this.marketingMiddleground_discountList();// 获取折扣列表\r\n   },\r\n   activated() {\r\n      this.marketingMiddleground_discountList();\r\n   },\r\n   methods: {\r\n      /**\r\n       * 删除折扣\r\n       */\r\n      removeDiscount(item) {\r\n         this.$confirm('确定删除吗？', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning'\r\n         }).then(() => {\r\n            switch(item.type) {\r\n               case 0:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteDiscountSetting,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n               case 1:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteDiscountParameterS,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n               case 2:\r\n                  this.request(\r\n                     this.api.market.marketingMiddleground_deleteSingleProductDiscount,\r\n                     {\r\n                        id:item.discountId\r\n                     }     \r\n                  ).then(res => {\r\n                     this.marketingMiddleground_discountList();\r\n                     this.warn('删除成功!');\r\n                  });\r\n                  break;\r\n            }\r\n         }).catch(() => {\r\n            this.warn('取消删除!','info');\r\n         });\r\n      },\r\n      /**\r\n       * 查询门店列表\r\n       */\r\n      getStoreList() {\r\n         const that = this;\r\n\r\n         this.request(\r\n         that.api.store.storeBasic_list,\r\n         {\r\n            pricingPower:0\r\n         },\r\n         true\r\n         ).then(res => {\r\n            that.storeList = res;\r\n         });\r\n      },\r\n      /**\r\n       * 提示\r\n       * @param { String } message 提示文案\r\n       * @param { String } type 提示类型\r\n       */\r\n      warn(message, type) {\r\n         this.$message({\r\n         message: message,\r\n         type: type || 'success'\r\n         });\r\n      },\r\n      /**  \r\n       * 编辑\r\n       * @param { Object } item 当前对象\r\n       * @param { Boolean } isRead 是否可对写\r\n       * @property { Boolean }isEcho 是否是编辑\r\n       * @return { Object } Obj 返回对象\r\n       */\r\n      timeRedact(item) {\r\n         var Obj = {};\r\n         this.href('market/discount/discount_order_edit',{\r\n            isEdit:true,\r\n            discountId:item.discountId,\r\n            type:item.type\r\n         })\r\n      },\r\n       /**  \r\n       * 快速创建\r\n       * @param { Object } item 当前对象\r\n       * @param { Boolean } isRead 是否可对写\r\n       * @property { Boolean }isEcho 是否是编辑\r\n       * @return { Object } Obj 返回对象\r\n       */\r\n      fastCreate(item) {\r\n         var Obj = {};\r\n         this.href('market/discount/discount_order_add',{\r\n            isFastCreate:true,\r\n            discountId:item.discountId,\r\n            type:item.type\r\n         })\r\n      },\r\n      /**\r\n       * 获取折扣列表\r\n       */\r\n      marketingMiddleground_discountList() {\r\n         this.request(\r\n            this.api.market.marketingMiddleground_discountList,\r\n            this.filtersData     \r\n         ).then(res => {\r\n            this.discountData = res;\r\n         });\r\n      },\r\n      /**\r\n       * 跳转工单详情\r\n       */\r\n      href(routeName, param) {\r\n         this.$router.push({\r\n            path: '/' + routeName,\r\n            query: param\r\n         })\r\n      },\r\n      /**\r\n       * 模糊搜索\r\n       */\r\n      handleSearch() {\r\n         this.filtersData.pageIndex = 1;\r\n         this.filtersData.storeName = this.filtersData.storeName.replace(/(^\\s)|(\\s$)/g, '');\r\n         this.marketingMiddleground_discountList();\r\n      },\r\n      /**\r\n       * 搜索重置\r\n       */\r\n      handleResetFilters() {\r\n         Object.assign(this.filtersData,{\r\n            pageIndex: 1,// 当前页码\r\n            pageSize: 10,// 每页数量\r\n            type:'',// 门店类型\r\n            storeName:'' // 门店名称\r\n         });\r\n      },\r\n      /**\r\n       * 点击页数\r\n       * @param { Number } pageIndex 当前页\r\n       */\r\n      handleCurrentChange(pageIndex){\r\n         this.filtersData.pageIndex = pageIndex;\r\n         this.marketingMiddleground_discountList();\r\n      },\r\n      /**\r\n       *  选择每页多少条数\r\n       *  @param { Number } pageSize 每页条数\r\n       */\r\n      handleSizeChange(pageSize){\r\n         this.filtersData.pageSize = pageSize;  \r\n         this.marketingMiddleground_discountList();\r\n      },\r\n   },\r\n   components:{\r\n      codeSet,\r\n      treeDept\r\n   },\r\n}\r\n</script>\r\n<style  lang=\"less\" scoped>\r\n   .previewVisible-list{\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      .item{\r\n         width: 50%;\r\n         margin-right: 0;\r\n         text-align: right;\r\n      }\r\n   }\r\n   .blueness{  \r\n      color: #1E90FF;\r\n   }\r\n   h5 {\r\n     color: #222;\r\n     margin-left: -15px;\r\n   }\r\n   .test {\r\n     color: #9d9d9d;\r\n   }\r\n   .box{\r\n    padding: 20px 20px 20px 20px;\r\n    margin: 8px 8px 20px 8px;\r\n    background: #fff;\r\n  }\r\n</style>\r\n"]}]}