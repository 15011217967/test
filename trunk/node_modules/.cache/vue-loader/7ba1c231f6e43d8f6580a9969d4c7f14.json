{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\supplier_support_details.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\supplier_support_details.vue","mtime":1572415124053},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\n/**\r\n *制造商支持 新增 修改 查看 同一页面\r\n */\r\nimport MaterialDialog from \"@/components/customAttribute/material_dialog\";\r\nimport ReadyDadeDialog from \"@/components/customAttribute/ready_made_dialog\";\r\nimport TechnologyDialog from \"@/components/customAttribute/technology_dialog\";\r\n\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        cateIdentifier: \"\",\r\n        manufacturerMeasurements: [], //制造商量体数据\r\n        manufacturerProductionMaterials: [] //制造商原料数据\r\n      },\r\n      //标签切换默认\r\n      activeName: \"material\",\r\n      rules: {\r\n        //规则验证\r\n        code: [\r\n          { required: true, message: \"请选择品牌编码\", trigger: \"change\" }\r\n        ],\r\n        name: [{ required: true, message: \"请选择品牌名称\", trigger: \"blur\" }],\r\n        type: [{ required: true, message: \"请选择品牌分类\", trigger: \"blur\" }]\r\n      },\r\n      editDisabled: false,\r\n      showDisabled: false,\r\n      materialTableListData: [], //原料数据\r\n      technologyTableListData: [], //工艺数据\r\n      readyMadeTableListData: [], //成品数据\r\n      _type: \"\",\r\n      _id: \"\"\r\n    };\r\n  },\r\n  created() {\r\n    //获取上页面传参\r\n    this.getQueryparams();\r\n  },\r\n  methods: {\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      let params = this.$route.query;\r\n      this._type = params._type;\r\n      this._id = params.id;\r\n      this.filtersData.cateId = params.cateId;\r\n      this.filtersData.cateName = params.cateName;\r\n      this.filtersData.cateIdentifier = params.cateIdentifier;\r\n      this.filtersData.fullCateName = params.fullCateName;\r\n      this.filtersData.manufacturerName = params.manufacturerName;\r\n      this.filtersData.manufacturerId = params.manufacturerId;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getData();\r\n          break;\r\n      }\r\n    },\r\n    //获取数据\r\n    getData() {\r\n      this.request(this.api.product.manufacturerProductionInformation_get, {\r\n        id: this._id\r\n      }).then(data => {\r\n        let _data = data;\r\n        this.filtersData =JSON.parse(JSON.stringify(_data));\r\n        //循环找到原料工艺列表数据\r\n        let Materials = _data.manufacturerProductionMaterials;\r\n        let materialsTable = [],\r\n          technologyTable = [];\r\n        for (let i = 0; i < Materials.length; i++) {\r\n          if (Materials[i].type == 2) {\r\n            materialsTable.push(Materials[i]);\r\n          } else {\r\n            technologyTable.push(Materials[i]);\r\n          }\r\n        }\r\n        //回显列表数据；\r\n        this.materialTableListData = materialsTable;\r\n        this.technologyTableListData = technologyTable;\r\n        this.readyMadeTableListData = _data.manufacturerMeasurements;\r\n      });\r\n    },\r\n    //新增\r\n    submitAndEditForm() {\r\n      if (this.materialTableListData.length <= 0) {\r\n        this.$message.error(\"原料数据不能为空\");\r\n        this.activeName = \"material\";\r\n        return false;\r\n      }\r\n      if (this.technologyTableListData.length <= 0) {\r\n        this.$message.error(\"工艺数据不能为空\");\r\n        this.activeName = \"technology\";\r\n        return false;\r\n      }\r\n      if (this.readyMadeTableListData.length <= 0) {\r\n        this.$message.error(\"成品数据不能为空\");\r\n        this.activeName = \"readyMade\";\r\n        return false;\r\n      }\r\n      //处理量体\r\n      let filters = JSON.parse(JSON.stringify(this.filtersData));\r\n      let manufacturer = this.setSubmitData(this.readyMadeTableListData);\r\n      filters.manufacturerMeasurements = manufacturer;\r\n      let material = this.setSubmitData(this.materialTableListData, 2);\r\n      let technology = this.setSubmitData(this.technologyTableListData, 1);\r\n      filters.manufacturerProductionMaterials = [...material, ...technology];\r\n      if (this._type == \"edit\") {\r\n        let mirrorFilters =JSON.parse(JSON.stringify(this.filtersData));\r\n        //镜像原料工艺\r\n        let mirrorMT = mirrorFilters.manufacturerProductionMaterials;\r\n        //镜像成衣数据项\r\n        let mirrorMR = mirrorFilters.manufacturerMeasurements;\r\n        //原料工艺\r\n        let MT = filters.manufacturerProductionMaterials;\r\n        //成衣数据项\r\n        let MR = filters.manufacturerMeasurements;\r\n        let deleteMT = [],\r\n          deleteMr = [];\r\n        for (let i = 0; i < mirrorMT.length; i++) {\r\n          let flag = false;\r\n          for (let k = 0; k < MT.length; k++) {\r\n            if (\r\n              mirrorMT[i].materialId == MT[k].materialId &&\r\n              MT[k].id != null\r\n            ) {\r\n              flag = true;\r\n            }\r\n          }\r\n          if (!flag) {\r\n            //此处是已删除的数据 但不正确 还要知道当前数据是不是删除后又新增的\r\n            mirrorMT[i].status = 9;\r\n            deleteMT.push(mirrorMT[i]);\r\n          }\r\n        }\r\n        for (let i = 0; i < mirrorMR.length; i++) {\r\n          let flag = false;\r\n          for (let k = 0; k < MR.length; k++) {\r\n            if (\r\n              mirrorMR[i].measurementId == MR[k].measurementId &&\r\n              MR[k].id != null\r\n            ) {\r\n              flag = true;\r\n            }\r\n          }\r\n          if (!flag) {\r\n            //此处是已删除的数据 但不正确 还要知道当前数据是不是删除后又新增的\r\n            mirrorMR[i].status = 9;\r\n            deleteMr.push(mirrorMR[i]);\r\n          }\r\n        }\r\n        filters.manufacturerProductionMaterials = [...MT, ...deleteMT];\r\n        filters.manufacturerMeasurements = [...MR, ...deleteMr];\r\n      }\r\n      this.request(\r\n        this.api.product.manufacturerProductionInformation_save,\r\n        filters\r\n      ).then(data => {\r\n        this.$message.success(\"保存成功\");\r\n        setTimeout(() => {\r\n          this.routerback();\r\n        }, 500);\r\n      });\r\n    },\r\n    setSubmitData(list, type) {\r\n      let params = this.filtersData;\r\n      for (let i = 0; i < list.length; i++) {\r\n        list[i].cateId = params.cateId;\r\n        list[i].cateName = params.cateName;\r\n        list[i].cateIdentifier = params.cateIdentifier;\r\n        list[i].fullCateName = params.fullCateName;\r\n        list[i].manufacturerName = params.manufacturerName;\r\n        list[i].manufacturerId = params.manufacturerId;\r\n        if (type) {\r\n          list[i].type = type;\r\n        }\r\n      }\r\n      return list;\r\n    },\r\n    /**添加原料\r\n     * 判断当前状态是修改还是新增\r\n     * 当状态是修改时 把数据做个镜像发进去\r\n     * 子级处理好的返回父级\r\n     */\r\n    openAddMaterial() {\r\n      this.$refs.materialDialog.popupInit(\r\n        this.filtersData.cateIdentifier,\r\n        \"edit\",\r\n        [...this.materialTableListData]\r\n      );\r\n    },\r\n    //原料添加成功后返回的数据\r\n    getSubMaterialList(list) {\r\n      this.materialTableListData = list;\r\n    },\r\n    //添加工艺\r\n    openAddTechnology() {\r\n      this.$refs.technologyDialog.popupInit(\r\n        this.filtersData.cateIdentifier,\r\n        \"edit\",\r\n        [...this.technologyTableListData]\r\n      );\r\n    },\r\n    getSubTechnologyList(list) {\r\n      this.technologyTableListData = list;\r\n    },\r\n    //添加成衣数据\r\n    openAddReadyMade() {\r\n      this.$refs.readymadeDialog.popupInit(\r\n        this.filtersData.cateId,\r\n        \"edit\",\r\n        [...this.readyMadeTableListData]\r\n      );\r\n    },\r\n    getSubReadyMadeList(list) {\r\n      this.readyMadeTableListData = list;\r\n    },\r\n    //统一删除\r\n    removeTableItem(cateName, row) {\r\n      switch (cateName) {\r\n        case \"material\":\r\n          this.deleteList(cateName, this.materialTableListData, row);\r\n          break;\r\n        case \"technology\":\r\n          this.deleteList(cateName, this.technologyTableListData, row);\r\n          break;\r\n        default:\r\n          //readyMade\r\n          this.deleteList(cateName, this.readyMadeTableListData, row);\r\n          break;\r\n      }\r\n    },\r\n    deleteList(cateName, list, row) {\r\n      let index = -1;\r\n      if (cateName == \"readyMade\") {\r\n        index = list.findIndex(item => item.measurementId == row.measurementId);\r\n      } else {\r\n        index = list.findIndex(item => item.materialId == row.materialId);\r\n      }\r\n      if (index != -1) {\r\n        list.splice(index, 1);\r\n      }\r\n    },\r\n    //后退\r\n    routerback() {\r\n      if (this._type == \"edit\") {\r\n        this.$router.go(-1);\r\n      } else if (this._type == \"add\") {\r\n        this.$router.go(-2);\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    }\r\n  },\r\n  components: {\r\n    [MaterialDialog.name]: MaterialDialog,\r\n    [ReadyDadeDialog.name]: ReadyDadeDialog,\r\n    [TechnologyDialog.name]: TechnologyDialog\r\n  }\r\n};\r\n",{"version":3,"sources":["supplier_support_details.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwMA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"supplier_support_details.vue","sourceRoot":"src/views/product/custom_attrs","sourcesContent":["<template>\r\n  <div class=\"bg-fff item-margin\">\r\n    <el-form\r\n      class=\"item-form\"\r\n      :rules=\"rules\"\r\n      :model=\"filtersData\"\r\n      label-width=\"100px\"\r\n      size=\"small\"\r\n      ref=\"filtersForm\"\r\n      inline\r\n    >\r\n      <el-row>\r\n        <el-tabs v-model=\"activeName\" class=\"basic-wrap\">\r\n          <el-tab-pane label=\"支持原料\" name=\"material\">\r\n            <!-- 原料table -->\r\n            <div class=\"item-cont\">\r\n              <el-button size=\"small\" :disabled=\"showDisabled\" @click=\"openAddMaterial\">添加原料</el-button>\r\n              <span class=\"item-sub-title\">\r\n                已选&nbsp;\r\n                <em>{{materialTableListData.length}}</em>&nbsp;项原料\r\n              </span>\r\n            </div>\r\n            <div class=\"item-table\">\r\n              <el-table\r\n                :data=\"materialTableListData\"\r\n                stripe\r\n                empty-text=\"暂无数据\"\r\n                header-align=\"center\"\r\n                header-row-class-name=\"item-table-header\"\r\n                :highlight-current-row=\"true\"\r\n              >\r\n                <el-table-column prop=\"code\" align=\"center\" label=\"标准编码\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"name\" align=\"center\" label=\"属性名称\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"materialCateName\" align=\"center\" label=\"分类\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"image\" align=\"center\" label=\"图片\" width=\"80\">\r\n                  <template slot-scope=\"scope\">\r\n                    <img class=\"table-img-wh\" :src=\"scope.row.image\" alt>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"unitPrice\" align=\"center\" label=\"销售价格\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"sourceCode\" align=\"center\" label=\"外部编码\" min-width=\"120\">\r\n                  <template slot-scope=\"scope\">\r\n                    <el-input\r\n                      :disabled=\"showDisabled\"\r\n                      v-model=\"scope.row.sourceCode\"\r\n                      placeholder=\"请输入\"\r\n                    ></el-input>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                  fixed=\"right\"\r\n                  label-class-name=\"text-center\"\r\n                  class-name=\"text-center\"\r\n                  align=\"center\"\r\n                  label=\"操作\"\r\n                  width=\"50\"\r\n                >\r\n                  <template slot-scope=\"scope\">\r\n                    <el-button\r\n                      v-if=\"_type != 'show'\"\r\n                      @click=\"removeTableItem('material',scope.row)\"\r\n                      type=\"text\"\r\n                      size=\"small\"\r\n                    >删除</el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n            <!-- 原料table end  -->\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"支持工艺\" name=\"technology\">\r\n            <!-- 工艺table  -->\r\n            <div class=\"item-cont\">\r\n              <el-button size=\"small\" :disabled=\"showDisabled\" @click=\"openAddTechnology\">添加工艺</el-button>\r\n              <span class=\"item-sub-title\">\r\n                已选&nbsp;\r\n                <em>{{technologyTableListData.length}}</em>&nbsp;项工艺\r\n              </span>\r\n            </div>\r\n            <div class=\"item-table\">\r\n              <el-table\r\n                :data=\"technologyTableListData\"\r\n                stripe\r\n                empty-text=\"暂无数据\"\r\n                header-align=\"center\"\r\n                header-row-class-name=\"item-table-header\"\r\n                :highlight-current-row=\"true\"\r\n              >\r\n                <el-table-column prop=\"code\" align=\"center\" label=\"标准编码\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"materialCateName\" align=\"center\" label=\"分类\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"name\" align=\"center\" label=\"原料名称\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"image\" align=\"center\" label=\"图片\" width=\"80\">\r\n                  <template slot-scope=\"scope\">\r\n                    <img class=\"table-img-wh\" :src=\"scope.row.image\" alt>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"unitPrice\" align=\"center\" label=\"销售价格\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"sourceCode\" align=\"center\" label=\"外部编码\" min-width=\"120\">\r\n                  <template slot-scope=\"scope\">\r\n                    <el-input\r\n                      :disabled=\"showDisabled\"\r\n                      v-model=\"scope.row.sourceCode\"\r\n                      placeholder=\"请输入\"\r\n                    ></el-input>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                  fixed=\"right\"\r\n                  label-class-name=\"text-center\"\r\n                  class-name=\"text-center\"\r\n                  align=\"center\"\r\n                  label=\"操作\"\r\n                  width=\"50\"\r\n                >\r\n                  <template slot-scope=\"scope\">\r\n                    <el-button\r\n                      v-if=\"_type != 'show'\"\r\n                      @click=\"removeTableItem('technology',scope.row)\"\r\n                      type=\"text\"\r\n                      size=\"small\"\r\n                    >删除</el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n            <!-- 工艺table   End-->\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"成衣数据项\" name=\"readyMade\">\r\n            <!-- 成衣table  -->\r\n            <div class=\"item-cont\">\r\n              <el-button size=\"small\" :disabled=\"showDisabled\" @click=\"openAddReadyMade\">添加成衣测量项</el-button>\r\n              <span class=\"item-sub-title\">\r\n                已选&nbsp;\r\n                <em>{{readyMadeTableListData.length}}</em>&nbsp;项测量项\r\n              </span>\r\n            </div>\r\n            <div class=\"item-table\">\r\n              <el-table\r\n                :data=\"readyMadeTableListData\"\r\n                stripe\r\n                empty-text=\"暂无数据\"\r\n                header-align=\"center\"\r\n                header-row-class-name=\"item-table-header\"\r\n                :highlight-current-row=\"true\"\r\n              >\r\n                <el-table-column prop=\"name\" align=\"center\" label=\"名称\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"fullCateName\" align=\"center\" label=\"分类\" min-width=\"100\"></el-table-column>\r\n                <el-table-column prop=\"image\" align=\"center\" label=\"图片\" min-width=\"80\">\r\n                  <template slot-scope=\"scope\">\r\n                    <img class=\"table-img-wh\" :src=\"scope.row.image\" alt>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                  fixed=\"right\"\r\n                  label-class-name=\"text-center\"\r\n                  class-name=\"text-center\"\r\n                  align=\"center\"\r\n                  label=\"操作\"\r\n                  width=\"50\"\r\n                >\r\n                  <template slot-scope=\"scope\">\r\n                    <el-button\r\n                      v-if=\"_type != 'show'\"\r\n                      @click=\"removeTableItem('readyMade',scope.row)\"\r\n                      type=\"text\"\r\n                      size=\"small\"\r\n                    >删除</el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n            <!-- 成衣table   End-->\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-row>\r\n    </el-form>\r\n    <div class=\"item-footer\">\r\n      <el-button\r\n        v-if=\"this._type == 'add'\"\r\n        size=\"small\"\r\n        @click=\"submitAndEditForm()\"\r\n        type=\"primary\"\r\n      >确认新增</el-button>\r\n      <el-button\r\n        v-else-if=\"this._type == 'edit'\"\r\n        size=\"small\"\r\n        @click=\"submitAndEditForm()\"\r\n        type=\"primary\"\r\n      >修改</el-button>\r\n      <el-button size=\"small\" @click=\"routerback()\">取消</el-button>\r\n    </div>\r\n    <!-- 原料 -->\r\n    <tp-material-dialog @setParentMaterialData=\"getSubMaterialList\" ref=\"materialDialog\"></tp-material-dialog>\r\n    <!-- 工艺 -->\r\n    <tp-technology-dialog @setParentTechnologyData=\"getSubTechnologyList\" ref=\"technologyDialog\"></tp-technology-dialog>\r\n    <!-- 成衣数据 -->\r\n    <tp-readymade-dialog @setParentReadyMadeData=\"getSubReadyMadeList\" ref=\"readymadeDialog\"></tp-readymade-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\n/**\r\n *制造商支持 新增 修改 查看 同一页面\r\n */\r\nimport MaterialDialog from \"@/components/customAttribute/material_dialog\";\r\nimport ReadyDadeDialog from \"@/components/customAttribute/ready_made_dialog\";\r\nimport TechnologyDialog from \"@/components/customAttribute/technology_dialog\";\r\n\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        cateIdentifier: \"\",\r\n        manufacturerMeasurements: [], //制造商量体数据\r\n        manufacturerProductionMaterials: [] //制造商原料数据\r\n      },\r\n      //标签切换默认\r\n      activeName: \"material\",\r\n      rules: {\r\n        //规则验证\r\n        code: [\r\n          { required: true, message: \"请选择品牌编码\", trigger: \"change\" }\r\n        ],\r\n        name: [{ required: true, message: \"请选择品牌名称\", trigger: \"blur\" }],\r\n        type: [{ required: true, message: \"请选择品牌分类\", trigger: \"blur\" }]\r\n      },\r\n      editDisabled: false,\r\n      showDisabled: false,\r\n      materialTableListData: [], //原料数据\r\n      technologyTableListData: [], //工艺数据\r\n      readyMadeTableListData: [], //成品数据\r\n      _type: \"\",\r\n      _id: \"\"\r\n    };\r\n  },\r\n  created() {\r\n    //获取上页面传参\r\n    this.getQueryparams();\r\n  },\r\n  methods: {\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      let params = this.$route.query;\r\n      this._type = params._type;\r\n      this._id = params.id;\r\n      this.filtersData.cateId = params.cateId;\r\n      this.filtersData.cateName = params.cateName;\r\n      this.filtersData.cateIdentifier = params.cateIdentifier;\r\n      this.filtersData.fullCateName = params.fullCateName;\r\n      this.filtersData.manufacturerName = params.manufacturerName;\r\n      this.filtersData.manufacturerId = params.manufacturerId;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getData();\r\n          break;\r\n      }\r\n    },\r\n    //获取数据\r\n    getData() {\r\n      this.request(this.api.product.manufacturerProductionInformation_get, {\r\n        id: this._id\r\n      }).then(data => {\r\n        let _data = data;\r\n        this.filtersData =JSON.parse(JSON.stringify(_data));\r\n        //循环找到原料工艺列表数据\r\n        let Materials = _data.manufacturerProductionMaterials;\r\n        let materialsTable = [],\r\n          technologyTable = [];\r\n        for (let i = 0; i < Materials.length; i++) {\r\n          if (Materials[i].type == 2) {\r\n            materialsTable.push(Materials[i]);\r\n          } else {\r\n            technologyTable.push(Materials[i]);\r\n          }\r\n        }\r\n        //回显列表数据；\r\n        this.materialTableListData = materialsTable;\r\n        this.technologyTableListData = technologyTable;\r\n        this.readyMadeTableListData = _data.manufacturerMeasurements;\r\n      });\r\n    },\r\n    //新增\r\n    submitAndEditForm() {\r\n      if (this.materialTableListData.length <= 0) {\r\n        this.$message.error(\"原料数据不能为空\");\r\n        this.activeName = \"material\";\r\n        return false;\r\n      }\r\n      if (this.technologyTableListData.length <= 0) {\r\n        this.$message.error(\"工艺数据不能为空\");\r\n        this.activeName = \"technology\";\r\n        return false;\r\n      }\r\n      if (this.readyMadeTableListData.length <= 0) {\r\n        this.$message.error(\"成品数据不能为空\");\r\n        this.activeName = \"readyMade\";\r\n        return false;\r\n      }\r\n      //处理量体\r\n      let filters = JSON.parse(JSON.stringify(this.filtersData));\r\n      let manufacturer = this.setSubmitData(this.readyMadeTableListData);\r\n      filters.manufacturerMeasurements = manufacturer;\r\n      let material = this.setSubmitData(this.materialTableListData, 2);\r\n      let technology = this.setSubmitData(this.technologyTableListData, 1);\r\n      filters.manufacturerProductionMaterials = [...material, ...technology];\r\n      if (this._type == \"edit\") {\r\n        let mirrorFilters =JSON.parse(JSON.stringify(this.filtersData));\r\n        //镜像原料工艺\r\n        let mirrorMT = mirrorFilters.manufacturerProductionMaterials;\r\n        //镜像成衣数据项\r\n        let mirrorMR = mirrorFilters.manufacturerMeasurements;\r\n        //原料工艺\r\n        let MT = filters.manufacturerProductionMaterials;\r\n        //成衣数据项\r\n        let MR = filters.manufacturerMeasurements;\r\n        let deleteMT = [],\r\n          deleteMr = [];\r\n        for (let i = 0; i < mirrorMT.length; i++) {\r\n          let flag = false;\r\n          for (let k = 0; k < MT.length; k++) {\r\n            if (\r\n              mirrorMT[i].materialId == MT[k].materialId &&\r\n              MT[k].id != null\r\n            ) {\r\n              flag = true;\r\n            }\r\n          }\r\n          if (!flag) {\r\n            //此处是已删除的数据 但不正确 还要知道当前数据是不是删除后又新增的\r\n            mirrorMT[i].status = 9;\r\n            deleteMT.push(mirrorMT[i]);\r\n          }\r\n        }\r\n        for (let i = 0; i < mirrorMR.length; i++) {\r\n          let flag = false;\r\n          for (let k = 0; k < MR.length; k++) {\r\n            if (\r\n              mirrorMR[i].measurementId == MR[k].measurementId &&\r\n              MR[k].id != null\r\n            ) {\r\n              flag = true;\r\n            }\r\n          }\r\n          if (!flag) {\r\n            //此处是已删除的数据 但不正确 还要知道当前数据是不是删除后又新增的\r\n            mirrorMR[i].status = 9;\r\n            deleteMr.push(mirrorMR[i]);\r\n          }\r\n        }\r\n        filters.manufacturerProductionMaterials = [...MT, ...deleteMT];\r\n        filters.manufacturerMeasurements = [...MR, ...deleteMr];\r\n      }\r\n      this.request(\r\n        this.api.product.manufacturerProductionInformation_save,\r\n        filters\r\n      ).then(data => {\r\n        this.$message.success(\"保存成功\");\r\n        setTimeout(() => {\r\n          this.routerback();\r\n        }, 500);\r\n      });\r\n    },\r\n    setSubmitData(list, type) {\r\n      let params = this.filtersData;\r\n      for (let i = 0; i < list.length; i++) {\r\n        list[i].cateId = params.cateId;\r\n        list[i].cateName = params.cateName;\r\n        list[i].cateIdentifier = params.cateIdentifier;\r\n        list[i].fullCateName = params.fullCateName;\r\n        list[i].manufacturerName = params.manufacturerName;\r\n        list[i].manufacturerId = params.manufacturerId;\r\n        if (type) {\r\n          list[i].type = type;\r\n        }\r\n      }\r\n      return list;\r\n    },\r\n    /**添加原料\r\n     * 判断当前状态是修改还是新增\r\n     * 当状态是修改时 把数据做个镜像发进去\r\n     * 子级处理好的返回父级\r\n     */\r\n    openAddMaterial() {\r\n      this.$refs.materialDialog.popupInit(\r\n        this.filtersData.cateIdentifier,\r\n        \"edit\",\r\n        [...this.materialTableListData]\r\n      );\r\n    },\r\n    //原料添加成功后返回的数据\r\n    getSubMaterialList(list) {\r\n      this.materialTableListData = list;\r\n    },\r\n    //添加工艺\r\n    openAddTechnology() {\r\n      this.$refs.technologyDialog.popupInit(\r\n        this.filtersData.cateIdentifier,\r\n        \"edit\",\r\n        [...this.technologyTableListData]\r\n      );\r\n    },\r\n    getSubTechnologyList(list) {\r\n      this.technologyTableListData = list;\r\n    },\r\n    //添加成衣数据\r\n    openAddReadyMade() {\r\n      this.$refs.readymadeDialog.popupInit(\r\n        this.filtersData.cateId,\r\n        \"edit\",\r\n        [...this.readyMadeTableListData]\r\n      );\r\n    },\r\n    getSubReadyMadeList(list) {\r\n      this.readyMadeTableListData = list;\r\n    },\r\n    //统一删除\r\n    removeTableItem(cateName, row) {\r\n      switch (cateName) {\r\n        case \"material\":\r\n          this.deleteList(cateName, this.materialTableListData, row);\r\n          break;\r\n        case \"technology\":\r\n          this.deleteList(cateName, this.technologyTableListData, row);\r\n          break;\r\n        default:\r\n          //readyMade\r\n          this.deleteList(cateName, this.readyMadeTableListData, row);\r\n          break;\r\n      }\r\n    },\r\n    deleteList(cateName, list, row) {\r\n      let index = -1;\r\n      if (cateName == \"readyMade\") {\r\n        index = list.findIndex(item => item.measurementId == row.measurementId);\r\n      } else {\r\n        index = list.findIndex(item => item.materialId == row.materialId);\r\n      }\r\n      if (index != -1) {\r\n        list.splice(index, 1);\r\n      }\r\n    },\r\n    //后退\r\n    routerback() {\r\n      if (this._type == \"edit\") {\r\n        this.$router.go(-1);\r\n      } else if (this._type == \"add\") {\r\n        this.$router.go(-2);\r\n      } else {\r\n        this.$router.go(-1);\r\n      }\r\n    }\r\n  },\r\n  components: {\r\n    [MaterialDialog.name]: MaterialDialog,\r\n    [ReadyDadeDialog.name]: ReadyDadeDialog,\r\n    [TechnologyDialog.name]: TechnologyDialog\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.item-sub-title {\r\n  margin-left: 20px;\r\n  em {\r\n    color: red;\r\n  }\r\n}\r\n</style>\r\n"]}]}