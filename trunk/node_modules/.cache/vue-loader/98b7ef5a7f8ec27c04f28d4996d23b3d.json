{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\manage\\material_manage.vue?vue&type=style&index=0&id=3ef26543&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\manage\\material_manage.vue","mtime":1572415123651},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\css-loader\\index.js","mtime":1558492728478},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1558492728890},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\postcss-loader\\src\\index.js","mtime":1558492728823},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\less-loader\\dist\\cjs.js","mtime":1566193719488},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n@import \"../style/contentPublic.less\";\n.material_manage{\n  .form-data{padding: 20px;position: relative;\n    .total{margin-right: 20px;}\n    .form{position: absolute;right: 20px;top: 15px;}\n  }\n  .item-list{\n    .item{width: 20%;float: left;padding: 0 1%;position: relative;margin-bottom: 20px;text-align: left;\n      .item-inner{border: 1px solid #e6e8ed;padding: 8px;\n        .img{width: 100%;height: 150px;}\n        img,video{ width: 100%;height: 150px;}\n        .info{padding-left: 10px;\n          h3{padding-top: 10px;font-size:18px;}\n          p{font-size: 14px;line-height: 32px;}\n        }\n      }\n      .item-checkbox{position: absolute;right: -9px;bottom: 14px;}\n    }\n  }\n  .no-content{height: 60px;line-height: 60px;border-bottom: 1px solid #e6e6e6;border-top: 1px solid #e6e6e6;text-align: center;color: #909399;}\n  .add-edit  /deep/ .el-input__inner{width: 200px;}\n  .edit-img,.edit-video{width: 80px;height: 80px;}\n}\n\n",{"version":3,"sources":["material_manage.vue"],"names":[],"mappings":";;;;;;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"material_manage.vue","sourceRoot":"src/views/content/manage","sourcesContent":["<!--\r\n * @Description: In User Settings Edit\r\n * @Author: your name\r\n * @Date: 2019-08-20 08:58:18\r\n * @LastEditTime: 2019-08-20 14:29:26\r\n * @LastEditors: Please set LastEditors\r\n -->\r\n<style lang=\"less\" scoped>\r\n  @import \"../style/contentPublic.less\";\r\n  .material_manage{\r\n    .form-data{padding: 20px;position: relative;\r\n      .total{margin-right: 20px;}\r\n      .form{position: absolute;right: 20px;top: 15px;}\r\n    }\r\n    .item-list{\r\n      .item{width: 20%;float: left;padding: 0 1%;position: relative;margin-bottom: 20px;text-align: left;\r\n        .item-inner{border: 1px solid #e6e8ed;padding: 8px;\r\n          .img{width: 100%;height: 150px;}\r\n          img,video{ width: 100%;height: 150px;}\r\n          .info{padding-left: 10px;\r\n            h3{padding-top: 10px;font-size:18px;}\r\n            p{font-size: 14px;line-height: 32px;}\r\n          }\r\n        }\r\n        .item-checkbox{position: absolute;right: -9px;bottom: 14px;}\r\n      }\r\n    }\r\n    .no-content{height: 60px;line-height: 60px;border-bottom: 1px solid #e6e6e6;border-top: 1px solid #e6e6e6;text-align: center;color: #909399;}\r\n    .add-edit  /deep/ .el-input__inner{width: 200px;}\r\n    .edit-img,.edit-video{width: 80px;height: 80px;}\r\n  }\r\n\r\n</style>\r\n<template>\r\n  <div class=\"material_manage page-public\">\r\n    <div class=\"page-main\">\r\n      <div class=\"page-main-inner item-margin\">\r\n        <el-menu :default-active=\"typeActiveIndex\" class=\"el-menu-demo page-menu-border\" mode=\"horizontal\" @select=\"typeActiveSelect\">\r\n          <el-menu-item index=\"2\">图片</el-menu-item>\r\n          <el-menu-item index=\"1\">视频</el-menu-item>\r\n        </el-menu>\r\n        <div class=\"form-data\">\r\n          <span class=\"total\" v-show=\"typeActiveIndex == 2\">共{{ tableData.totalCount }}张图片</span>\r\n          <span class=\"total\" v-show=\"typeActiveIndex == 1\">共{{ tableData.totalCount }}个视频</span>\r\n          <el-button size=\"small\" @click=\"itemDel(false)\">批量删除</el-button>\r\n          <el-button type=\"primary\" @click=\"dialogVisibleShow(true)\" size=\"small\">上传</el-button>\r\n          <div class=\"form\">\r\n            <el-form :inline=\"true\" :model=\"formData\" class=\"demo-form-inline\" size=\"small\" ref=\"form\">\r\n              <el-form-item label=\"\">\r\n                <el-input v-model=\"formData.title\" placeholder=\"请输入关键字搜索内容\" suffix-icon=\"el-icon-search\" @keyup.13.native=\"searchTableData\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"素材分类：\">\r\n                <el-cascader :options=\"categoryTreeList\" v-model=\"formData.category\" :props=\"categoryTreeListProps\" :show-all-levels=\"false\" clearable>\r\n                </el-cascader>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" plain @click=\"searchTableData\" size=\"small\">搜索</el-button>\r\n                <el-button plain @click=\"initFormData\" size=\"small\">重置</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </div>\r\n        <page-table :form-data=\"formData\" :get-data=\"getData\" :table-data=\"tableData\">\r\n          <div v-show=\"!tableData.data || (tableData.data && tableData.data.length === 0)\" class=\"no-content\">暂无数据</div>\r\n          <div class=\"item-list clearfix\">\r\n            <el-checkbox-group v-model=\"checkList\">\r\n              <div class=\"item\" v-for=\"item in tableData.data\">\r\n                <el-checkbox :label=\"item\" class=\"item-checkbox\" :key=\"item.id\"><div></div></el-checkbox>\r\n                <div class=\"item-inner\">\r\n                  <div class=\"img\">\r\n                    <el-image style=\"width: 100%; height: 100%\" :src=\"item.url\" fit=\"contain\" v-if=\"formData.type == '2'\"></el-image>\r\n                    <el-image style=\"width: 100%; height: 100%\" :src=\"item.videoCoverUrl\" fit=\"contain\" v-if=\"formData.type == '1'\"></el-image>\r\n                  </div>\r\n                  <div class=\"info\">\r\n                    <h4 :title=\"item.title\">{{ item.title | titleCut }}</h4>\r\n                    <p v-if=\"item._categoryName\">分类：{{ item._categoryName }}</p>\r\n                    <div class=\"btns\">\r\n                      <el-button type=\"text\" size=\"small\" @click=\"dialogVisibleShow(false, item )\">编辑</el-button>\r\n                      <el-button type=\"text\" size=\"small\" @click=\"itemDel(true,item)\">删除</el-button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </el-checkbox-group>\r\n          </div>\r\n        </page-table>\r\n        <!--新增和编辑-->\r\n        <el-dialog :title=\"addAndEditFlag ? '新增' : '编辑'\" :visible.sync=\"dialogVisible\" width=\"30%\" class=\"add-edit\">\r\n          <el-form ref=\"form\" :model=\"addAndEditFormData\" label-width=\"80px\" :rules=\"rules\" v-if=\"typeActiveIndex === '2'\" :key=\"typeActiveIndex\">\r\n            <el-form-item label=\"图片\" prop=\"url\">\r\n              <upload-img v-model=\"addAndEditFormData.url\" v-if=\"addAndEditFlag\" :action-url=\"pictureUploadUrl\" :content-txt=\"'上传图片'\" :baseId.sync=\"addAndEditFormData.baseId\"></upload-img>\r\n              <img :src=\"addAndEditFormData.url\" alt=\"\" class=\"edit-img\"  v-if=\"!addAndEditFlag\">\r\n            </el-form-item>\r\n            <el-form-item label=\"标题\" prop=\"title\">\r\n              <el-input v-model=\"addAndEditFormData.title\" placeholder=\"请输入标题\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"分类\" prop=\"category\">\r\n              <el-cascader :options=\"categoryTreeList\" v-model=\"addAndEditFormData.category\" :props=\"categoryTreeListProps\">\r\n              </el-cascader>\r\n            </el-form-item>\r\n          </el-form>\r\n          <el-form ref=\"videoForm\" :model=\"addAndEditVideoFormData\" label-width=\"80px\" :rules=\"videoRules\" v-if=\"typeActiveIndex === '1'\" :key=\"typeActiveIndex\">\r\n            <el-form-item label=\"视频\" prop=\"url\">\r\n              <upload-video v-model=\"addAndEditVideoFormData.url\" v-if=\"dialogVisible && addAndEditFlag\" ref=\"addAndEditVideo\"></upload-video>\r\n              <img :src=\"addAndEditVideoFormData.videoCoverUrl\" alt=\"\" class=\"edit-img\"  v-if=\"!addAndEditFlag\">\r\n            </el-form-item>\r\n            <el-form-item label=\"标题\" prop=\"title\">\r\n              <el-input v-model=\"addAndEditVideoFormData.title\" placeholder=\"请输入标题\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"分类\" prop=\"category\">\r\n              <el-cascader :options=\"categoryTreeList\" v-model=\"addAndEditVideoFormData.category\" :props=\"categoryTreeListProps\">\r\n              </el-cascader>\r\n            </el-form-item>\r\n          </el-form>\r\n          <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"addAndEditSub\">确 定</el-button>\r\n        </span>\r\n        </el-dialog>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import PageTable from '@/views/content/components/PageTable.vue'\r\n  import UploadImg from '@/components/editor/UploadImg.vue'\r\n  import UploadVideo from '@/components/editor/UploadVideo.vue'\r\n  export default {\r\n    name: '',\r\n    // 数据\r\n    data() {\r\n      return {\r\n        // 素材图片上传地址\r\n        pictureUploadUrl: this.api.contentCore.picture_upload.url,\r\n        // 类型默认选中\r\n        typeActiveIndex: '2',  // 2 图片   1 视频\r\n        tableData: {},\r\n        // 批量删除选中的\r\n        checkList: [],\r\n        // 参数\r\n        formData: {\r\n          pageIndex: 1,\r\n          pageSize: 10,\r\n          type: 2,\r\n          title: '',\r\n          category: [],\r\n          categoryId: ''\r\n        },\r\n        // 分类映射\r\n        categoryTreeList: [],\r\n        categoryTreeListProps:{\r\n          value: '_flag',\r\n          label: 'name',\r\n          children: 'children',\r\n          expandTrigger: 'hover'\r\n        },\r\n\r\n        // 新增和编辑\r\n        dialogVisible: false,\r\n        addAndEditFlag: true,\r\n        // 分类数据\r\n        addAndEditCategoryTreeList: [],\r\n        // 新增图片\r\n        addAndEditFormData: {\r\n          type: 2,\r\n          title: '',\r\n          url:'',\r\n          category: [],\r\n          baseId: '',\r\n          categoryId:  '',\r\n          showIdentifier: ''\r\n        },\r\n        rules: {\r\n          url: [\r\n            { type: 'string',required: true, message: '请选择图片', trigger: 'change' }\r\n          ],\r\n          title:[\r\n            { type: 'string',required: true, message: '请输入标题', trigger: 'change' },\r\n            { max: 15, message: '长度不大于15', trigger: 'change' }\r\n          ],\r\n          category: [\r\n            { type: 'array',required: true, message: '请选择分类', trigger: 'change' },\r\n\r\n          ]\r\n        },\r\n        // 新增视频\r\n        infoVideo: {},\r\n        addAndEditVideoFormData: {\r\n          type: 1,\r\n          title: '',\r\n          url:'',\r\n          category: [],\r\n          categoryId:  '',\r\n          showIdentifier: '',\r\n          videoCoverUrl: ''\r\n        },\r\n        videoRules: {\r\n          url: [\r\n            { type: 'string',required: true, message: '请选择视频', trigger: 'change' }\r\n          ],\r\n          title:[\r\n            { type: 'string',required: true, message: '请输入标题', trigger: 'change' },\r\n            { max: 15, message: '长度不大于15', trigger: 'change' }\r\n          ],\r\n          category: [\r\n            { type: 'array',required: true, message: '请选择分类', trigger: 'change' },\r\n          ]\r\n        },\r\n      }\r\n    },\r\n    // 组件\r\n    components: {\r\n      PageTable,\r\n      UploadImg,\r\n      UploadVideo\r\n    },\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        // sourceType 1 视频  2 图片\r\n        this.getCategoryTreeList(2)\r\n        this.getData()\r\n      })\r\n    },\r\n    // 方法\r\n    methods: {\r\n      // 点击搜索\r\n      searchTableData(){\r\n        this.formData.pageIndex = 1;\r\n        this.getData();\r\n      },\r\n      // 获取数据\r\n      getData(){\r\n        let check = this.formData.category\r\n        if(check && check.length){\r\n          this.formData.categoryId = check[check.length-1].split('&')[0]\r\n        }else {\r\n          this.formData.categoryId = ''\r\n        }\r\n        this.request(this.api.contentCore.library_list, this.formData).then(data => {\r\n          this.tableDataInit(data)\r\n          this.tableData = data\r\n        })\r\n      },\r\n      // 初始化数据\r\n      tableDataInit(data){\r\n        if(data.data && data.data.length){\r\n          const num = new Date().getTime()\r\n          data.data.forEach(item => {\r\n            // 初始url\r\n            if(item.videoCoverUrl){\r\n              item.videoCoverUrl = item.videoCoverUrl + '?time=' + num\r\n            }\r\n            if(item.url){\r\n              item.url = item.url + '?time=' + num\r\n            }\r\n            // 初始化分类\r\n            if(item.showIdentifier){\r\n              if(item.showIdentifier.indexOf('$') > -1){\r\n                let ary = item.showIdentifier.split('$')\r\n                item._categoryName = ary[ary.length-1].split('&')[1]\r\n              }else {\r\n                item._categoryName = item.showIdentifier.split('&')[1]\r\n              }\r\n            }\r\n          })\r\n        }\r\n      },\r\n      // 重置\r\n      initFormData(){\r\n        this.formData.title = ''\r\n        this.formData.category = []\r\n      },\r\n      // 新增和编辑显示\r\n      dialogVisibleShow(flag, row){\r\n        // 重置图片上传信息\r\n        if(this.typeActiveIndex === '2'){\r\n          setTimeout(() => {\r\n            this.$refs.form.resetFields()\r\n          },0)\r\n        }\r\n        // 重置视频上传信息\r\n        if(this.typeActiveIndex === '1'){\r\n          setTimeout(() => {\r\n            this.$refs.videoForm.resetFields()\r\n          },0)\r\n        }\r\n        if(flag){\r\n          this.addAndEditFlag = true\r\n          this.addAndEditVideoFormData.url = ''\r\n          this.addAndEditVideoFormData.id = ''\r\n        }else{\r\n          this.addAndEditFlag = false\r\n          this.request(this.api.contentCore.library_get, {id: row.id }).then(data => {\r\n            if(data.type == 2){\r\n              this.addAndEditFormData ={\r\n                id: data.id,\r\n                type: data.type,\r\n                title: data.title,\r\n                url: data.url,\r\n                baseId: data.baseId,\r\n                category: [],\r\n                categoryId: data.categoryId,\r\n                showIdentifier: data.showIdentifier\r\n              }\r\n              if(data.showIdentifier){\r\n                if(data.showIdentifier.indexOf('$') > -1){\r\n                  let ary = data.showIdentifier.split('$')\r\n                  this.addAndEditFormData.category = ary\r\n                }else {\r\n                  this.addAndEditFormData.category = [data.showIdentifier]\r\n                }\r\n              }\r\n            }\r\n            if(data.type == 1){\r\n              this.addAndEditVideoFormData ={\r\n                id: data.id,\r\n                type: data.type,\r\n                title: data.title,\r\n                url: data.url,\r\n                category: [],\r\n                categoryId: data.categoryId,\r\n                showIdentifier: data.showIdentifier,\r\n                videoCoverUrl: data.videoCoverUrl\r\n              }\r\n              if(data.showIdentifier){\r\n                if(data.showIdentifier.indexOf('$') > -1){\r\n                  let ary = data.showIdentifier.split('$')\r\n                  this.addAndEditVideoFormData.category = ary\r\n                }else {\r\n                  this.addAndEditVideoFormData.category = [data.showIdentifier]\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }\r\n        this.dialogVisible = true\r\n\r\n      },\r\n      addAndEditSub(){\r\n        let url = this.api.contentCore.library_save\r\n        if(!this.addAndEditFlag){\r\n          url = this.api.contentCore.library_edit\r\n        }\r\n        // 2  图片\r\n        if(this.typeActiveIndex === '2'){\r\n          this.$refs.form.validate((valid) => {\r\n            if (valid) {\r\n              let data = this.addAndEditFormData.category\r\n              this.addAndEditFormData.categoryId = data[data.length-1].split('&')[0]\r\n              this.addAndEditFormData.showIdentifier = data.join('$')\r\n              let params\r\n              if(this.addAndEditFlag){\r\n                params = {\r\n                  sourceLibrary: this.addAndEditFormData\r\n                }\r\n              }else {\r\n                params = this.addAndEditFormData\r\n              }\r\n\r\n              this.request(url, params).then(data => {\r\n                if(this.addAndEditFormData.id){\r\n                  this.$notify.success({ title: '成功',message: '编辑成功'})\r\n                }else {\r\n                  this.$notify.success({ title: '成功',message: '新增成功'})\r\n                }\r\n                this.getData()\r\n                this.dialogVisible = false\r\n              })\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n        // 1  视频\r\n        if(this.typeActiveIndex === '1'){\r\n          this.$refs.videoForm.validate((valid) => {\r\n            if (valid) {\r\n              let data = this.addAndEditVideoFormData.category\r\n              this.addAndEditVideoFormData.categoryId = data[data.length-1].split('&')[0]\r\n              this.addAndEditVideoFormData.showIdentifier = data.join('$')\r\n              let params\r\n              if(this.addAndEditFlag){\r\n                this.infoVideo = this.$refs.addAndEditVideo.getUploadVideoInfo()\r\n                params = {\r\n                  sourceLibrary: this.addAndEditVideoFormData,\r\n                  baseVideo: this.infoVideo\r\n                }\r\n              }else {\r\n                params = this.addAndEditVideoFormData\r\n              }\r\n              this.request(url, params).then(data => {\r\n                if(this.addAndEditVideoFormData.id){\r\n                  this.$notify.success({ title: '成功',message: '编辑成功'})\r\n                }else {\r\n                  this.$notify.success({ title: '成功',message: '新增成功'})\r\n                }\r\n                this.getData()\r\n                this.dialogVisible = false\r\n              })\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n      },\r\n      // 删除\r\n      itemDel(flag,row){\r\n        if(!flag && !this.checkList.length){\r\n          this.$notify.error({ title: '成功',message: '未选择数据'})\r\n          return\r\n        }\r\n        this.$confirm('确认删除吗？', '删除', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          showClose:false\r\n        }).then(() => {\r\n          let params = []\r\n          if(flag){\r\n            params.push({\r\n              id: row.id,\r\n              baseId: row.baseId,\r\n              type: row.type,\r\n              categoryId: row.categoryId\r\n            })\r\n          }\r\n          if(!flag){\r\n            this.checkList.forEach(item => {\r\n              params.push({\r\n                id: item.id,\r\n                baseId: item.baseId,\r\n                type: item.type,\r\n                categoryId: item.categoryId\r\n              })\r\n            })\r\n          }\r\n          this.request(this.api.contentCore.delete_batch, params).then(data => {\r\n            this.$notify.success({ title: '成功',message: '删除成功'})\r\n            this.checkList = []\r\n            this.getData()\r\n          });\r\n        }).catch(() => {\r\n\r\n        });\r\n      },\r\n      // 类型切换\r\n      typeActiveSelect(index,indexPath,event) {\r\n        this.formData.pageIndex = 1\r\n        this.formData.type = index\r\n        this.typeActiveIndex = index\r\n        this.getCategoryTreeList(index)\r\n        this.getData()\r\n      },\r\n      // 获取分类tree\r\n      // sourceType 1 视频  2 图片\r\n      getCategoryTreeList(type){\r\n        this.request(this.api.contentCore.source_tree_list, {sourceType: type}).then(data => {\r\n          if(data && data.length){\r\n            // 初始化数据\r\n            this.categoryTreeListInit(data)\r\n            this.categoryTreeList = data\r\n          }\r\n        });\r\n      },\r\n      // 初始数据\r\n      categoryTreeListInit(data){\r\n        if(data && data.length){\r\n          data.forEach((item)=>{\r\n            item._flag = item.id +'&'+ item.name\r\n            if(item.children){\r\n              if(item.children.length === 0){\r\n                delete item.children\r\n              }else {\r\n                this.categoryTreeListInit(item.children)\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    // 过滤器\r\n    filters: {\r\n      titleCut: function (value) {\r\n        if(!value) return\r\n        if(value.length > 8){\r\n          return value.substr(0, 8) + '...'\r\n        }else {\r\n          return value\r\n        }\r\n\r\n      }\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {}\r\n  }\r\n</script>\r\n"]}]}