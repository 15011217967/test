{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\scb\\components\\SbcTransferSlipGoodsTable.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\scb\\components\\SbcTransferSlipGoodsTable.vue","mtime":1575873045142},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ImagePopover from \"@/views/collocation/components/ImagePopover\";\nimport { numberPrice } from \"@/utils/validate\";\nexport default {\n  name: '',\n  props: {\n    // 提交门店信息\n    transferSlipAddInfo: {\n      type: Object,\n      default(){\n        return {}\n      }\n    },\n    // 是否显示\n    checkedGoodsShow: {\n      type: Boolean,\n      default: false\n    },\n    // 表格数据\n    tableData: {\n      type: Array\n    }\n  },\n  // 数据\n  data() {\n    return {\n      value: '',\n      // 分页显示的数据\n      showTableData: [],\n      formData: {\n        pageIndex: 1,\n        pageSize: 10\n      },\n      // 选择的商品总信息\n      checkedAllSKUInfo: {\n        retailPriceTotal: 0,\n        typeTotal: 0,\n        goodsTotal: 0,\n        actualPriceTotal: 0,\n        discount: ''\n      },\n    }\n  },\n  // 组件\n  components: {\n    ImagePopover\n  },\n  // 初始化数据\n  mounted() {\n    this.$nextTick(() => {\n      this.init();\n    })\n  },\n  // 方法\n  methods: {\n    init(){\n      this.formData.pageIndex = 1;\n      // 获取显示的数据\n      this.getShowTableData();\n      // 计算选中的商品总信息\n      this.getCheckedAllSKUInfo();\n    },\n    // 获取显示数据\n    getShowTableData(){\n      if(this.tableData.length <= 10){\n        this.showTableData = this.tableData\n      }\n      if(this.tableData.length > 10){\n        this.showTableData = this.tableData.slice((this.formData.pageIndex - 1) * this.formData.pageSize, this.formData.pageIndex * this.formData.pageSize )\n      }\n    },\n    // 数量输入改变\n    /**\n     *\n     * @param $event dom节点\n     * @param scope el-table 行数据的所有信息\n     */\n    handleInput($event, scope){\n      this.$nextTick(()=>{\n        let val = $event.target.value;\n        scope.row.quantity = $event.target.value = val.replace(/[^\\d.]/g,'');\n        this.handleChange(scope)\n      })\n    },\n    /**\n     * 数量点击改变\n     * @param scope el-table 行数据的所有信息\n     */\n    handleChange(scope){\n      if(scope.row.quantity == 0){\n        this.$confirm('返货量为0时，将删除该商品', '提示', {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          showClose:false\n        }).then(() => {\n          this.tableData.splice(scope.$index + (this.formData.pageIndex - 1) * this.formData.pageSize, 1);\n          if(this.showTableData.length === 1 && this.formData.pageIndex > 1){\n            this.formData.pageIndex = this.formData.pageIndex -1;\n          }\n          this.getShowTableData();\n          this.$nextTick(()=>{\n            // 计算选中的商品总信息\n            this.getCheckedAllSKUInfo();\n          })\n        }).catch(() => {\n          scope.row.quantity = 1;\n        });\n      }else {\n        this.$nextTick(()=>{\n          // 计算选中的商品总信息\n          this.getCheckedAllSKUInfo();\n        });\n      }\n    },\n    /**\n     * 单价改变\n     * @param $event dom节点\n     * @param row 修改单价的行数据\n     */\n    purchasePriceChange($event, row){\n      let val = $event.target.value;\n      if(!val) {\n        row.allotPrice = 0;\n        return\n      }\n      numberPrice($event);\n      row.allotPrice = $event.target.value;\n      this.$nextTick(()=>{\n        // 计算选中的商品总信息\n        this.getCheckedAllSKUInfo();\n      })\n    },\n    // 计算选中的商品总信息\n    getCheckedAllSKUInfo(){\n      this.checkedAllSKUInfo = {\n        retailPriceTotal: 0,\n        typeTotal: 0,\n        goodsTotal: 0,\n        actualPriceTotal: 0,\n        discount: this.checkedAllSKUInfo.discount\n      };\n      // 获取所有的 商品货号 + 颜色  集合\n      let typeTotalObj = {};\n      if(this.tableData.length){\n        this.tableData.forEach(item => {\n          this.checkedAllSKUInfo.retailPriceTotal += Number(item.retailPrice) * Number(item.quantity);\n          this.checkedAllSKUInfo.goodsTotal += Number(item.quantity);\n          this.checkedAllSKUInfo.actualPriceTotal += Number(item.allotPrice) * Number(item.quantity);\n          let goodsCodeColor = item.goodsCode + item.color;\n          if(!typeTotalObj[goodsCodeColor]){\n            typeTotalObj[goodsCodeColor] = 1\n          }\n        });\n        this.checkedAllSKUInfo.retailPriceTotal = this.checkedAllSKUInfo.retailPriceTotal.toFixed(2);\n        this.checkedAllSKUInfo.actualPriceTotal = this.checkedAllSKUInfo.actualPriceTotal.toFixed(2);\n        this.checkedAllSKUInfo.typeTotal = Object.keys(typeTotalObj).length\n      }\n    },\n    /**\n     * 输入全部商品的折扣过滤\n     * @param $event dom节点\n     */\n    goodsAllDiscount($event){\n      let value = $event.target.value;\n      this.checkedAllSKUInfo.discount = $event.target.value = value.match(/\\d(\\.\\d?)?/g) && value.match(/\\d(\\.\\d?)?/g)[0] || null;\n    },\n    // 折扣回车\n    goodsAllDiscountEnter(){\n      if(!this.checkedAllSKUInfo.discount) return;\n      this.checkedAllSKUInfo.discount = this.checkedAllSKUInfo.discount.replace(/\\.$/, '');\n      if(this.tableData.length){\n        this.tableData.forEach(item => {\n          item.allotPrice = (item.retailPrice * Number(this.checkedAllSKUInfo.discount) / 10).toFixed(2)\n        });\n        // 计算选中的商品总信息\n        this.getCheckedAllSKUInfo();\n      }\n    },\n    // 继续选货\n    continueCheckGoods(){\n      this.$emit('update:checkedGoodsShow', false)\n    },\n    /**\n     * 最终提交\n     * @param orderStatus 调拨单状态  13-待编辑 0-待发货\n     */\n    finalSub(orderStatus){\n      if(!this.tableData.length){\n        return\n      }\n      this.transferSlipAddInfo.infoVOS = [];\n\n      this.tableData.forEach(item => {\n        let obj = {\n          // 货品编码\n          goodsCode: item.goodsCode,\n          // 货品名称\n          goodsName: item.goodsName,\n          // 商品(spu)编码\n          productCode: item.productCode,\n          // 商品类型\n          productType: item.productType,\n          // 商品图片\n          image: item.image,\n          // 品牌\n          brandName: item.brandName,\n          brandCode: item.brandCode,\n          // 设计商\n          designCompanyName: item.designCompanyName,\n          designCompanyCode: item.designCompanyCode,\n          // 尺码\n          size: item.size,\n          // 颜色\n          color: item.color,\n          // 吊牌价\n          retailPrice: item.retailPrice,\n          // 调拨单价\n          allotPrice: item.allotPrice,\n          // 数量\n          quantity: item.quantity\n        };\n        this.transferSlipAddInfo.infoVOS.push(obj);\n      });\n      this.transferSlipAddInfo.quantity = this.checkedAllSKUInfo.goodsTotal;\n      this.transferSlipAddInfo.amount = this.checkedAllSKUInfo.actualPriceTotal;\n      this.transferSlipAddInfo.orderStatus = orderStatus;\n      this.request(this.api.order.storeAllotGoodsOrder_keep, this.transferSlipAddInfo).then(data => {\n        if(data && data.length){\n          let html = '';\n          data.forEach(errItem => {\n            for(let i = this.tableData.length - 1; i >= 0; i--){\n              if(this.tableData[i].goodsCode == errItem.code){\n                if(errItem.stockQty == 0){\n                  this.tableData.splice(i, 1);\n                  html += '<p>'+ errItem.code + '：可用库存为0，已删除该商品；</p>';\n                }else {\n                  html += '<p>'+ errItem.code + '：可用库存不足，已更新为最大值' + errItem.stockQty + '；</p>';\n                  this.tableData[i].stockQty = errItem.stockQty;\n                  this.tableData[i].quantity = errItem.stockQty;\n                }\n                break;\n              }\n            }\n          });\n          this.$notify({\n            title: '提示',\n            duration: 0,\n            dangerouslyUseHTMLString: true,\n            message: html\n          });\n          this.$nextTick(() => {\n            this.init();\n          })\n        }else {\n          this.$notify.success({ title: '成功',message: '新增成功'});\n          this.$router.push({\n            path: '/collocation/transfer_slip/transfer_slip_list'\n          })\n        }\n      });\n    },\n    /**\n     * 表格更改条数\n     * @param val 每页的条数\n     */\n    handleSizeChange(val){\n      this.formData.pageSize = val;\n      this.formData.pageIndex = 1;\n      this.getShowTableData();\n    },\n    /**\n     * 表格更改页数\n     * @param val 页码\n     */\n    handleCurrentChange(val){\n      this.formData.pageIndex=val;\n      this.getShowTableData();\n    }\n  },\n  // 计算属性\n  computed: {},\n  // 监听数据变化\n  watch: {\n\n  }\n}\n",{"version":3,"sources":["SbcTransferSlipGoodsTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"SbcTransferSlipGoodsTable.vue","sourceRoot":"src/views/scb/components","sourcesContent":["<style lang=\"less\" scoped>\r\n  .goods-table{\r\n    .pagination{margin-top: 20px;}\r\n    .item-cont{\r\n      .btns{float: right;}\r\n    }\r\n    .text-info{\r\n      li{line-height: 32px;margin-bottom: 18px;\r\n        .discount-remarks{padding-left: 72px;margin-bottom: 30px;}\r\n      }\r\n    }\r\n  }\r\n  .goods-table .txt-red /deep/ .el-input__inner{color: red;}\r\n</style>\r\n<template>\r\n  <div class=\"goods-table\">\r\n    <el-table :data=\"showTableData\" style=\"width: 100%\">\r\n      <el-table-column prop=\"productCode\" label=\"商品款号\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"goodsCode\" label=\"商品货号\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"goodsName\" label=\"名称\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column label=\"商品图片\">\r\n        <template slot-scope=\"scope\">\r\n          <image-popover :img-src=\"scope.row.image\"></image-popover>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"color\" label=\"颜色\"></el-table-column>\r\n      <el-table-column prop=\"size\" label=\"尺码\"></el-table-column>\r\n      <el-table-column prop=\"brandName\" label=\"品牌\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"retailPrice\" label=\"吊牌价\"></el-table-column>\r\n      <el-table-column label=\"调拨单价\" width=\"100\">\r\n        <template slot-scope=\"scope\">\r\n          <el-input v-model=\"scope.row.allotPrice\" placeholder=\"请输入\" size=\"mini\" @input.native=\"purchasePriceChange($event, scope.row)\"></el-input>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"stockQty\" label=\"库存量\"></el-table-column>\r\n      <el-table-column label=\"数量\" width=\"150\">\r\n        <template slot-scope=\"scope\">\r\n          <el-input-number v-model=\"scope.row.quantity\"  @input.native=\"handleInput($event, scope)\" @change=\"handleChange(scope)\" :min=\"0\" label=\"选择的数量\" size=\"mini\" :class=\"{'txt-red' : scope.row.stockQty < scope.row.quantity}\"></el-input-number>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div class=\"pagination\" v-if=\"tableData.length > 0\">\r\n      <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :page-sizes=\"[10, 20, 30, 40]\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"tableData.length\" :page-size=\"formData.pageSize\" :current-page=\"formData.pageIndex\">\r\n      </el-pagination>\r\n    </div>\r\n    <div class=\"item-cont clearfix\">\r\n      <ul class=\"text-info\">\r\n        <li>吊牌总价：{{ checkedAllSKUInfo.retailPriceTotal }}</li>\r\n        <li>sku种类数：1</li>\r\n        <li>商品总数：{{ checkedAllSKUInfo.goodsTotal }}</li>\r\n        <li>调出方货值：111</li>\r\n        <li>调入方货值：222</li>\r\n      </ul>\r\n      <div class=\"btns\">\r\n        <el-button type=\"primary\" @click=\"\" size=\"small\" plain>取消</el-button>\r\n        <el-button type=\"primary\" @click=\"finalSub('13')\" size=\"small\" plain>存为草稿</el-button>\r\n        <el-button type=\"primary\" @click=\"continueCheckGoods\" size=\"small\" plain>继续选货</el-button>\r\n        <el-button type=\"primary\" @click=\"finalSub('0')\" size=\"small\">确认调拨</el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import ImagePopover from \"@/views/collocation/components/ImagePopover\";\r\n  import { numberPrice } from \"@/utils/validate\";\r\n  export default {\r\n    name: '',\r\n    props: {\r\n      // 提交门店信息\r\n      transferSlipAddInfo: {\r\n        type: Object,\r\n        default(){\r\n          return {}\r\n        }\r\n      },\r\n      // 是否显示\r\n      checkedGoodsShow: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      // 表格数据\r\n      tableData: {\r\n        type: Array\r\n      }\r\n    },\r\n    // 数据\r\n    data() {\r\n      return {\r\n        value: '',\r\n        // 分页显示的数据\r\n        showTableData: [],\r\n        formData: {\r\n          pageIndex: 1,\r\n          pageSize: 10\r\n        },\r\n        // 选择的商品总信息\r\n        checkedAllSKUInfo: {\r\n          retailPriceTotal: 0,\r\n          typeTotal: 0,\r\n          goodsTotal: 0,\r\n          actualPriceTotal: 0,\r\n          discount: ''\r\n        },\r\n      }\r\n    },\r\n    // 组件\r\n    components: {\r\n      ImagePopover\r\n    },\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        this.init();\r\n      })\r\n    },\r\n    // 方法\r\n    methods: {\r\n      init(){\r\n        this.formData.pageIndex = 1;\r\n        // 获取显示的数据\r\n        this.getShowTableData();\r\n        // 计算选中的商品总信息\r\n        this.getCheckedAllSKUInfo();\r\n      },\r\n      // 获取显示数据\r\n      getShowTableData(){\r\n        if(this.tableData.length <= 10){\r\n          this.showTableData = this.tableData\r\n        }\r\n        if(this.tableData.length > 10){\r\n          this.showTableData = this.tableData.slice((this.formData.pageIndex - 1) * this.formData.pageSize, this.formData.pageIndex * this.formData.pageSize )\r\n        }\r\n      },\r\n      // 数量输入改变\r\n      /**\r\n       *\r\n       * @param $event dom节点\r\n       * @param scope el-table 行数据的所有信息\r\n       */\r\n      handleInput($event, scope){\r\n        this.$nextTick(()=>{\r\n          let val = $event.target.value;\r\n          scope.row.quantity = $event.target.value = val.replace(/[^\\d.]/g,'');\r\n          this.handleChange(scope)\r\n        })\r\n      },\r\n      /**\r\n       * 数量点击改变\r\n       * @param scope el-table 行数据的所有信息\r\n       */\r\n      handleChange(scope){\r\n        if(scope.row.quantity == 0){\r\n          this.$confirm('返货量为0时，将删除该商品', '提示', {\r\n            confirmButtonText: '确认',\r\n            cancelButtonText: '取消',\r\n            showClose:false\r\n          }).then(() => {\r\n            this.tableData.splice(scope.$index + (this.formData.pageIndex - 1) * this.formData.pageSize, 1);\r\n            if(this.showTableData.length === 1 && this.formData.pageIndex > 1){\r\n              this.formData.pageIndex = this.formData.pageIndex -1;\r\n            }\r\n            this.getShowTableData();\r\n            this.$nextTick(()=>{\r\n              // 计算选中的商品总信息\r\n              this.getCheckedAllSKUInfo();\r\n            })\r\n          }).catch(() => {\r\n            scope.row.quantity = 1;\r\n          });\r\n        }else {\r\n          this.$nextTick(()=>{\r\n            // 计算选中的商品总信息\r\n            this.getCheckedAllSKUInfo();\r\n          });\r\n        }\r\n      },\r\n      /**\r\n       * 单价改变\r\n       * @param $event dom节点\r\n       * @param row 修改单价的行数据\r\n       */\r\n      purchasePriceChange($event, row){\r\n        let val = $event.target.value;\r\n        if(!val) {\r\n          row.allotPrice = 0;\r\n          return\r\n        }\r\n        numberPrice($event);\r\n        row.allotPrice = $event.target.value;\r\n        this.$nextTick(()=>{\r\n          // 计算选中的商品总信息\r\n          this.getCheckedAllSKUInfo();\r\n        })\r\n      },\r\n      // 计算选中的商品总信息\r\n      getCheckedAllSKUInfo(){\r\n        this.checkedAllSKUInfo = {\r\n          retailPriceTotal: 0,\r\n          typeTotal: 0,\r\n          goodsTotal: 0,\r\n          actualPriceTotal: 0,\r\n          discount: this.checkedAllSKUInfo.discount\r\n        };\r\n        // 获取所有的 商品货号 + 颜色  集合\r\n        let typeTotalObj = {};\r\n        if(this.tableData.length){\r\n          this.tableData.forEach(item => {\r\n            this.checkedAllSKUInfo.retailPriceTotal += Number(item.retailPrice) * Number(item.quantity);\r\n            this.checkedAllSKUInfo.goodsTotal += Number(item.quantity);\r\n            this.checkedAllSKUInfo.actualPriceTotal += Number(item.allotPrice) * Number(item.quantity);\r\n            let goodsCodeColor = item.goodsCode + item.color;\r\n            if(!typeTotalObj[goodsCodeColor]){\r\n              typeTotalObj[goodsCodeColor] = 1\r\n            }\r\n          });\r\n          this.checkedAllSKUInfo.retailPriceTotal = this.checkedAllSKUInfo.retailPriceTotal.toFixed(2);\r\n          this.checkedAllSKUInfo.actualPriceTotal = this.checkedAllSKUInfo.actualPriceTotal.toFixed(2);\r\n          this.checkedAllSKUInfo.typeTotal = Object.keys(typeTotalObj).length\r\n        }\r\n      },\r\n      /**\r\n       * 输入全部商品的折扣过滤\r\n       * @param $event dom节点\r\n       */\r\n      goodsAllDiscount($event){\r\n        let value = $event.target.value;\r\n        this.checkedAllSKUInfo.discount = $event.target.value = value.match(/\\d(\\.\\d?)?/g) && value.match(/\\d(\\.\\d?)?/g)[0] || null;\r\n      },\r\n      // 折扣回车\r\n      goodsAllDiscountEnter(){\r\n        if(!this.checkedAllSKUInfo.discount) return;\r\n        this.checkedAllSKUInfo.discount = this.checkedAllSKUInfo.discount.replace(/\\.$/, '');\r\n        if(this.tableData.length){\r\n          this.tableData.forEach(item => {\r\n            item.allotPrice = (item.retailPrice * Number(this.checkedAllSKUInfo.discount) / 10).toFixed(2)\r\n          });\r\n          // 计算选中的商品总信息\r\n          this.getCheckedAllSKUInfo();\r\n        }\r\n      },\r\n      // 继续选货\r\n      continueCheckGoods(){\r\n        this.$emit('update:checkedGoodsShow', false)\r\n      },\r\n      /**\r\n       * 最终提交\r\n       * @param orderStatus 调拨单状态  13-待编辑 0-待发货\r\n       */\r\n      finalSub(orderStatus){\r\n        if(!this.tableData.length){\r\n          return\r\n        }\r\n        this.transferSlipAddInfo.infoVOS = [];\r\n\r\n        this.tableData.forEach(item => {\r\n          let obj = {\r\n            // 货品编码\r\n            goodsCode: item.goodsCode,\r\n            // 货品名称\r\n            goodsName: item.goodsName,\r\n            // 商品(spu)编码\r\n            productCode: item.productCode,\r\n            // 商品类型\r\n            productType: item.productType,\r\n            // 商品图片\r\n            image: item.image,\r\n            // 品牌\r\n            brandName: item.brandName,\r\n            brandCode: item.brandCode,\r\n            // 设计商\r\n            designCompanyName: item.designCompanyName,\r\n            designCompanyCode: item.designCompanyCode,\r\n            // 尺码\r\n            size: item.size,\r\n            // 颜色\r\n            color: item.color,\r\n            // 吊牌价\r\n            retailPrice: item.retailPrice,\r\n            // 调拨单价\r\n            allotPrice: item.allotPrice,\r\n            // 数量\r\n            quantity: item.quantity\r\n          };\r\n          this.transferSlipAddInfo.infoVOS.push(obj);\r\n        });\r\n        this.transferSlipAddInfo.quantity = this.checkedAllSKUInfo.goodsTotal;\r\n        this.transferSlipAddInfo.amount = this.checkedAllSKUInfo.actualPriceTotal;\r\n        this.transferSlipAddInfo.orderStatus = orderStatus;\r\n        this.request(this.api.order.storeAllotGoodsOrder_keep, this.transferSlipAddInfo).then(data => {\r\n          if(data && data.length){\r\n            let html = '';\r\n            data.forEach(errItem => {\r\n              for(let i = this.tableData.length - 1; i >= 0; i--){\r\n                if(this.tableData[i].goodsCode == errItem.code){\r\n                  if(errItem.stockQty == 0){\r\n                    this.tableData.splice(i, 1);\r\n                    html += '<p>'+ errItem.code + '：可用库存为0，已删除该商品；</p>';\r\n                  }else {\r\n                    html += '<p>'+ errItem.code + '：可用库存不足，已更新为最大值' + errItem.stockQty + '；</p>';\r\n                    this.tableData[i].stockQty = errItem.stockQty;\r\n                    this.tableData[i].quantity = errItem.stockQty;\r\n                  }\r\n                  break;\r\n                }\r\n              }\r\n            });\r\n            this.$notify({\r\n              title: '提示',\r\n              duration: 0,\r\n              dangerouslyUseHTMLString: true,\r\n              message: html\r\n            });\r\n            this.$nextTick(() => {\r\n              this.init();\r\n            })\r\n          }else {\r\n            this.$notify.success({ title: '成功',message: '新增成功'});\r\n            this.$router.push({\r\n              path: '/collocation/transfer_slip/transfer_slip_list'\r\n            })\r\n          }\r\n        });\r\n      },\r\n      /**\r\n       * 表格更改条数\r\n       * @param val 每页的条数\r\n       */\r\n      handleSizeChange(val){\r\n        this.formData.pageSize = val;\r\n        this.formData.pageIndex = 1;\r\n        this.getShowTableData();\r\n      },\r\n      /**\r\n       * 表格更改页数\r\n       * @param val 页码\r\n       */\r\n      handleCurrentChange(val){\r\n        this.formData.pageIndex=val;\r\n        this.getShowTableData();\r\n      }\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {\r\n\r\n    }\r\n  }\r\n</script>\r\n"]}]}