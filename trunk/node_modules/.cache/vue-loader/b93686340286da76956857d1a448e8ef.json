{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\editor\\UploadVideo.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\editor\\UploadVideo.vue","mtime":1572415127780},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport TcVod from 'vod-js-sdk-v6/lib/tc_vod'\nexport default {\n  name: 'upload-video',\n  props:{\n    // 是否单选\n    isRadio: {\n      type: Boolean,\n      default: true\n    },\n    callBack: {\n      type: Function\n    },\n    value: {\n      default: \"\"\n    },\n    // 上传的视频list\n    videoList: {\n      type: Array\n    },\n    // 单个视频的信息\n    videoInfoParams: {\n      type: Object\n    }\n  },\n  // 数据\n  data() {\n    return {\n      // 上传实例\n      tcVod: '',\n      videoInfoOld: null,\n      videoInfo: null,\n      // 最终后台参数\n      videoParams: null,\n      // 页面回显路径\n      videoUrl: '',\n      // 签名\n      signature: null,\n      loading: false\n    }\n  },\n  // 组件\n  components: {\n\n  },\n  created(){\n    this.init()\n    // 编辑\n    if(this.videoInfoParams && this.videoInfoParams.info){\n      this.videoParams = this.videoInfoParams.info\n      this.videoUrl = this.videoInfoParams.info.mediaUrl\n    }\n    this.videoUrl = this.value\n  },\n\n  // 初始化数据\n  mounted() {\n    this.$nextTick(() => {\n\n    })\n  },\n  // 方法\n  methods: {\n    // 初始化\n    init(){\n      this.videoInfoOld = null\n      this.videoInfo = null\n      this.videoParams = {}\n      this.videoUrl = ''\n      this.tcVod = new TcVod({\n        getSignature: this.getSignature\n      })\n    },\n    // 获取签名\n    getSignature(){\n      if(this.signature){\n        return this.signature\n      }else {\n        this.request(this.api.contentCore.picture_get, {}).then(data => {\n          this.signature = data.signature\n          return data.signature\n        });\n      }\n    },\n    // 添加视频\n    addVideo() {\n      if(this.loading) return\n      this.$refs.videoInput.click()\n    },\n    // 判断上传文件是否是视频\n    checkVideoType(type){\n      if(!type){\n        this.$message.error('视频类型必须是,mp4中的一种');\n        this.loading = false\n        return false\n      }\n      const str = type.split('/')[1].toLowerCase()\n      if (!str.match(/mp4/)) {\n        this.loading = false\n        this.$message.error('视频类型必须是,mp4中的一种');\n        return false;\n      }else {\n        return true\n      }\n    },\n    // 上传的视频信息\n    setVideoInfo() {\n      this.loading = true\n      this.videoInfo = this.$refs.videoInput.files[0];\n      // 解决 chrome input 上传取消bug\n      if(!this.videoInfo){\n        this.videoInfo =  this.videoInfoOld.get(\"imgInfo\")\n      }else{\n        this.videoInfoOld = new FormData()\n        this.videoInfoOld.set(\"imgInfo\", this.videoInfo);\n      }\n      const flag = this.checkVideoType(this.videoInfo.type)\n      if(flag){\n        this.addUpload()\n      }\n    },\n    // 上传过程\n    addUpload() {\n      let self = this;\n      let uploader = this.tcVod.upload({\n        mediaFile: this.videoInfo\n      })\n      // 视频上传进度\n      uploader.on('media_progress', function(info) {\n\n      })\n      // 视频上传完成时\n      uploader.on('media_upload', function(info) {\n\n      })\n      // 完成回调\n      uploader.done().then(function (doneResult) {\n        self.videoSave(doneResult)\n\n      }).then(function (videoUrl) {\n\n      })\n    },\n\n\n    // 保存视频\n    videoSave(params){\n      setTimeout(()=>{\n        this.loading = false\n        this.videoParams = {\n          fileId: params.fileId,\n          mediaUrl: params.video.url\n        }\n        if(!this.isRadio){\n          this.videoList.push({\n            fileId: params.fileId,\n            url: params.video.url\n          })\n          this.init()\n          this.videoUrl = ''\n          this.$refs.upLoadForm.reset()\n        }else{\n          this.videoUrl = this.videoParams.mediaUrl\n          this.$emit('input', this.videoParams.mediaUrl )\n          if(this.callBack){\n            this.callBack(this.videoParams)\n          }\n          if(this.videoInfoParams){\n            this.videoInfoParams.info = this.videoParams\n          }\n        }\n      },5000)\n    },\n    getUploadVideoInfo(){\n      return  this.videoParams\n    }\n\n  },\n  // 计算属性\n  computed: {},\n  // 监听数据变化\n  watch: {\n\n  }\n}\n",{"version":3,"sources":["UploadVideo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"UploadVideo.vue","sourceRoot":"src/components/editor","sourcesContent":["<style lang=\"less\" scoped>\r\n  .upload-video{;width: 80px;height: 80px;display: inline-block;overflow: hidden;\r\n    .content{\r\n          .content-item{height: 80px;width: 80px;border-radius: 5px;border: 1px dashed #d9d9d9;cursor: pointer;float: left;margin-right: 20px;\r\n            img{width: 80px;height: 80px;}\r\n            video{width: 80px;height: 80px;}\r\n            span{display: block;line-height: 80px;color: #333;text-align: center;font-size: 14px;}\r\n          }\r\n      .content-item:hover{border: 1px dashed #409EFF;}\r\n    }\r\n  }\r\n</style>\r\n<template>\r\n  <div class=\"upload-video\">\r\n    <form ref=\"upLoadForm\">\r\n      <input type=\"file\" style=\"display: none;\" ref=\"videoInput\" @change=\"setVideoInfo()\"/>\r\n    </form>\r\n    <div class=\"content clearfix\">\r\n      <div class=\"content-item\"  @click.stop=\"addVideo\" v-loading=\"loading\">\r\n        <video :src=\"videoUrl\" v-show=\"videoUrl\"></video>\r\n        <span v-show=\"!videoUrl\">上传视频</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import TcVod from 'vod-js-sdk-v6/lib/tc_vod'\r\n  export default {\r\n    name: 'upload-video',\r\n    props:{\r\n      // 是否单选\r\n      isRadio: {\r\n        type: Boolean,\r\n        default: true\r\n      },\r\n      callBack: {\r\n        type: Function\r\n      },\r\n      value: {\r\n        default: \"\"\r\n      },\r\n      // 上传的视频list\r\n      videoList: {\r\n        type: Array\r\n      },\r\n      // 单个视频的信息\r\n      videoInfoParams: {\r\n        type: Object\r\n      }\r\n    },\r\n    // 数据\r\n    data() {\r\n      return {\r\n        // 上传实例\r\n        tcVod: '',\r\n        videoInfoOld: null,\r\n        videoInfo: null,\r\n        // 最终后台参数\r\n        videoParams: null,\r\n        // 页面回显路径\r\n        videoUrl: '',\r\n        // 签名\r\n        signature: null,\r\n        loading: false\r\n      }\r\n    },\r\n    // 组件\r\n    components: {\r\n\r\n    },\r\n    created(){\r\n      this.init()\r\n      // 编辑\r\n      if(this.videoInfoParams && this.videoInfoParams.info){\r\n        this.videoParams = this.videoInfoParams.info\r\n        this.videoUrl = this.videoInfoParams.info.mediaUrl\r\n      }\r\n      this.videoUrl = this.value\r\n    },\r\n\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n\r\n      })\r\n    },\r\n    // 方法\r\n    methods: {\r\n      // 初始化\r\n      init(){\r\n        this.videoInfoOld = null\r\n        this.videoInfo = null\r\n        this.videoParams = {}\r\n        this.videoUrl = ''\r\n        this.tcVod = new TcVod({\r\n          getSignature: this.getSignature\r\n        })\r\n      },\r\n      // 获取签名\r\n      getSignature(){\r\n        if(this.signature){\r\n          return this.signature\r\n        }else {\r\n          this.request(this.api.contentCore.picture_get, {}).then(data => {\r\n            this.signature = data.signature\r\n            return data.signature\r\n          });\r\n        }\r\n      },\r\n      // 添加视频\r\n      addVideo() {\r\n        if(this.loading) return\r\n        this.$refs.videoInput.click()\r\n      },\r\n      // 判断上传文件是否是视频\r\n      checkVideoType(type){\r\n        if(!type){\r\n          this.$message.error('视频类型必须是,mp4中的一种');\r\n          this.loading = false\r\n          return false\r\n        }\r\n        const str = type.split('/')[1].toLowerCase()\r\n        if (!str.match(/mp4/)) {\r\n          this.loading = false\r\n          this.$message.error('视频类型必须是,mp4中的一种');\r\n          return false;\r\n        }else {\r\n          return true\r\n        }\r\n      },\r\n      // 上传的视频信息\r\n      setVideoInfo() {\r\n        this.loading = true\r\n        this.videoInfo = this.$refs.videoInput.files[0];\r\n        // 解决 chrome input 上传取消bug\r\n        if(!this.videoInfo){\r\n          this.videoInfo =  this.videoInfoOld.get(\"imgInfo\")\r\n        }else{\r\n          this.videoInfoOld = new FormData()\r\n          this.videoInfoOld.set(\"imgInfo\", this.videoInfo);\r\n        }\r\n        const flag = this.checkVideoType(this.videoInfo.type)\r\n        if(flag){\r\n          this.addUpload()\r\n        }\r\n      },\r\n      // 上传过程\r\n      addUpload() {\r\n        let self = this;\r\n        let uploader = this.tcVod.upload({\r\n          mediaFile: this.videoInfo\r\n        })\r\n        // 视频上传进度\r\n        uploader.on('media_progress', function(info) {\r\n\r\n        })\r\n        // 视频上传完成时\r\n        uploader.on('media_upload', function(info) {\r\n\r\n        })\r\n        // 完成回调\r\n        uploader.done().then(function (doneResult) {\r\n          self.videoSave(doneResult)\r\n\r\n        }).then(function (videoUrl) {\r\n\r\n        })\r\n      },\r\n\r\n\r\n      // 保存视频\r\n      videoSave(params){\r\n        setTimeout(()=>{\r\n          this.loading = false\r\n          this.videoParams = {\r\n            fileId: params.fileId,\r\n            mediaUrl: params.video.url\r\n          }\r\n          if(!this.isRadio){\r\n            this.videoList.push({\r\n              fileId: params.fileId,\r\n              url: params.video.url\r\n            })\r\n            this.init()\r\n            this.videoUrl = ''\r\n            this.$refs.upLoadForm.reset()\r\n          }else{\r\n            this.videoUrl = this.videoParams.mediaUrl\r\n            this.$emit('input', this.videoParams.mediaUrl )\r\n            if(this.callBack){\r\n              this.callBack(this.videoParams)\r\n            }\r\n            if(this.videoInfoParams){\r\n              this.videoInfoParams.info = this.videoParams\r\n            }\r\n          }\r\n        },5000)\r\n      },\r\n      getUploadVideoInfo(){\r\n        return  this.videoParams\r\n      }\r\n\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {\r\n\r\n    }\r\n  }\r\n</script>\r\n"]}]}