{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\technology_details.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\technology_details.vue","mtime":1572415124048},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.array.find\";\nimport _toConsumableArray from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.to-string\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar mirroringMaterialCates = [];\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\nimport { numberPrice } from \"@/utils/validate\";\nexport default {\n  data: function data() {\n    return {\n      filtersData: {\n        type: 1,\n        //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\n        materialCateId: \"\",\n        name: \"\",\n        unitPrice: \"\",\n        image: \"\",\n        costPrice: null,\n        valid: true,\n        description: \"\",\n        productionMaterialCates: [],\n        //商品分类数组\n        productionMaterialExclusions: [] //工艺互斥\n\n      },\n      productImages: [],\n      //回显图片\n      showDisabled: false,\n      editDisabled: false,\n      _type: \"\",\n      _id: \"\",\n      rules: {\n        //规则验证\n        materialCateId: [{\n          required: true,\n          message: \"请选择属性分类\",\n          trigger: \"change\"\n        }],\n        productionMaterialCates: [{\n          required: true,\n          message: \"请选择商品分类\",\n          trigger: \"change\"\n        }],\n        name: [{\n          required: true,\n          message: \"输入原料名称\",\n          trigger: \"blur\"\n        }],\n        unitPrice: [{\n          required: true,\n          message: \"请输入销售价格\",\n          trigger: \"blur\"\n        }]\n      },\n      //分类使用\n      cateIdArr: [],\n      classData: [],\n      // 商品分类树 数据\n      listData: [],\n      // 商品 分类 一维数据\n      attrClassData: [],\n      //原料分类树数据\n      attrListData: [],\n      //原料 一维数据\n      attrCateArr: [],\n      cateArr: [],\n      props: {\n        value: \"id\",\n        label: \"name\",\n        children: \"children\"\n      },\n      productionMaterialExclusions: [],\n      cateNames: \"\",\n      mutexList: [],\n      setMutexData: [] //获得到的互斥ID 需要做处理\n\n    };\n  },\n  created: function created() {\n    this.getQueryparams();\n    this.getMutexData();\n  },\n  methods: {\n    setNumberPrice: function setNumberPrice(_t) {\n      numberPrice(_t);\n    },\n    //获取上页面参数\n    getQueryparams: function getQueryparams() {\n      this._type = this.$route.query._type;\n      this._id = this.$route.query._id;\n      var itemStatus = this._type;\n\n      switch (itemStatus.toString()) {\n        case \"add\":\n          //新增\n          this.editDisabled = false;\n          this.showDisabled = false;\n          this.getClassData();\n          break;\n\n        case \"edit\":\n          //修改\n          this.editDisabled = true;\n          this.showDisabled = false;\n          this.getEchoDisplayData();\n          break;\n\n        case \"show\":\n          //查看\n          this.editDisabled = true;\n          this.showDisabled = true;\n          this.getEchoDisplayData();\n          break;\n      }\n    },\n    getClassData: function getClassData(_disabledIds) {\n      var _this = this;\n\n      // 获取商品分类  type 1\n      this.$common.getClassSelect(this, 1, _disabledIds).then(function (res) {\n        _this.classData = res.ztree;\n        _this.listData = res.list;\n      }); //获取属性分类  type 1\n\n      this.$common.getClassSelect(this, 3).then(function (res) {\n        _this.attrClassData = res.ztree;\n        _this.attrListData = res.list;\n      });\n    },\n    cateChangeGet: function cateChangeGet(e) {\n      var careIdArr = this.cateIdArr,\n          careIdLen = careIdArr.length;\n      var list = this.listData,\n          listLen = list.length;\n      var categories = [];\n\n      for (var i = 0; i < careIdLen; i++) {\n        for (var k = 0; k < listLen; k++) {\n          if (careIdArr[i] == list[k].id) {\n            categories.push({\n              cateId: list[k].id,\n              cateName: list[k].name,\n              cateIdentifier: list[k].identifier,\n              fullCateName: list[k].fullCateName\n            });\n          }\n        }\n      }\n\n      this.filtersData.productionMaterialCates = [].concat(categories, _toConsumableArray(mirroringMaterialCates));\n    },\n    attrCascaderGet: function attrCascaderGet(e) {\n      var cateId = JSON.parse(JSON.stringify(e)).pop();\n      var obj = this.attrListData.find(function (item) {\n        return item.id == cateId;\n      });\n      this.filtersData.materialCateId = obj.id;\n      this.filtersData.materialCateName = obj.name;\n      this.filtersData.materialCateIdentifier = obj.identifier;\n      this.filtersData.materialFullCateName = obj.fullCateName;\n    },\n    removeTag: function removeTag(item) {\n      if (this._type == 'edit') {\n        var exclusions = this.filtersData.productionMaterialExclusions;\n\n        if (exclusions.length > 0) {\n          var flag = false;\n\n          for (var i = 0; i < exclusions.length; i++) {\n            if (exclusions[i].exclusionMaterialId == item && exclusions[i].id != null) {\n              flag = true;\n              exclusions[i].status = 9;\n            }\n          }\n\n          if (!flag) {\n            var index = exclusions.findIndex(function (elem) {\n              return elem.exclusionMaterialId == item;\n            });\n\n            if (index != -1) {\n              this.filtersData.productionMaterialExclusions.splice(index, 1);\n            }\n          }\n        }\n      }\n    },\n    //互斥处理\n    setMutexGet: function setMutexGet(item) {\n      var mutex = this.setMutexData,\n          mutexLen = mutex.length;\n      var mutexList = this.mutexList,\n          mutexListLen = mutexList.length;\n      var categories = [];\n\n      for (var i = 0; i < mutexLen; i++) {\n        for (var k = 0; k < mutexListLen; k++) {\n          if (mutex[i] == mutexList[k].id) {\n            categories.push({\n              exclusionMaterialId: mutexList[k].id,\n              exclusionMaterialName: mutexList[k].name\n            });\n          }\n        }\n      }\n\n      if (this._type == 'edit') {\n        var exclusions = this.filtersData.productionMaterialExclusions;\n        var list = [];\n\n        for (var _i = 0; _i < categories.length; _i++) {\n          var flag = false;\n\n          for (var _k = 0; _k < exclusions.length; _k++) {\n            if (exclusions[_k].exclusionMaterialId == categories[_i].exclusionMaterialId) {\n              flag = true;\n            }\n\n            if (exclusions[_k].exclusionMaterialId == categories[_i].exclusionMaterialId && exclusions[_k].id != null) {\n              exclusions[_k].status = 1;\n            }\n          }\n\n          if (!flag) {\n            list.push(categories[_i]);\n          } else {}\n        }\n\n        this.filtersData.productionMaterialExclusions = [].concat(list, _toConsumableArray(exclusions));\n      } else {\n        this.filtersData.productionMaterialExclusions = categories;\n      }\n    },\n    //提交\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var Exclusions = _this2.filtersData.productionMaterialExclusions;\n\n          for (var i = 0; i < Exclusions.length; i++) {\n            Exclusions[i].materialId = _this2.filtersData.id != \"\" ? _this2.filtersData.id : \"\";\n            Exclusions[i].materialName = _this2.filtersData.name;\n          }\n\n          _this2.request(_this2.api.product.productionMaterial_save, _this2.filtersData).then(function (res) {\n            _this2.$message.success(\"保存成功\");\n\n            setTimeout(function () {\n              _this2.routerback();\n            }, 500);\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    //回显\n    getEchoDisplayData: function getEchoDisplayData() {\n      var _this3 = this;\n\n      this.request(this.api.product.productionMaterial_get, {\n        id: this._id\n      }).then(function (res) {\n        _this3.filtersData = res;\n\n        if (!!res.image) {\n          _this3.productImages = [{\n            url: res.image\n          }];\n        }\n\n        _this3.cateArr = [res.cateId];\n        _this3.attrCateArr = [res.materialCateId];\n        var Exclusion = res.productionMaterialExclusions;\n        var list = [];\n\n        for (var i = 0; i < Exclusion.length; i++) {\n          list.push(Exclusion[i].exclusionMaterialId);\n        }\n\n        _this3.setMutexData = list; //回显 商品分类已选置灰\n\n        var arr = [],\n            cateIds = [];\n        var Categories = res.productionMaterialCates;\n        mirroringMaterialCates = _toConsumableArray(Categories);\n\n        if (Categories.length > 0) {\n          for (var _i2 = 0; _i2 < Categories.length; _i2++) {\n            arr.push(Categories[_i2].fullCateName); //此处的字段是错误的\n\n            cateIds.push(Categories[_i2].cateId);\n          }\n\n          _this3.cateNames = arr.join(\"、\");\n        }\n\n        _this3.getClassData(cateIds);\n      });\n    },\n    //互斥\n    getMutexData: function getMutexData() {\n      var _this4 = this;\n\n      this.request(this.api.product.productionMaterial_list, {\n        type: 1,\n        valid: true\n      }).then(function (res) {\n        var _data = res.data;\n\n        if (!!_this4._id) {\n          for (var i = 0; i < _data.length; i++) {\n            if (_data[i].id == _this4._id) {\n              _data.splice(i, 1);\n\n              break;\n            }\n          }\n\n          _this4.mutexList = _data;\n        } else {\n          _this4.mutexList = _data;\n        }\n      });\n    },\n    //后退\n    routerback: function routerback() {\n      this.$router.go(-1);\n    }\n  },\n  components: {\n    ElUploadImg: ElUploadImg\n  }\n};",{"version":3,"sources":["technology_details.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <el-form :rules=\"rules\" label-width=\"110px\" :model=\"filtersData\" size=\"small\" ref=\"filtersForm\">\r\n      <div class=\"tlogy-item\">\r\n        <h5 class=\"tlogy-title\">基本信息</h5>\r\n        <el-form-item prop=\"materialCateId\" label=\"属性分类：\">\r\n          <el-cascader\r\n            v-if=\"_type == 'add'\"\r\n            class=\"input-w-2\"\r\n            :disabled=\"editDisabled\"\r\n            :options=\"attrClassData\"\r\n            v-model=\"attrCateArr\"\r\n            :value=\"attrCateArr\"\r\n            @change=\"attrCascaderGet\"\r\n            :show-all-levels=\"false\"\r\n            :props=\"props\"\r\n          ></el-cascader>\r\n          <el-select\r\n            v-else\r\n            placeholder=\"请选择\"\r\n            class=\"input-w-2\"\r\n            :disabled=\"editDisabled\"\r\n            :value=\"filtersData.materialCateId\"\r\n            v-model=\"filtersData.materialCateId\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in attrListData\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.id\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item v-if=\"_type != 'add'\" label=\"已选分类：\">\r\n          <div>{{cateNames}}</div>\r\n        </el-form-item>\r\n        <el-form-item :prop=\"_type == 'add'?'productionMaterialCates':''\" label=\"商品分类：\">\r\n          <div class=\"input-w-2\">\r\n            <el-cascader-multi\r\n              v-model=\"cateIdArr\"\r\n              :disabled=\"showDisabled\"\r\n              @change=\"cateChangeGet\"\r\n              :data=\"classData\"\r\n              :only-last=\"true\"\r\n              :clearable=\"true\"\r\n              :is-two-dimension-value=\"false\"\r\n              separator=\"/\"\r\n              value-key=\"id\"\r\n              label-key=\"name\"\r\n              children-key=\"children\"\r\n            ></el-cascader-multi>\r\n          </div>\r\n        </el-form-item>\r\n        <el-form-item prop=\"name\" label=\"工艺名称：\">\r\n          <el-input\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.name\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"unitPrice\" label=\"销售价格：\">\r\n          <el-input\r\n            @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.unitPrice\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"工艺成本：\">\r\n          <el-input\r\n            @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.costPrice\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"image\" label=\"工艺图片：\">\r\n          <el-upload-img\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.image\"\r\n            :EchoDisplayImages=\"productImages\"\r\n            CatalogName=\"product\"\r\n          ></el-upload-img>\r\n        </el-form-item>\r\n        <el-form-item prop=\"valid\" label=\"使用状态：\">\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"true\">使用中</el-radio>\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"false\">未使用</el-radio>\r\n        </el-form-item>\r\n        <el-form-item prop=\"description\" label=\"备注：\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            class=\"input-w-2\"\r\n            autosize\r\n            :disabled=\"showDisabled\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"filtersData.description\"\r\n          ></el-input>\r\n        </el-form-item>\r\n      </div>\r\n      <div class=\"tlogy-footer\">\r\n        <h5 class=\"tlogy-title\">\r\n          互斥规则\r\n          <em>该工艺不能与哪些工艺同时选择</em>\r\n        </h5>\r\n        <el-form-item label=\"互斥工艺：\">\r\n          <el-select\r\n            class=\"input-w-2\"\r\n            placeholder=\"可多选\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"setMutexData\"\r\n            @change=\"setMutexGet\"\r\n            @remove-tag=\"removeTag\"\r\n            multiple\r\n          >\r\n            <el-option v-for=\"item in mutexList\" :key=\"item.id\" :label=\"item.name\" :value=\"item.id\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <div class=\"item-footer\">\r\n          <el-button\r\n            v-if=\"_type == 'add'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >确定</el-button>\r\n          <el-button\r\n            v-else-if=\"_type == 'edit'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >修改</el-button>\r\n          <el-button size=\"small\" @click=\"routerback('filtersForm')\">取消</el-button>\r\n        </div>\r\n      </div>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n<script>\r\nlet mirroringMaterialCates = [];\r\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\r\nimport { numberPrice } from \"@/utils/validate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        type: 1, //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\r\n        materialCateId: \"\",\r\n        name: \"\",\r\n        unitPrice: \"\",\r\n        image: \"\",\r\n        costPrice: null,\r\n        valid: true,\r\n        description: \"\",\r\n        productionMaterialCates: [], //商品分类数组\r\n        productionMaterialExclusions: [] //工艺互斥\r\n      },\r\n      productImages: [], //回显图片\r\n      showDisabled: false,\r\n      editDisabled: false,\r\n      _type: \"\",\r\n      _id: \"\",\r\n      rules: {\r\n        //规则验证\r\n        materialCateId: [\r\n          { required: true, message: \"请选择属性分类\", trigger: \"change\" }\r\n        ],\r\n        productionMaterialCates: [\r\n          { required: true, message: \"请选择商品分类\", trigger: \"change\" }\r\n        ],\r\n        name: [{ required: true, message: \"输入原料名称\", trigger: \"blur\" }],\r\n        unitPrice: [\r\n          { required: true, message: \"请输入销售价格\", trigger: \"blur\" }\r\n        ]\r\n      },\r\n      //分类使用\r\n      cateIdArr: [],\r\n      classData: [], // 商品分类树 数据\r\n      listData: [], // 商品 分类 一维数据\r\n      attrClassData: [], //原料分类树数据\r\n      attrListData: [], //原料 一维数据\r\n      attrCateArr: [],\r\n      cateArr: [],\r\n      props: {\r\n        value: \"id\",\r\n        label: \"name\",\r\n        children: \"children\"\r\n      },\r\n      productionMaterialExclusions:[],\r\n      cateNames: \"\",\r\n      mutexList: [],\r\n      setMutexData: [] //获得到的互斥ID 需要做处理\r\n    };\r\n  },\r\n  created() {\r\n    this.getQueryparams();\r\n\r\n    this.getMutexData();\r\n  },\r\n  methods: {\r\n    setNumberPrice(_t) {\r\n      numberPrice(_t);\r\n    },\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      this._type = this.$route.query._type;\r\n      this._id = this.$route.query._id;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n          this.getClassData();\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getEchoDisplayData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getEchoDisplayData();\r\n          break;\r\n      }\r\n    },\r\n    getClassData(_disabledIds) {\r\n      // 获取商品分类  type 1\r\n      this.$common.getClassSelect(this, 1, _disabledIds).then(res => {\r\n        this.classData = res.ztree;\r\n        this.listData = res.list;\r\n      });\r\n      //获取属性分类  type 1\r\n      this.$common.getClassSelect(this, 3).then(res => {\r\n        this.attrClassData = res.ztree;\r\n        this.attrListData = res.list;\r\n      });\r\n    },\r\n    cateChangeGet(e) {\r\n      let careIdArr = this.cateIdArr,\r\n        careIdLen = careIdArr.length;\r\n      let list = this.listData,\r\n        listLen = list.length;\r\n      let categories = [];\r\n      for (let i = 0; i < careIdLen; i++) {\r\n        for (let k = 0; k < listLen; k++) {\r\n          if (careIdArr[i] == list[k].id) {\r\n            categories.push({\r\n              cateId: list[k].id,\r\n              cateName: list[k].name,\r\n              cateIdentifier: list[k].identifier,\r\n              fullCateName: list[k].fullCateName\r\n            });\r\n          }\r\n        }\r\n      }\r\n      this.filtersData.productionMaterialCates = [\r\n        ...categories,\r\n        ...mirroringMaterialCates\r\n      ];\r\n    },\r\n    attrCascaderGet(e) {\r\n      let cateId = JSON.parse(JSON.stringify(e)).pop();\r\n      let obj = this.attrListData.find(item => item.id == cateId);\r\n      this.filtersData.materialCateId = obj.id;\r\n      this.filtersData.materialCateName = obj.name;\r\n      this.filtersData.materialCateIdentifier = obj.identifier;\r\n      this.filtersData.materialFullCateName = obj.fullCateName;\r\n    },\r\n    removeTag(item) {\r\n      if(this._type == 'edit'){\r\n        let exclusions= this.filtersData.productionMaterialExclusions;\r\n        if(exclusions.length >0){\r\n          let flag =false;\r\n          for (let i = 0; i < exclusions.length; i++) {\r\n            if(exclusions[i].exclusionMaterialId == item && exclusions[i].id != null){\r\n                flag=true;\r\n                exclusions[i].status = 9;\r\n            }\r\n          }\r\n          if(!flag){\r\n            let index = exclusions.findIndex((elem) => (elem.exclusionMaterialId ==item));\r\n            if(index != -1){\r\n              this.filtersData.productionMaterialExclusions.splice(index,1)\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //互斥处理\r\n    setMutexGet(item) {\r\n      let mutex = this.setMutexData,\r\n          mutexLen = mutex.length;\r\n        let mutexList = this.mutexList,\r\n          mutexListLen = mutexList.length;\r\n        let categories = [];\r\n        for (let i = 0; i < mutexLen; i++) {\r\n          for (let k = 0; k < mutexListLen; k++) {\r\n            if (mutex[i] == mutexList[k].id) {\r\n              categories.push({\r\n                exclusionMaterialId: mutexList[k].id,\r\n                exclusionMaterialName:mutexList[k].name\r\n              });\r\n            }\r\n          }\r\n        }\r\n        if(this._type == 'edit'){\r\n          let exclusions= this.filtersData.productionMaterialExclusions;\r\n          let list =[];\r\n            for (let i = 0; i < categories.length; i++) {\r\n              let flag=false;\r\n              for (let k = 0; k < exclusions.length; k++) {\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId){\r\n                  flag=true;\r\n                }\r\n                if(exclusions[k].exclusionMaterialId == categories[i].exclusionMaterialId && exclusions[k].id!= null){\r\n                  exclusions[k].status=1;\r\n                }\r\n              }\r\n              if(!flag){\r\n                list.push(categories[i])\r\n              }else{\r\n              }\r\n            }\r\n           this.filtersData.productionMaterialExclusions = [...list,...exclusions];\r\n        }else{\r\n          this.filtersData.productionMaterialExclusions = categories;\r\n        }\r\n    },\r\n    //提交\r\n    submitForm(formName) {\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          let Exclusions = this.filtersData.productionMaterialExclusions;\r\n          for (let i = 0; i < Exclusions.length; i++) {\r\n            Exclusions[i].materialId =\r\n              this.filtersData.id != \"\" ? this.filtersData.id : \"\";\r\n            Exclusions[i].materialName = this.filtersData.name;\r\n          }\r\n          this.request(\r\n            this.api.product.productionMaterial_save,\r\n            this.filtersData\r\n          ).then(res => {\r\n            this.$message.success(\"保存成功\");\r\n            setTimeout(() => {\r\n              this.routerback();\r\n            }, 500);\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n\r\n    //回显\r\n    getEchoDisplayData() {\r\n      this.request(this.api.product.productionMaterial_get, {\r\n        id: this._id\r\n      }).then(res => {\r\n        this.filtersData = res;\r\n        if (!!res.image) {\r\n          this.productImages = [{ url: res.image }];\r\n        }\r\n        this.cateArr = [res.cateId];\r\n        this.attrCateArr = [res.materialCateId];\r\n        let Exclusion = res.productionMaterialExclusions;\r\n        let list = [];\r\n        for (let i = 0; i < Exclusion.length; i++) {\r\n          list.push(Exclusion[i].exclusionMaterialId);\r\n        }\r\n        this.setMutexData = list;\r\n        //回显 商品分类已选置灰\r\n        let arr = [],\r\n          cateIds = [];\r\n        let Categories = res.productionMaterialCates;\r\n        mirroringMaterialCates = [...Categories];\r\n        if (Categories.length > 0) {\r\n          for (let i = 0; i < Categories.length; i++) {\r\n            arr.push(Categories[i].fullCateName); //此处的字段是错误的\r\n            cateIds.push(Categories[i].cateId);\r\n          }\r\n          this.cateNames = arr.join(\"、\");\r\n        }\r\n        this.getClassData(cateIds);\r\n      });\r\n    },\r\n    //互斥\r\n    getMutexData() {\r\n      this.request(this.api.product.productionMaterial_list, {\r\n        type: 1,\r\n        valid: true\r\n      }).then(res => {\r\n        let _data = res.data;\r\n        if(!!this._id){\r\n          for (let i = 0; i < _data.length; i++) {\r\n            if(_data[i].id == this._id){\r\n              _data.splice(i,1)\r\n              break;\r\n            }\r\n          }\r\n          this.mutexList = _data;\r\n        }else{\r\n          this.mutexList = _data;\r\n        }\r\n      });\r\n    },\r\n    //后退\r\n    routerback() {\r\n      this.$router.go(-1);\r\n    }\r\n  },\r\n  components: {\r\n    ElUploadImg\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.tlogy-item {\r\n  background-color: #ffffff;\r\n  margin: 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-footer {\r\n  background-color: #ffffff;\r\n  margin: 0 10px 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-title {\r\n  font-size: 22px;\r\n  height: 50px;\r\n  line-height: 50px;\r\n  text-indent: 40px;\r\n  border-bottom: 1px solid #eeeeee;\r\n  margin-bottom: 20px;\r\n  em {\r\n    margin-left: 20px;\r\n    font-size: 14px;\r\n    color: #ff6677;\r\n  }\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/product/custom_attrs"}]}