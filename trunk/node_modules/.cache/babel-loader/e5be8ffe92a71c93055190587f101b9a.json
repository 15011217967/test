{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\manage\\material_manage.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\manage\\material_manage.vue","mtime":1574160264886},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport PageTable from '@/views/content/components/PageTable.vue';\nimport UploadImg from '@/components/editor/UploadImg.vue';\nimport UploadVideo from '@/components/editor/UploadVideo.vue';\nexport default {\n  name: 'material_manage',\n  // 数据\n  data: function data() {\n    return {\n      // 素材图片上传地址\n      pictureUploadUrl: this.api.contentCore.picture_upload.url,\n      // 类型默认选中\n      typeActiveIndex: '2',\n      // 2 图片   1 视频\n      tableData: {},\n      // 批量删除选中的\n      checkList: [],\n      // 参数\n      formData: {\n        pageIndex: 1,\n        pageSize: 10,\n        type: 2,\n        title: '',\n        category: [],\n        categoryId: ''\n      },\n      // 分类映射\n      categoryTreeList: [],\n      categoryTreeListProps: {\n        value: '_flag',\n        label: 'name',\n        children: 'children',\n        expandTrigger: 'hover'\n      },\n      // 新增和编辑\n      dialogVisible: false,\n      addAndEditFlag: true,\n      // 分类数据\n      addAndEditCategoryTreeList: [],\n      // 新增图片\n      addAndEditFormData: {\n        type: 2,\n        title: '',\n        url: '',\n        category: [],\n        baseId: '',\n        categoryId: '',\n        showIdentifier: ''\n      },\n      rules: {\n        url: [{\n          type: 'string',\n          required: true,\n          message: '请选择图片',\n          trigger: 'change'\n        }],\n        title: [{\n          type: 'string',\n          required: true,\n          message: '请输入标题',\n          trigger: 'change'\n        }, {\n          max: 15,\n          message: '长度不大于15',\n          trigger: 'change'\n        }],\n        category: [{\n          type: 'array',\n          required: true,\n          message: '请选择分类',\n          trigger: 'change'\n        }]\n      },\n      // 新增视频\n      infoVideo: {},\n      addAndEditVideoFormData: {\n        type: 1,\n        title: '',\n        url: '',\n        category: [],\n        categoryId: '',\n        showIdentifier: '',\n        videoCoverUrl: ''\n      },\n      videoRules: {\n        url: [{\n          type: 'string',\n          required: true,\n          message: '请选择视频',\n          trigger: 'change'\n        }],\n        title: [{\n          type: 'string',\n          required: true,\n          message: '请输入标题',\n          trigger: 'change'\n        }, {\n          max: 15,\n          message: '长度不大于15',\n          trigger: 'change'\n        }],\n        category: [{\n          type: 'array',\n          required: true,\n          message: '请选择分类',\n          trigger: 'change'\n        }]\n      }\n    };\n  },\n  // 组件\n  components: {\n    PageTable: PageTable,\n    UploadImg: UploadImg,\n    UploadVideo: UploadVideo\n  },\n  // 初始化数据\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$nextTick(function () {\n      // sourceType 1 视频  2 图片\n      _this.getCategoryTreeList(2);\n\n      _this.getData();\n    });\n  },\n  // keepAlive 页面显示时\n  activated: function activated() {\n    this.getData();\n  },\n  // 方法\n  methods: {\n    // 点击搜索\n    searchTableData: function searchTableData() {\n      this.formData.pageIndex = 1;\n      this.getData();\n    },\n    // 获取数据\n    getData: function getData() {\n      var _this2 = this;\n\n      var check = this.formData.category;\n\n      if (check && check.length) {\n        this.formData.categoryId = check[check.length - 1].split('&')[0];\n      } else {\n        this.formData.categoryId = '';\n      }\n\n      this.request(this.api.contentCore.library_list, this.formData).then(function (data) {\n        _this2.tableDataInit(data);\n\n        _this2.tableData = data;\n      });\n    },\n    // 初始化数据\n    tableDataInit: function tableDataInit(data) {\n      if (data.data && data.data.length) {\n        var num = new Date().getTime();\n        data.data.forEach(function (item) {\n          // 初始url\n          if (item.videoCoverUrl) {\n            item.videoCoverUrl = item.videoCoverUrl + '?time=' + num;\n          }\n\n          if (item.url) {\n            item.url = item.url + '?time=' + num;\n          } // 初始化分类\n\n\n          if (item.showIdentifier) {\n            if (item.showIdentifier.indexOf('$') > -1) {\n              var ary = item.showIdentifier.split('$');\n              item._categoryName = ary[ary.length - 1].split('&')[1];\n            } else {\n              item._categoryName = item.showIdentifier.split('&')[1];\n            }\n          }\n        });\n      }\n    },\n    // 重置\n    initFormData: function initFormData() {\n      this.formData.title = '';\n      this.formData.category = [];\n    },\n    // 新增和编辑显示\n    dialogVisibleShow: function dialogVisibleShow(flag, row) {\n      var _this3 = this;\n\n      // 重置图片上传信息\n      if (this.typeActiveIndex === '2') {\n        setTimeout(function () {\n          _this3.$refs.form.resetFields();\n        }, 0);\n      } // 重置视频上传信息\n\n\n      if (this.typeActiveIndex === '1') {\n        setTimeout(function () {\n          _this3.$refs.videoForm.resetFields();\n        }, 0);\n      }\n\n      if (flag) {\n        this.addAndEditFlag = true;\n        this.addAndEditVideoFormData.url = '';\n        this.addAndEditVideoFormData.id = '';\n      } else {\n        this.addAndEditFlag = false;\n        this.request(this.api.contentCore.library_get, {\n          id: row.id\n        }).then(function (data) {\n          if (data.type == 2) {\n            _this3.addAndEditFormData = {\n              id: data.id,\n              type: data.type,\n              title: data.title,\n              url: data.url,\n              baseId: data.baseId,\n              category: [],\n              categoryId: data.categoryId,\n              showIdentifier: data.showIdentifier\n            };\n\n            if (data.showIdentifier) {\n              if (data.showIdentifier.indexOf('$') > -1) {\n                var ary = data.showIdentifier.split('$');\n                _this3.addAndEditFormData.category = ary;\n              } else {\n                _this3.addAndEditFormData.category = [data.showIdentifier];\n              }\n            }\n          }\n\n          if (data.type == 1) {\n            _this3.addAndEditVideoFormData = {\n              id: data.id,\n              type: data.type,\n              title: data.title,\n              url: data.url,\n              category: [],\n              categoryId: data.categoryId,\n              showIdentifier: data.showIdentifier,\n              videoCoverUrl: data.videoCoverUrl\n            };\n\n            if (data.showIdentifier) {\n              if (data.showIdentifier.indexOf('$') > -1) {\n                var _ary = data.showIdentifier.split('$');\n\n                _this3.addAndEditVideoFormData.category = _ary;\n              } else {\n                _this3.addAndEditVideoFormData.category = [data.showIdentifier];\n              }\n            }\n          }\n        });\n      }\n\n      this.dialogVisible = true;\n    },\n    addAndEditSub: function addAndEditSub() {\n      var _this4 = this;\n\n      var url = this.api.contentCore.library_save;\n\n      if (!this.addAndEditFlag) {\n        url = this.api.contentCore.library_edit;\n      } // 2  图片\n\n\n      if (this.typeActiveIndex === '2') {\n        this.$refs.form.validate(function (valid) {\n          if (valid) {\n            var data = _this4.addAndEditFormData.category;\n            _this4.addAndEditFormData.categoryId = data[data.length - 1].split('&')[0];\n            _this4.addAndEditFormData.showIdentifier = data.join('$');\n            var params;\n\n            if (_this4.addAndEditFlag) {\n              params = {\n                sourceLibrary: _this4.addAndEditFormData\n              };\n            } else {\n              params = _this4.addAndEditFormData;\n            }\n\n            _this4.request(url, params).then(function (data) {\n              if (_this4.addAndEditFormData.id) {\n                _this4.$notify.success({\n                  title: '成功',\n                  message: '编辑成功'\n                });\n              } else {\n                _this4.$notify.success({\n                  title: '成功',\n                  message: '新增成功'\n                });\n              }\n\n              _this4.getData();\n\n              _this4.dialogVisible = false;\n            });\n          } else {\n            return false;\n          }\n        });\n      } // 1  视频\n\n\n      if (this.typeActiveIndex === '1') {\n        this.$refs.videoForm.validate(function (valid) {\n          if (valid) {\n            var data = _this4.addAndEditVideoFormData.category;\n            _this4.addAndEditVideoFormData.categoryId = data[data.length - 1].split('&')[0];\n            _this4.addAndEditVideoFormData.showIdentifier = data.join('$');\n            var params;\n\n            if (_this4.addAndEditFlag) {\n              _this4.infoVideo = _this4.$refs.addAndEditVideo.getUploadVideoInfo();\n              params = {\n                sourceLibrary: _this4.addAndEditVideoFormData,\n                baseVideo: _this4.infoVideo\n              };\n            } else {\n              params = _this4.addAndEditVideoFormData;\n            }\n\n            _this4.request(url, params).then(function (data) {\n              if (_this4.addAndEditVideoFormData.id) {\n                _this4.$notify.success({\n                  title: '成功',\n                  message: '编辑成功'\n                });\n              } else {\n                _this4.$notify.success({\n                  title: '成功',\n                  message: '新增成功'\n                });\n              }\n\n              _this4.getData();\n\n              _this4.dialogVisible = false;\n            });\n          } else {\n            return false;\n          }\n        });\n      }\n    },\n    // 删除\n    itemDel: function itemDel(flag, row) {\n      var _this5 = this;\n\n      if (!flag && !this.checkList.length) {\n        this.$notify.error({\n          title: '成功',\n          message: '未选择数据'\n        });\n        return;\n      }\n\n      this.$confirm('确认删除吗？', '删除', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        showClose: false\n      }).then(function () {\n        var params = [];\n\n        if (flag) {\n          params.push({\n            id: row.id,\n            baseId: row.baseId,\n            type: row.type,\n            categoryId: row.categoryId\n          });\n        }\n\n        if (!flag) {\n          _this5.checkList.forEach(function (item) {\n            params.push({\n              id: item.id,\n              baseId: item.baseId,\n              type: item.type,\n              categoryId: item.categoryId\n            });\n          });\n        }\n\n        _this5.request(_this5.api.contentCore.delete_batch, params).then(function (data) {\n          _this5.$notify.success({\n            title: '成功',\n            message: '删除成功'\n          });\n\n          _this5.checkList = [];\n\n          _this5.getData();\n        });\n      }).catch(function () {});\n    },\n    // 类型切换\n    typeActiveSelect: function typeActiveSelect(index, indexPath, event) {\n      this.formData.pageIndex = 1;\n      this.formData.type = index;\n      this.typeActiveIndex = index;\n      this.getCategoryTreeList(index);\n      this.getData();\n    },\n    // 获取分类tree\n    // sourceType 1 视频  2 图片\n    getCategoryTreeList: function getCategoryTreeList(type) {\n      var _this6 = this;\n\n      this.request(this.api.contentCore.source_tree_list, {\n        sourceType: type\n      }).then(function (data) {\n        if (data && data.length) {\n          // 初始化数据\n          _this6.categoryTreeListInit(data);\n\n          _this6.categoryTreeList = data;\n        }\n      });\n    },\n    // 初始数据\n    categoryTreeListInit: function categoryTreeListInit(data) {\n      var _this7 = this;\n\n      if (data && data.length) {\n        data.forEach(function (item) {\n          item._flag = item.id + '&' + item.name;\n\n          if (item.children) {\n            if (item.children.length === 0) {\n              delete item.children;\n            } else {\n              _this7.categoryTreeListInit(item.children);\n            }\n          }\n        });\n      }\n    }\n  },\n  // 过滤器\n  filters: {\n    titleCut: function titleCut(value) {\n      if (!value) return;\n\n      if (value.length > 8) {\n        return value.substr(0, 8) + '...';\n      } else {\n        return value;\n      }\n    }\n  },\n  // 计算属性\n  computed: {},\n  // 监听数据变化\n  watch: {}\n};",{"version":3,"sources":["material_manage.vue"],"names":[],"mappings":"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","sourcesContent":["<!--\r\n * @Description: In User Settings Edit\r\n * @Author: your name\r\n * @Date: 2019-08-20 08:58:18\r\n * @LastEditTime: 2019-08-20 14:29:26\r\n * @LastEditors: Please set LastEditors\r\n -->\r\n<style lang=\"less\" scoped>\r\n  @import \"../style/contentPublic.less\";\r\n  .material_manage{\r\n    .form-data{padding: 20px;position: relative;\r\n      .total{margin-right: 20px;}\r\n      .form{position: absolute;right: 20px;top: 15px;}\r\n    }\r\n    .item-list{\r\n      .item{width: 20%;float: left;padding: 0 1%;position: relative;margin-bottom: 20px;text-align: left;\r\n        .item-inner{border: 1px solid #e6e8ed;padding: 8px;\r\n          .img{width: 100%;height: 150px;}\r\n          img,video{ width: 100%;height: 150px;}\r\n          .info{padding-left: 10px;\r\n            h3{padding-top: 10px;font-size:18px;}\r\n            p{font-size: 14px;line-height: 32px;}\r\n          }\r\n        }\r\n        .item-checkbox{position: absolute;right: -9px;bottom: 14px;}\r\n      }\r\n    }\r\n    .no-content{height: 60px;line-height: 60px;border-bottom: 1px solid #e6e6e6;border-top: 1px solid #e6e6e6;text-align: center;color: #909399;}\r\n    .add-edit  /deep/ .el-input__inner{width: 200px;}\r\n    .edit-img,.edit-video{width: 80px;height: 80px;}\r\n  }\r\n\r\n</style>\r\n<template>\r\n  <div class=\"material_manage page-public\">\r\n    <div class=\"page-main\">\r\n      <div class=\"page-main-inner item-margin\">\r\n        <el-menu :default-active=\"typeActiveIndex\" class=\"el-menu-demo page-menu-border\" mode=\"horizontal\" @select=\"typeActiveSelect\">\r\n          <el-menu-item index=\"2\">图片</el-menu-item>\r\n          <el-menu-item index=\"1\">视频</el-menu-item>\r\n        </el-menu>\r\n        <div class=\"form-data\">\r\n          <span class=\"total\" v-show=\"typeActiveIndex == 2\">共{{ tableData.totalCount }}张图片</span>\r\n          <span class=\"total\" v-show=\"typeActiveIndex == 1\">共{{ tableData.totalCount }}个视频</span>\r\n          <el-button size=\"small\" @click=\"itemDel(false)\">批量删除</el-button>\r\n          <el-button type=\"primary\" @click=\"dialogVisibleShow(true)\" size=\"small\">上传</el-button>\r\n          <div class=\"form\">\r\n            <el-form :inline=\"true\" :model=\"formData\" class=\"demo-form-inline\" size=\"small\" ref=\"form\">\r\n              <el-form-item label=\"\">\r\n                <el-input v-model=\"formData.title\" placeholder=\"请输入关键字搜索内容\" suffix-icon=\"el-icon-search\" @keyup.13.native=\"searchTableData\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"素材分类：\">\r\n                <el-cascader :options=\"categoryTreeList\" v-model=\"formData.category\" :props=\"categoryTreeListProps\" :show-all-levels=\"false\" clearable>\r\n                </el-cascader>\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" plain @click=\"searchTableData\" size=\"small\">搜索</el-button>\r\n                <el-button plain @click=\"initFormData\" size=\"small\">重置</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </div>\r\n        <page-table :form-data=\"formData\" :get-data=\"getData\" :table-data=\"tableData\">\r\n          <div v-show=\"!tableData.data || (tableData.data && tableData.data.length === 0)\" class=\"no-content\">暂无数据</div>\r\n          <div class=\"item-list clearfix\">\r\n            <el-checkbox-group v-model=\"checkList\">\r\n              <div class=\"item\" v-for=\"item in tableData.data\">\r\n                <el-checkbox :label=\"item\" class=\"item-checkbox\" :key=\"item.id\"><div></div></el-checkbox>\r\n                <div class=\"item-inner\">\r\n                  <div class=\"img\">\r\n                    <el-image style=\"width: 100%; height: 100%\" :src=\"item.url\" fit=\"contain\" v-if=\"formData.type == '2'\"></el-image>\r\n                    <el-image style=\"width: 100%; height: 100%\" :src=\"item.videoCoverUrl\" fit=\"contain\" v-if=\"formData.type == '1'\"></el-image>\r\n                  </div>\r\n                  <div class=\"info\">\r\n                    <h4 :title=\"item.title\">{{ item.title | titleCut }}</h4>\r\n                    <p v-if=\"item._categoryName\">分类：{{ item._categoryName }}</p>\r\n                    <div class=\"btns\">\r\n                      <el-button type=\"text\" size=\"small\" @click=\"dialogVisibleShow(false, item )\">编辑</el-button>\r\n                      <el-button type=\"text\" size=\"small\" @click=\"itemDel(true,item)\">删除</el-button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </el-checkbox-group>\r\n          </div>\r\n        </page-table>\r\n        <!--新增和编辑-->\r\n        <el-dialog :title=\"addAndEditFlag ? '新增' : '编辑'\" :visible.sync=\"dialogVisible\" width=\"30%\" class=\"add-edit\">\r\n          <el-form ref=\"form\" :model=\"addAndEditFormData\" label-width=\"80px\" :rules=\"rules\" v-if=\"typeActiveIndex === '2'\" :key=\"typeActiveIndex\">\r\n            <el-form-item label=\"图片\" prop=\"url\">\r\n              <upload-img v-model=\"addAndEditFormData.url\" v-if=\"addAndEditFlag\" :action-url=\"pictureUploadUrl\" :content-txt=\"'上传图片'\" :baseId.sync=\"addAndEditFormData.baseId\"></upload-img>\r\n              <img :src=\"addAndEditFormData.url\" alt=\"\" class=\"edit-img\"  v-if=\"!addAndEditFlag\">\r\n            </el-form-item>\r\n            <el-form-item label=\"标题\" prop=\"title\">\r\n              <el-input v-model=\"addAndEditFormData.title\" placeholder=\"请输入标题\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"分类\" prop=\"category\">\r\n              <el-cascader :options=\"categoryTreeList\" v-model=\"addAndEditFormData.category\" :props=\"categoryTreeListProps\">\r\n              </el-cascader>\r\n            </el-form-item>\r\n          </el-form>\r\n          <el-form ref=\"videoForm\" :model=\"addAndEditVideoFormData\" label-width=\"80px\" :rules=\"videoRules\" v-if=\"typeActiveIndex === '1'\" :key=\"typeActiveIndex\">\r\n            <el-form-item label=\"视频\" prop=\"url\">\r\n              <upload-video v-model=\"addAndEditVideoFormData.url\" v-if=\"dialogVisible && addAndEditFlag\" ref=\"addAndEditVideo\"></upload-video>\r\n              <img :src=\"addAndEditVideoFormData.videoCoverUrl\" alt=\"\" class=\"edit-img\"  v-if=\"!addAndEditFlag\">\r\n            </el-form-item>\r\n            <el-form-item label=\"标题\" prop=\"title\">\r\n              <el-input v-model=\"addAndEditVideoFormData.title\" placeholder=\"请输入标题\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"分类\" prop=\"category\">\r\n              <el-cascader :options=\"categoryTreeList\" v-model=\"addAndEditVideoFormData.category\" :props=\"categoryTreeListProps\">\r\n              </el-cascader>\r\n            </el-form-item>\r\n          </el-form>\r\n          <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"addAndEditSub\">确 定</el-button>\r\n        </span>\r\n        </el-dialog>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import PageTable from '@/views/content/components/PageTable.vue'\r\n  import UploadImg from '@/components/editor/UploadImg.vue'\r\n  import UploadVideo from '@/components/editor/UploadVideo.vue'\r\n  export default {\r\n    name: 'material_manage',\r\n    // 数据\r\n    data() {\r\n      return {\r\n        // 素材图片上传地址\r\n        pictureUploadUrl: this.api.contentCore.picture_upload.url,\r\n        // 类型默认选中\r\n        typeActiveIndex: '2',  // 2 图片   1 视频\r\n        tableData: {},\r\n        // 批量删除选中的\r\n        checkList: [],\r\n        // 参数\r\n        formData: {\r\n          pageIndex: 1,\r\n          pageSize: 10,\r\n          type: 2,\r\n          title: '',\r\n          category: [],\r\n          categoryId: ''\r\n        },\r\n        // 分类映射\r\n        categoryTreeList: [],\r\n        categoryTreeListProps:{\r\n          value: '_flag',\r\n          label: 'name',\r\n          children: 'children',\r\n          expandTrigger: 'hover'\r\n        },\r\n\r\n        // 新增和编辑\r\n        dialogVisible: false,\r\n        addAndEditFlag: true,\r\n        // 分类数据\r\n        addAndEditCategoryTreeList: [],\r\n        // 新增图片\r\n        addAndEditFormData: {\r\n          type: 2,\r\n          title: '',\r\n          url:'',\r\n          category: [],\r\n          baseId: '',\r\n          categoryId:  '',\r\n          showIdentifier: ''\r\n        },\r\n        rules: {\r\n          url: [\r\n            { type: 'string',required: true, message: '请选择图片', trigger: 'change' }\r\n          ],\r\n          title:[\r\n            { type: 'string',required: true, message: '请输入标题', trigger: 'change' },\r\n            { max: 15, message: '长度不大于15', trigger: 'change' }\r\n          ],\r\n          category: [\r\n            { type: 'array',required: true, message: '请选择分类', trigger: 'change' },\r\n\r\n          ]\r\n        },\r\n        // 新增视频\r\n        infoVideo: {},\r\n        addAndEditVideoFormData: {\r\n          type: 1,\r\n          title: '',\r\n          url:'',\r\n          category: [],\r\n          categoryId:  '',\r\n          showIdentifier: '',\r\n          videoCoverUrl: ''\r\n        },\r\n        videoRules: {\r\n          url: [\r\n            { type: 'string',required: true, message: '请选择视频', trigger: 'change' }\r\n          ],\r\n          title:[\r\n            { type: 'string',required: true, message: '请输入标题', trigger: 'change' },\r\n            { max: 15, message: '长度不大于15', trigger: 'change' }\r\n          ],\r\n          category: [\r\n            { type: 'array',required: true, message: '请选择分类', trigger: 'change' },\r\n          ]\r\n        },\r\n      }\r\n    },\r\n    // 组件\r\n    components: {\r\n      PageTable,\r\n      UploadImg,\r\n      UploadVideo\r\n    },\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        // sourceType 1 视频  2 图片\r\n        this.getCategoryTreeList(2)\r\n        this.getData()\r\n      })\r\n    },\r\n    // keepAlive 页面显示时\r\n    activated() {\r\n      this.getData();\r\n    },\r\n    // 方法\r\n    methods: {\r\n      // 点击搜索\r\n      searchTableData(){\r\n        this.formData.pageIndex = 1;\r\n        this.getData();\r\n      },\r\n      // 获取数据\r\n      getData(){\r\n        let check = this.formData.category\r\n        if(check && check.length){\r\n          this.formData.categoryId = check[check.length-1].split('&')[0]\r\n        }else {\r\n          this.formData.categoryId = ''\r\n        }\r\n        this.request(this.api.contentCore.library_list, this.formData).then(data => {\r\n          this.tableDataInit(data)\r\n          this.tableData = data\r\n        })\r\n      },\r\n      // 初始化数据\r\n      tableDataInit(data){\r\n        if(data.data && data.data.length){\r\n          const num = new Date().getTime()\r\n          data.data.forEach(item => {\r\n            // 初始url\r\n            if(item.videoCoverUrl){\r\n              item.videoCoverUrl = item.videoCoverUrl + '?time=' + num\r\n            }\r\n            if(item.url){\r\n              item.url = item.url + '?time=' + num\r\n            }\r\n            // 初始化分类\r\n            if(item.showIdentifier){\r\n              if(item.showIdentifier.indexOf('$') > -1){\r\n                let ary = item.showIdentifier.split('$')\r\n                item._categoryName = ary[ary.length-1].split('&')[1]\r\n              }else {\r\n                item._categoryName = item.showIdentifier.split('&')[1]\r\n              }\r\n            }\r\n          })\r\n        }\r\n      },\r\n      // 重置\r\n      initFormData(){\r\n        this.formData.title = ''\r\n        this.formData.category = []\r\n      },\r\n      // 新增和编辑显示\r\n      dialogVisibleShow(flag, row){\r\n        // 重置图片上传信息\r\n        if(this.typeActiveIndex === '2'){\r\n          setTimeout(() => {\r\n            this.$refs.form.resetFields()\r\n          },0)\r\n        }\r\n        // 重置视频上传信息\r\n        if(this.typeActiveIndex === '1'){\r\n          setTimeout(() => {\r\n            this.$refs.videoForm.resetFields()\r\n          },0)\r\n        }\r\n        if(flag){\r\n          this.addAndEditFlag = true\r\n          this.addAndEditVideoFormData.url = ''\r\n          this.addAndEditVideoFormData.id = ''\r\n        }else{\r\n          this.addAndEditFlag = false\r\n          this.request(this.api.contentCore.library_get, {id: row.id }).then(data => {\r\n            if(data.type == 2){\r\n              this.addAndEditFormData ={\r\n                id: data.id,\r\n                type: data.type,\r\n                title: data.title,\r\n                url: data.url,\r\n                baseId: data.baseId,\r\n                category: [],\r\n                categoryId: data.categoryId,\r\n                showIdentifier: data.showIdentifier\r\n              }\r\n              if(data.showIdentifier){\r\n                if(data.showIdentifier.indexOf('$') > -1){\r\n                  let ary = data.showIdentifier.split('$')\r\n                  this.addAndEditFormData.category = ary\r\n                }else {\r\n                  this.addAndEditFormData.category = [data.showIdentifier]\r\n                }\r\n              }\r\n            }\r\n            if(data.type == 1){\r\n              this.addAndEditVideoFormData ={\r\n                id: data.id,\r\n                type: data.type,\r\n                title: data.title,\r\n                url: data.url,\r\n                category: [],\r\n                categoryId: data.categoryId,\r\n                showIdentifier: data.showIdentifier,\r\n                videoCoverUrl: data.videoCoverUrl\r\n              }\r\n              if(data.showIdentifier){\r\n                if(data.showIdentifier.indexOf('$') > -1){\r\n                  let ary = data.showIdentifier.split('$')\r\n                  this.addAndEditVideoFormData.category = ary\r\n                }else {\r\n                  this.addAndEditVideoFormData.category = [data.showIdentifier]\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }\r\n        this.dialogVisible = true\r\n\r\n      },\r\n      addAndEditSub(){\r\n        let url = this.api.contentCore.library_save\r\n        if(!this.addAndEditFlag){\r\n          url = this.api.contentCore.library_edit\r\n        }\r\n        // 2  图片\r\n        if(this.typeActiveIndex === '2'){\r\n          this.$refs.form.validate((valid) => {\r\n            if (valid) {\r\n              let data = this.addAndEditFormData.category\r\n              this.addAndEditFormData.categoryId = data[data.length-1].split('&')[0]\r\n              this.addAndEditFormData.showIdentifier = data.join('$')\r\n              let params\r\n              if(this.addAndEditFlag){\r\n                params = {\r\n                  sourceLibrary: this.addAndEditFormData\r\n                }\r\n              }else {\r\n                params = this.addAndEditFormData\r\n              }\r\n\r\n              this.request(url, params).then(data => {\r\n                if(this.addAndEditFormData.id){\r\n                  this.$notify.success({ title: '成功',message: '编辑成功'})\r\n                }else {\r\n                  this.$notify.success({ title: '成功',message: '新增成功'})\r\n                }\r\n                this.getData()\r\n                this.dialogVisible = false\r\n              })\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n        // 1  视频\r\n        if(this.typeActiveIndex === '1'){\r\n          this.$refs.videoForm.validate((valid) => {\r\n            if (valid) {\r\n              let data = this.addAndEditVideoFormData.category\r\n              this.addAndEditVideoFormData.categoryId = data[data.length-1].split('&')[0]\r\n              this.addAndEditVideoFormData.showIdentifier = data.join('$')\r\n              let params\r\n              if(this.addAndEditFlag){\r\n                this.infoVideo = this.$refs.addAndEditVideo.getUploadVideoInfo()\r\n                params = {\r\n                  sourceLibrary: this.addAndEditVideoFormData,\r\n                  baseVideo: this.infoVideo\r\n                }\r\n              }else {\r\n                params = this.addAndEditVideoFormData\r\n              }\r\n              this.request(url, params).then(data => {\r\n                if(this.addAndEditVideoFormData.id){\r\n                  this.$notify.success({ title: '成功',message: '编辑成功'})\r\n                }else {\r\n                  this.$notify.success({ title: '成功',message: '新增成功'})\r\n                }\r\n                this.getData()\r\n                this.dialogVisible = false\r\n              })\r\n            } else {\r\n              return false;\r\n            }\r\n          });\r\n        }\r\n      },\r\n      // 删除\r\n      itemDel(flag,row){\r\n        if(!flag && !this.checkList.length){\r\n          this.$notify.error({ title: '成功',message: '未选择数据'})\r\n          return\r\n        }\r\n        this.$confirm('确认删除吗？', '删除', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          showClose:false\r\n        }).then(() => {\r\n          let params = []\r\n          if(flag){\r\n            params.push({\r\n              id: row.id,\r\n              baseId: row.baseId,\r\n              type: row.type,\r\n              categoryId: row.categoryId\r\n            })\r\n          }\r\n          if(!flag){\r\n            this.checkList.forEach(item => {\r\n              params.push({\r\n                id: item.id,\r\n                baseId: item.baseId,\r\n                type: item.type,\r\n                categoryId: item.categoryId\r\n              })\r\n            })\r\n          }\r\n          this.request(this.api.contentCore.delete_batch, params).then(data => {\r\n            this.$notify.success({ title: '成功',message: '删除成功'})\r\n            this.checkList = []\r\n            this.getData()\r\n          });\r\n        }).catch(() => {\r\n\r\n        });\r\n      },\r\n      // 类型切换\r\n      typeActiveSelect(index,indexPath,event) {\r\n        this.formData.pageIndex = 1\r\n        this.formData.type = index\r\n        this.typeActiveIndex = index\r\n        this.getCategoryTreeList(index)\r\n        this.getData()\r\n      },\r\n      // 获取分类tree\r\n      // sourceType 1 视频  2 图片\r\n      getCategoryTreeList(type){\r\n        this.request(this.api.contentCore.source_tree_list, {sourceType: type}).then(data => {\r\n          if(data && data.length){\r\n            // 初始化数据\r\n            this.categoryTreeListInit(data)\r\n            this.categoryTreeList = data\r\n          }\r\n        });\r\n      },\r\n      // 初始数据\r\n      categoryTreeListInit(data){\r\n        if(data && data.length){\r\n          data.forEach((item)=>{\r\n            item._flag = item.id +'&'+ item.name\r\n            if(item.children){\r\n              if(item.children.length === 0){\r\n                delete item.children\r\n              }else {\r\n                this.categoryTreeListInit(item.children)\r\n              }\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    // 过滤器\r\n    filters: {\r\n      titleCut: function (value) {\r\n        if(!value) return\r\n        if(value.length > 8){\r\n          return value.substr(0, 8) + '...'\r\n        }else {\r\n          return value\r\n        }\r\n\r\n      }\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {}\r\n  }\r\n</script>\r\n"],"sourceRoot":"src/views/content/manage"}]}