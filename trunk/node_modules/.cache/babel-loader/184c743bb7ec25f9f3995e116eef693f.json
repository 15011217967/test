{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OC\\user\\roleManage_details.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OC\\user\\roleManage_details.vue","mtime":1572415125205},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.to-string\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport codeSet from \"@/components/codeSet\";\nimport treePer from \"@/components/treePermission\";\nexport default {\n  components: {\n    codeSet: codeSet,\n    treePer: treePer\n  },\n  data: function data() {\n    return {\n      filtersData: {\n        name: \"\",\n        type: \"\",\n        code: \"\"\n      },\n      _id: null,\n      topChecked: false,\n      tableData: [],\n      isAdd: false,\n      isEdit: false,\n      isShow: false,\n      // 数据权限\n      dataAuthList: [{\n        name: '个人',\n        authType: 0\n      }, {\n        name: '部门',\n        authType: 1\n      }, {\n        name: '部门及以下',\n        authType: 2\n      }, {\n        name: '机构',\n        authType: 3\n      }]\n    };\n  },\n  created: function created() {\n    this.getQueryparams();\n  },\n  methods: {\n    // 获取上页面参数及初始化页面数据\n    getQueryparams: function getQueryparams() {\n      var t_type = this.$route.query.type;\n      this._id = this.$route.query.id;\n\n      switch (t_type.toString()) {\n        case \"add\":\n          //新增\n          this.isAdd = true;\n          break;\n\n        case \"edit\":\n          //修改\n          this.isEdit = true;\n          break;\n\n        case \"show\":\n          //查看\n          this.isShow = true;\n          break;\n      }\n\n      this.getInfo();\n      this.getData();\n    },\n    // 编辑获取详情\n    getInfo: function () {\n      var _getInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var da;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!this.isEdit) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _context.next = 3;\n                return this.request(this.api.user.role_get, {\n                  id: this._id\n                });\n\n              case 3:\n                da = _context.sent;\n                this.filtersData = da;\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getInfo() {\n        return _getInfo.apply(this, arguments);\n      }\n\n      return getInfo;\n    }(),\n    // 获取数据\n    getData: function () {\n      var _getData = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var list;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.request(this.api.system.Role_Auth_Tree, {\n                  roleId: this._id\n                });\n\n              case 2:\n                list = _context2.sent;\n                this.topChecked = list.findIndex(function (f) {\n                  return f.checked;\n                }) > -1;\n                this.tableDataInit(list);\n                this.tableData = list;\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getData() {\n        return _getData.apply(this, arguments);\n      }\n\n      return getData;\n    }(),\n    tableDataInit: function tableDataInit(data) {\n      var _this = this;\n\n      if (data && data.length) {\n        data.forEach(function (item) {\n          if (item.leaf) {\n            var dataAuthChecked = item.sublist.find(function (item) {\n              return item.type === 'dataAuth';\n            });\n\n            if (dataAuthChecked) {\n              item._dataAuthChecked = dataAuthChecked.authType;\n            } else {\n              item._dataAuthChecked = 0;\n            }\n\n            item.sublist = item.sublist.filter(function (item) {\n              return item.type === 'auth';\n            });\n            item._dataAuthList = _this.dataAuthList.map(function (auth) {\n              return {\n                name: auth.name,\n                authType: auth.authType,\n                menuId: item.id\n              };\n            });\n          } else {\n            _this.tableDataInit(item.sublist);\n          }\n        });\n      }\n    },\n    // 后退\n    routerback: function routerback() {\n      this.$router.go(-1);\n    },\n    // 返回权限设置是否全选\n    treeChange: function treeChange(topChecked) {\n      var hasChecked = this.tableData.findIndex(function (f) {\n        return f.checked;\n      }) > -1;\n\n      if (hasChecked) {\n        this.topChecked = hasChecked;\n      } else {\n        this.topChecked = topChecked;\n      }\n    },\n    // 新增和编辑提交\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      if (this.isAdd || this.isEdit) {\n        var url = this.isAdd ? this.api.user.role_create : this.api.user.role_update;\n        this.$refs[formName].validate(function (valid) {\n          if (valid) {\n            var perDa = _this2.combinaParams();\n\n            var postDa = {\n              id: _this2._id,\n              type: _this2.filtersData.type,\n              name: _this2.filtersData.name,\n              code: _this2.filtersData.code,\n              menuList: perDa.menus,\n              authList: perDa.ops,\n              dataAuthList: perDa.dataAuthList,\n              used: true\n            };\n\n            _this2.request(url, postDa).then(function (data) {\n              _this2.routerback();\n            });\n          }\n        });\n      }\n    },\n    // 获取参数权限设置参数\n    combinaParams: function combinaParams() {\n      var list = this.tableData;\n      var allList = {\n        menus: [],\n        ops: [],\n        dataAuthList: []\n      };\n      this.recurveData(allList, list);\n      return allList;\n    },\n    recurveData: function recurveData(allList, list) {\n      var _this3 = this;\n\n      list.forEach(function (f) {\n        if (f.leaf) {\n          var dataAuth = f._dataAuthList.find(function (item) {\n            return item.authType === f._dataAuthChecked;\n          });\n\n          allList.dataAuthList.push(dataAuth);\n        }\n\n        if (f.checked) {\n          switch (f.type) {\n            case \"menu\":\n              allList.menus.push(f.id);\n              break;\n\n            case \"auth\":\n              allList.ops.push(f.id);\n              break;\n          }\n        }\n\n        if (f.sublist && f.sublist.length > 0) {\n          _this3.recurveData(allList, f.sublist);\n        }\n      });\n    },\n    // 功能权限全选\n    perChange: function perChange(val) {\n      var _this4 = this;\n\n      this.tableData.forEach(function (f) {\n        f.checked = val;\n\n        if (f.sublist && f.sublist.length > 0) {\n          _this4.cbChange(f.sublist, val);\n        }\n      });\n    },\n    cbChange: function cbChange(list, checked) {\n      var _this5 = this;\n\n      list.forEach(function (f) {\n        f.checked = checked;\n\n        if (f.sublist && f.sublist.length > 0) {\n          _this5.cbChange(f.sublist, checked);\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["roleManage_details.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"bg-fff item-margin roleManage-details\">\r\n    <div class=\"titles\">角色信息</div>\r\n    <el-form\r\n      class=\"item-form\"\r\n      :model=\"filtersData\"\r\n      label-width=\"100px\"\r\n      size=\"small\"\r\n      ref=\"filtersForm\"\r\n      inline\r\n      style=\"background: #fff;\"\r\n    >\r\n      <el-row>\r\n        <el-col :span=\"24\">\r\n          <el-form-item\r\n            prop=\"name\"\r\n            label=\"角色名称：\"\r\n            :rules=\"[{ required: true, message: '请输入角色名称', trigger: 'blur' },{ max: 10, message: '角色名称最多10个字符', trigger: 'change' }]\"\r\n          >\r\n            <el-input\r\n              class=\"input-w\"\r\n              placeholder=\"请输入内容\"\r\n              :disabled=\"isShow\"\r\n              v-model=\"filtersData.name\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item\r\n            :disabled=\"isShow\"\r\n            prop=\"type\"\r\n            label=\"角色类型：\"\r\n            :rules=\"[{ required: true, message: '请选择角色类型', trigger: 'blur' },]\"\r\n          >\r\n            <code-set v-model=\"filtersData.type\" code=\"CEN003\"/>\r\n          </el-form-item>\r\n        </el-col>\r\n      </el-row>\r\n    </el-form>\r\n    <div class=\"titles\">权限设置</div>\r\n    <div class=\"rebort_table\">\r\n      <ul class=\"rebort_table_title rebort_table_title_top\">\r\n        <li>\r\n          <el-checkbox v-model=\"topChecked\" @change=\"perChange\">功能权限</el-checkbox>\r\n        </li>\r\n        <li>操作权限</li>\r\n        <li>字段权限</li>\r\n        <li class=\"lasttopli\">数据权限</li>\r\n      </ul>\r\n      <tree-per :data=\"tableData\" @item-change=\"treeChange\"></tree-per>\r\n    </div>\r\n    <div class=\"item-footer\">\r\n      <el-button v-if=\"isEdit||isAdd\" @click=\"submitForm('filtersForm')\" type=\"primary\" size=\"small\">确定</el-button>\r\n      <el-button @click=\"routerback('filtersForm')\" size=\"small\">取消</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport codeSet from \"@/components/codeSet\";\r\nimport treePer from \"@/components/treePermission\";\r\nexport default {\r\n  components: { codeSet, treePer },\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        name: \"\",\r\n        type: \"\",\r\n        code: \"\"\r\n      },\r\n      _id: null,\r\n      topChecked: false,\r\n      tableData: [],\r\n      isAdd: false,\r\n      isEdit: false,\r\n      isShow: false,\r\n      // 数据权限\r\n      dataAuthList: [\r\n        {name: '个人', authType: 0},\r\n        {name: '部门', authType: 1},\r\n        {name: '部门及以下', authType: 2},\r\n        {name: '机构', authType: 3}\r\n      ]\r\n    };\r\n  },\r\n  created() {\r\n    this.getQueryparams();\r\n  },\r\n  methods: {\r\n    // 获取上页面参数及初始化页面数据\r\n    getQueryparams() {\r\n      let t_type = this.$route.query.type;\r\n      this._id = this.$route.query.id;\r\n      switch (t_type.toString()) {\r\n        case \"add\": //新增\r\n          this.isAdd = true;\r\n          break;\r\n        case \"edit\": //修改\r\n          this.isEdit = true;\r\n          break;\r\n        case \"show\": //查看\r\n          this.isShow = true;\r\n          break;\r\n      }\r\n      this.getInfo();\r\n      this.getData();\r\n    },\r\n    // 编辑获取详情\r\n    async getInfo() {\r\n      if (this.isEdit) {\r\n        var da = await this.request(this.api.user.role_get, {\r\n          id: this._id\r\n        });\r\n        this.filtersData = da;\r\n      }\r\n    },\r\n    // 获取数据\r\n    async getData() {\r\n      var list = await this.request(this.api.system.Role_Auth_Tree, {\r\n        roleId: this._id\r\n      });\r\n      this.topChecked = list.findIndex(f => f.checked) > -1;\r\n      this.tableDataInit(list);\r\n      this.tableData = list;\r\n    },\r\n    tableDataInit(data){\r\n      if(data && data.length){\r\n        data.forEach(item => {\r\n          if(item.leaf){\r\n            let dataAuthChecked = item.sublist.find(item => item.type === 'dataAuth');\r\n            if(dataAuthChecked){\r\n              item._dataAuthChecked = dataAuthChecked.authType;\r\n            }else {\r\n              item._dataAuthChecked = 0\r\n            }\r\n            item.sublist = item.sublist.filter(item => item.type === 'auth' );\r\n            item._dataAuthList = this.dataAuthList.map(auth => {\r\n              return {\r\n                name: auth.name,\r\n                authType: auth.authType,\r\n                menuId: item.id\r\n              }\r\n            })\r\n          }else{\r\n            this.tableDataInit(item.sublist);\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 后退\r\n    routerback() {\r\n      this.$router.go(-1);\r\n    },\r\n    // 返回权限设置是否全选\r\n    treeChange(topChecked) {\r\n      var hasChecked = this.tableData.findIndex(f => f.checked) > -1;\r\n      if (hasChecked) {\r\n        this.topChecked = hasChecked;\r\n      } else {\r\n        this.topChecked = topChecked;\r\n      }\r\n    },\r\n    // 新增和编辑提交\r\n    submitForm(formName) {\r\n      if (this.isAdd || this.isEdit) {\r\n        let url = this.isAdd\r\n          ? this.api.user.role_create\r\n          : this.api.user.role_update;\r\n        this.$refs[formName].validate(valid => {\r\n          if (valid) {\r\n            let perDa = this.combinaParams();\r\n            let postDa = {\r\n              id: this._id,\r\n              type: this.filtersData.type,\r\n              name: this.filtersData.name,\r\n              code: this.filtersData.code,\r\n              menuList: perDa.menus,\r\n              authList: perDa.ops,\r\n              dataAuthList: perDa.dataAuthList,\r\n              used: true\r\n            };\r\n            this.request(url, postDa).then(data => {\r\n              this.routerback();\r\n            });\r\n          }\r\n        });\r\n      }\r\n    },\r\n    // 获取参数权限设置参数\r\n    combinaParams() {\r\n      var list = this.tableData;\r\n      let allList = {\r\n        menus: [],\r\n        ops: [],\r\n        dataAuthList: []\r\n      };\r\n      this.recurveData(allList, list);\r\n      return allList;\r\n    },\r\n    recurveData(allList, list) {\r\n      list.forEach(f => {\r\n        if(f.leaf){\r\n          let dataAuth = f._dataAuthList.find(item => {\r\n            return item.authType === f._dataAuthChecked\r\n          });\r\n          allList.dataAuthList.push(dataAuth);\r\n        }\r\n        if (f.checked) {\r\n          switch (f.type) {\r\n            case \"menu\":\r\n              allList.menus.push(f.id);\r\n              break;\r\n            case \"auth\":\r\n              allList.ops.push(f.id);\r\n              break;\r\n          }\r\n        }\r\n        if (f.sublist && f.sublist.length > 0) {\r\n          this.recurveData(allList, f.sublist);\r\n        }\r\n      });\r\n    },\r\n    // 功能权限全选\r\n    perChange(val) {\r\n      this.tableData.forEach(f => {\r\n        f.checked = val;\r\n        if (f.sublist && f.sublist.length > 0) {\r\n          this.cbChange(f.sublist, val);\r\n        }\r\n      });\r\n    },\r\n    cbChange(list, checked) {\r\n      list.forEach(f => {\r\n        f.checked = checked;\r\n        if (f.sublist && f.sublist.length > 0) {\r\n          this.cbChange(f.sublist, checked);\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n  .roleManage-details /deep/ .el-radio {margin-right: 10px;}\r\n\r\n  .title {\r\n  background-color: #fff;\r\n  padding: 15px 0 15px 30px;\r\n  margin-bottom: 10px;\r\n}\r\n.titles {\r\n  width: 100%;\r\n  height: 80px;\r\n  background: #fff;\r\n  display: flex;\r\n  align-items: center;\r\n  padding-left: 18px;\r\n  box-sizing: border-box;\r\n  font-weight: bold;\r\n}\r\n\r\n.rebort_table {\r\n  padding: 0 18px;\r\n  box-sizing: border-box;\r\n  background: #fff;\r\n}\r\n.rebort_table_title {\r\n  display: flex;\r\n  border: 1px solid #ccc;\r\n  border-right: none;\r\n  border-top: none;\r\n}\r\n.rebort_table_title {\r\n  border-top: 1px solid #ccc;\r\n}\r\n.rebort_table_title li {\r\n  width: calc(25%-13px);\r\n}\r\n.rebort_table_title:last-child,\r\n.rebort_table_list:last-child {\r\n  border-bottom: 1px solid #ccc;\r\n}\r\n.rebort_table_title li,\r\n.rebort_table_list li {\r\n  width: 25.6%;\r\n  height: 47px;\r\n  display: flex;\r\n  align-items: center;\r\n  border-right: 1px solid #ccc;\r\n  padding-left: 18px;\r\n  /* box-sizing: border-box; */\r\n}\r\n.rebort_table_title li:last-child {\r\n  /* background-color: rebeccapurple; */\r\n  width: 25.6%;\r\n}\r\n.el-checkbox {\r\n  margin-right: 10px;\r\n}\r\n.item-footer {\r\n  background: #fff;\r\n  padding: 18px;\r\n}\r\n.rebort_table_title_top {\r\n  overflow-y: scroll;\r\n}\r\n\r\n.rebort_table_title_top::-webkit-scrollbar-thumb {\r\n  background: #fff;\r\n}\r\n.rebort_table_title_top::-webkit-scrollbar-track {\r\n  background: #fff;\r\n  border-right: 1px solid #ccc !important;\r\n}\r\n.lasttopli {\r\n  border-right: none !important;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/OC/user"}]}