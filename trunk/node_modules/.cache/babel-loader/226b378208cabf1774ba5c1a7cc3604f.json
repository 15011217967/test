{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\material_details.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\product\\custom_attrs\\material_details.vue","mtime":1572415124050},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport _toConsumableArray from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.to-string\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar mirroringMaterialCates = [];\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\nimport { validatePositiveNumber, numberPrice } from \"@/utils/validate\";\nexport default {\n  data: function data() {\n    return {\n      filtersData: {\n        type: 2,\n        //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\n        materialCateId: \"\",\n        name: \"\",\n        unitPrice: null,\n        image: \"\",\n        costPrice: null,\n        productionYear: \"\",\n        brandId: \"\",\n        valid: true,\n        description: \"\",\n        productionMaterialOptional: {\n          //面料可选\n          type: 2,\n          //选填 很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）；\n          costPrice: null,\n          ingredient: \"\",\n          yarnCount: \"\",\n          grams: \"\",\n          pattern: \"\"\n        },\n        productionMaterialCates: [] //商品分类数组\n\n      },\n      productImages: [],\n      //回显图片\n      showDisabled: false,\n      editDisabled: false,\n      _type: \"\",\n      _id: \"\",\n      rules: {\n        //规则验证\n        materialCateId: [{\n          required: true,\n          message: \"请选择属性分类\",\n          trigger: \"change\"\n        }],\n        productionMaterialCates: [{\n          required: true,\n          message: \"请选择商品分类\",\n          trigger: \"change\"\n        }],\n        brandId: [{\n          required: true,\n          message: \"请选择品牌\",\n          trigger: \"change\"\n        }],\n        name: [{\n          required: true,\n          message: \"输入原料名称\",\n          trigger: \"blur\"\n        }],\n        unitPrice: [{\n          required: true,\n          message: \"请输入销售价格\",\n          trigger: \"blur\"\n        }, {\n          validator: validatePositiveNumber,\n          trigger: \"blur\"\n        }],\n        productionYear: [{\n          required: true,\n          message: \"请选择年份\",\n          trigger: \"change\"\n        }]\n      },\n      brandOptions: [],\n      //品牌\n      cateNames: '',\n      //分类使用\n      cateIdArr: [],\n      classData: [],\n      // 商品分类树 数据\n      listData: [],\n      // 商品 分类 一维数据\n      attrClassData: [],\n      //原料分类树数据\n      attrListData: [],\n      //原料 一维数据\n      attrCateArr: [],\n      props: {\n        value: \"id\",\n        label: \"name\",\n        children: \"children\"\n      }\n    };\n  },\n  created: function created() {\n    this.getQueryparams();\n    this.getBrandOptions();\n  },\n  methods: {\n    setNumberPrice: function setNumberPrice(_t) {\n      numberPrice(_t);\n    },\n    //获取上页面参数\n    getQueryparams: function getQueryparams() {\n      this._type = this.$route.query._type;\n      this._id = this.$route.query._id;\n      var itemStatus = this._type;\n\n      switch (itemStatus.toString()) {\n        case \"add\":\n          //新增\n          this.editDisabled = false;\n          this.showDisabled = false;\n          this.getClassData();\n          break;\n\n        case \"edit\":\n          //修改\n          this.editDisabled = true;\n          this.showDisabled = false;\n          this.getEchoDisplayData();\n          break;\n\n        case \"show\":\n          //查看\n          this.editDisabled = true;\n          this.showDisabled = true;\n          this.getEchoDisplayData();\n          break;\n      }\n    },\n    getClassData: function getClassData(_disabledIds) {\n      var _this = this;\n\n      //获取商品分类  type 1\n      this.$common.getClassSelect(this, 1, _disabledIds).then(function (res) {\n        _this.classData = res.ztree;\n        _this.listData = res.list;\n      }); //获取属性分类  type 3\n\n      this.$common.getClassSelect(this, 3).then(function (res) {\n        _this.attrClassData = res.ztree;\n        _this.attrListData = res.list;\n      });\n    },\n    cateChangeGet: function cateChangeGet(e) {\n      var careIdArr = this.cateIdArr,\n          careIdLen = careIdArr.length;\n      var list = this.listData,\n          listLen = list.length;\n      var categories = [];\n\n      for (var i = 0; i < careIdLen; i++) {\n        for (var k = 0; k < listLen; k++) {\n          if (careIdArr[i] == list[k].id) {\n            categories.push({\n              cateId: list[k].id,\n              cateName: list[k].name,\n              cateIdentifier: list[k].identifier,\n              fullCateName: list[k].fullCateName\n            });\n          }\n        }\n      }\n\n      this.filtersData.productionMaterialCates = [].concat(categories, _toConsumableArray(mirroringMaterialCates));\n    },\n    attrCascaderGet: function attrCascaderGet(e) {\n      var cateId = JSON.parse(JSON.stringify(e)).pop();\n      var obj = this.attrListData.find(function (item) {\n        return item.id == cateId;\n      });\n      this.filtersData.materialCateId = obj.id;\n      this.filtersData.materialCateName = obj.name;\n      this.filtersData.materialCateIdentifier = obj.identifier;\n      this.filtersData.materialFullCateName = obj.fullCateName;\n    },\n    brandIdGet: function brandIdGet(val) {\n      var _obj = this.brandOptions.find(function (item) {\n        return item.id == val;\n      });\n\n      this.filtersData.brandName = _obj.name;\n    },\n    //品牌\n    getBrandOptions: function getBrandOptions() {\n      var _this2 = this;\n\n      this.request(this.api.product.productBrand_list, {\n        valid: true\n      }).then(function (data) {\n        //console.log(data.data);\n        var _data = data.data;\n        _this2.brandOptions = _data;\n      });\n    },\n    //提交\n    submitForm: function submitForm(formName) {\n      var _this3 = this;\n\n      console.log(this.filtersData);\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          _this3.request(_this3.api.product.productionMaterial_save, _this3.filtersData).then(function (res) {\n            _this3.$message.success(\"保存成功\");\n\n            setTimeout(function () {\n              _this3.routerback();\n            }, 500);\n          });\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    //回显\n    getEchoDisplayData: function getEchoDisplayData() {\n      var _this4 = this;\n\n      this.request(this.api.product.productionMaterial_get, {\n        id: this._id\n      }).then(function (res) {\n        console.log(res);\n\n        if (res.productionMaterialOptional == null) {\n          res.productionMaterialOptional = {};\n        }\n\n        _this4.filtersData = res;\n\n        if (!!res.image) {\n          _this4.productImages = [{\n            url: res.image\n          }];\n        }\n\n        _this4.attrCateArr = [res.materialCateId]; //回显 商品分类已选置灰\n\n        var arr = [],\n            cateIds = [];\n        var Categories = res.productionMaterialCates;\n        mirroringMaterialCates = _toConsumableArray(Categories);\n\n        if (Categories.length > 0) {\n          for (var i = 0; i < Categories.length; i++) {\n            arr.push(Categories[i].fullCateName); //此处的字段是错误的\n\n            cateIds.push(Categories[i].cateId);\n          }\n\n          _this4.cateNames = arr.join(\"、\");\n        }\n\n        _this4.getClassData(cateIds);\n      });\n    },\n    //后退\n    routerback: function routerback() {\n      this.$router.go(-1);\n    }\n  },\n  computed: {\n    //季节\n    seasonOptions: function seasonOptions() {\n      var codeSet = this.$store.getters.codeData;\n\n      if (codeSet.PRO005) {\n        return codeSet.PRO005.codeItemList;\n      }\n    }\n  },\n  components: {\n    ElUploadImg: ElUploadImg\n  }\n};",{"version":3,"sources":["material_details.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <el-form :rules=\"rules\" label-width=\"110px\" :model=\"filtersData\" size=\"small\" ref=\"filtersForm\">\r\n      <div class=\"tlogy-item\">\r\n        <h5 class=\"tlogy-title\">基本信息</h5>\r\n        <el-form-item prop=\"materialCateId\" label=\"属性分类：\">\r\n          <el-cascader\r\n          v-if=\"_type == 'add'\"\r\n            class=\"input-w-2\"\r\n            :disabled=\"editDisabled\"\r\n            :options=\"attrClassData\"\r\n            v-model=\"attrCateArr\"\r\n            :value=\"attrCateArr\"\r\n            @change=\"attrCascaderGet\"\r\n            :show-all-levels=\"false\"\r\n            :props=\"props\"\r\n          ></el-cascader>\r\n        <el-select v-else placeholder=\"请选择\" class=\"input-w-2\" :disabled=\"editDisabled\"\r\n            :value=\"filtersData.materialCateId\"\r\n            v-model=\"filtersData.materialCateId\">\r\n            <el-option\r\n            v-for=\"item in attrListData\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n            ></el-option>\r\n        </el-select>\r\n        </el-form-item>\r\n         <el-form-item v-if=\"_type != 'add'\" label=\"已选分类：\">\r\n        <div>{{cateNames}}</div>\r\n      </el-form-item>\r\n        <el-form-item :prop=\"_type == 'add'?'productionMaterialCates':''\" label=\"商品分类：\">\r\n          <div class=\"input-w-2\">\r\n          <el-cascader-multi\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"cateIdArr\"\r\n            @change=\"cateChangeGet\"\r\n            :data=\"classData\"\r\n            :only-last=\"true\"\r\n            :clearable=\"true\"\r\n            :is-two-dimension-value=\"false\"\r\n            separator=\"/\"\r\n            value-key=\"id\"\r\n            label-key=\"name\"\r\n            children-key=\"children\"\r\n          ></el-cascader-multi>\r\n          </div>\r\n        </el-form-item>\r\n        <el-form-item prop=\"name\" label=\"原料名称：\">\r\n          <el-input v-model=\"filtersData.name\" class=\"input-w-2\"   :disabled=\"showDisabled\" placeholder=\"请输入内容\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"unitPrice\" label=\"销售价格：\">\r\n          <el-input @input.native=\"setNumberPrice($event)\"  v-model=\"filtersData.unitPrice\" class=\"input-w-2\"  :disabled=\"showDisabled\" placeholder=\"请输入内容\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"成本：\">\r\n          <el-input @input.native=\"setNumberPrice($event)\" v-model=\"filtersData.costPrice\" class=\"input-w-2\"   :disabled=\"showDisabled\" placeholder=\"请输入内容\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"brandId\" label=\"品牌：\">\r\n          <el-select\r\n            :disabled=\"editDisabled\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请选择\"\r\n            @change=\"brandIdGet\"\r\n            v-model=\"filtersData.brandId\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in brandOptions\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.id\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item\r\n          prop=\"productionYear\"\r\n          :rules=\"{required: true, message: '请选择年份', trigger: 'change'}\"\r\n          label=\"年份：\"\r\n        >\r\n          <el-date-picker\r\n            :disabled=\"editDisabled\"\r\n            class=\"popularYear-w\"\r\n            v-model=\"filtersData.productionYear\"\r\n            type=\"year\"\r\n            value-format=\"yyyy\"\r\n            placeholder=\"选择年\"\r\n          ></el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item prop=\"image\" label=\"原料图片：\">\r\n          <el-upload-img\r\n           :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.image\"\r\n            :EchoDisplayImages=\"productImages\"\r\n            CatalogName=\"product\"\r\n          ></el-upload-img>\r\n        </el-form-item>\r\n        <el-form-item prop=\"valid\" label=\"使用状态：\">\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"true\">使用中</el-radio>\r\n          <el-radio v-model=\"filtersData.valid\" :disabled=\"showDisabled\" :label=\"false\">未使用</el-radio>\r\n        </el-form-item>\r\n        <el-form-item prop=\"description\" label=\"备注：\">\r\n          <el-input\r\n            type=\"textarea\"\r\n            class=\"input-w-2\"\r\n            autosize\r\n            :disabled=\"showDisabled\"\r\n            placeholder=\"请输入内容\"\r\n            v-model=\"filtersData.description\"\r\n          ></el-input>\r\n        </el-form-item>\r\n      </div>\r\n      <div class=\"tlogy-footer\">\r\n        <h5 class=\"tlogy-title\">面料选填</h5>\r\n        <el-form-item label=\"零剪成本：\">\r\n          <el-input\r\n           @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.productionMaterialOptional.costPrice\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"成分：\">\r\n          <el-input\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.productionMaterialOptional.ingredient\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"纱支：\">\r\n          <el-input\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.productionMaterialOptional.yarnCount\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"克重：\">\r\n          <el-input\r\n            @input.native=\"setNumberPrice($event)\"\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.productionMaterialOptional.grams\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"花型：\">\r\n          <el-input\r\n            :disabled=\"showDisabled\"\r\n            v-model=\"filtersData.productionMaterialOptional.pattern\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请输入内容\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"季节：\">\r\n          <el-select\r\n            :disabled=\"showDisabled\"\r\n            class=\"input-w-2\"\r\n            placeholder=\"请选择\"\r\n            v-model=\"filtersData.productionMaterialOptional.season\"\r\n          >\r\n            <el-option\r\n              v-for=\"(item,index) in seasonOptions\"\r\n              :key=\"index.code\"\r\n              :label=\"item.name\"\r\n              :value=\"item.name\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <div class=\"item-footer\">\r\n          <el-button\r\n            v-if=\"_type == 'add'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >确定</el-button>\r\n          <el-button\r\n            v-else-if=\"_type == 'edit'\"\r\n            size=\"small\"\r\n            @click=\"submitForm('filtersForm')\"\r\n            type=\"primary\"\r\n          >修改</el-button>\r\n          <el-button size=\"small\" @click=\"routerback('filtersForm')\">取消</el-button>\r\n        </div>\r\n      </div>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n<script>\r\nlet mirroringMaterialCates=[];\r\nimport ElUploadImg from \"@/components/uploadImg/el_upload_img\";\r\nimport { validatePositiveNumber,numberPrice} from \"@/utils/validate\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      filtersData: {\r\n        type: 2, //很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）\r\n        materialCateId: \"\",\r\n        name: \"\",\r\n        unitPrice:null,\r\n        image: \"\",\r\n        costPrice: null,\r\n        productionYear: \"\",\r\n        brandId: \"\",\r\n        valid: true,\r\n        description: \"\",\r\n        productionMaterialOptional: { //面料可选\r\n          type: 2, //选填 很重要 区分原料和工艺的 原料类型（1：工艺，2：原料）；\r\n          costPrice: null,\r\n          ingredient: \"\",\r\n          yarnCount: \"\",\r\n          grams: \"\",\r\n          pattern: \"\"\r\n        },\r\n        productionMaterialCates:[] //商品分类数组\r\n      },\r\n\r\n      productImages: [], //回显图片\r\n      showDisabled: false,\r\n      editDisabled: false,\r\n      _type: \"\",\r\n      _id: \"\",\r\n      rules: {\r\n        //规则验证\r\n        materialCateId: [\r\n          { required: true, message: \"请选择属性分类\", trigger: \"change\" }\r\n        ],\r\n        productionMaterialCates: [\r\n          { required: true, message: \"请选择商品分类\", trigger: \"change\" }\r\n        ],\r\n        brandId: [{ required: true, message: \"请选择品牌\", trigger: \"change\" }],\r\n        name: [{ required: true, message: \"输入原料名称\", trigger: \"blur\" }],\r\n        unitPrice: [\r\n          { required: true, message: \"请输入销售价格\", trigger: \"blur\" },\r\n           {validator:validatePositiveNumber,trigger: \"blur\"}\r\n        ],\r\n        productionYear: [\r\n          { required: true, message: \"请选择年份\", trigger: \"change\" }\r\n        ]\r\n      },\r\n      brandOptions: [], //品牌\r\n      cateNames:'',\r\n      //分类使用\r\n      cateIdArr:[],\r\n      classData: [], // 商品分类树 数据\r\n      listData: [], // 商品 分类 一维数据\r\n      attrClassData: [], //原料分类树数据\r\n      attrListData: [], //原料 一维数据\r\n      attrCateArr: [],\r\n      props: {\r\n        value: \"id\",\r\n        label: \"name\",\r\n        children: \"children\"\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    this.getQueryparams();\r\n    this.getBrandOptions();\r\n  },\r\n  methods: {\r\n   setNumberPrice(_t){\r\n    numberPrice(_t)\r\n   },\r\n    //获取上页面参数\r\n    getQueryparams() {\r\n      this._type = this.$route.query._type;\r\n      this._id = this.$route.query._id;\r\n      let itemStatus = this._type;\r\n      switch (itemStatus.toString()) {\r\n        case \"add\": //新增\r\n          this.editDisabled = false;\r\n          this.showDisabled = false;\r\n           this.getClassData();\r\n          break;\r\n        case \"edit\": //修改\r\n          this.editDisabled = true;\r\n          this.showDisabled = false;\r\n          this.getEchoDisplayData();\r\n          break;\r\n        case \"show\": //查看\r\n          this.editDisabled = true;\r\n          this.showDisabled = true;\r\n          this.getEchoDisplayData();\r\n          break;\r\n      }\r\n    },\r\n    getClassData(_disabledIds) {\r\n      //获取商品分类  type 1\r\n      this.$common.getClassSelect(this, 1,_disabledIds).then(res => {\r\n        this.classData = res.ztree;\r\n        this.listData = res.list;\r\n      });\r\n      //获取属性分类  type 3\r\n      this.$common.getClassSelect(this, 3).then(res => {\r\n        this.attrClassData = res.ztree;\r\n        this.attrListData = res.list;\r\n      });\r\n    },\r\n    cateChangeGet(e) {\r\n      let careIdArr = this.cateIdArr,\r\n          careIdLen = careIdArr.length;\r\n        let list = this.listData,\r\n          listLen = list.length;\r\n        let categories = [];\r\n        for (let i = 0; i < careIdLen; i++) {\r\n          for (let k = 0; k < listLen; k++) {\r\n            if (careIdArr[i] == list[k].id) {\r\n              categories.push({\r\n                cateId: list[k].id,\r\n                cateName: list[k].name,\r\n                cateIdentifier: list[k].identifier,\r\n                fullCateName:list[k].fullCateName\r\n              });\r\n            }\r\n          }\r\n        }\r\n        this.filtersData.productionMaterialCates = [...categories,...mirroringMaterialCates];\r\n    },\r\n    attrCascaderGet(e) {\r\n      let cateId = JSON.parse(JSON.stringify(e)).pop();\r\n      let obj = this.attrListData.find(item => item.id == cateId);\r\n      this.filtersData.materialCateId = obj.id;\r\n      this.filtersData.materialCateName = obj.name;\r\n      this.filtersData.materialCateIdentifier = obj.identifier;\r\n      this.filtersData.materialFullCateName = obj.fullCateName;\r\n    },\r\n    brandIdGet(val) {\r\n      let _obj = this.brandOptions.find(item => item.id == val);\r\n      this.filtersData.brandName = _obj.name;\r\n    },\r\n    //品牌\r\n    getBrandOptions() {\r\n      this.request(this.api.product.productBrand_list, {valid:true}).then(data => {\r\n        //console.log(data.data);\r\n        let _data = data.data;\r\n        this.brandOptions = _data;\r\n      });\r\n    },\r\n    //提交\r\n    submitForm(formName) {\r\n      console.log(this.filtersData);\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          this.request(\r\n            this.api.product.productionMaterial_save,\r\n            this.filtersData\r\n          ).then(res => {\r\n            this.$message.success(\"保存成功\");\r\n            setTimeout(() => {\r\n              this.routerback();\r\n            }, 500);\r\n          });\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //回显\r\n    getEchoDisplayData() {\r\n      this.request(this.api.product.productionMaterial_get, {\r\n        id: this._id\r\n      }).then(res => {\r\n        console.log(res);\r\n        if(res.productionMaterialOptional == null){\r\n          res.productionMaterialOptional={}\r\n        }\r\n         this.filtersData = res;\r\n        if(!!res.image){\r\n          this.productImages = [{ url: res.image }];\r\n        }\r\n        this.attrCateArr = [res.materialCateId];\r\n        //回显 商品分类已选置灰\r\n         let arr = [],\r\n            cateIds = [];\r\n          let Categories = res.productionMaterialCates;\r\n          mirroringMaterialCates=[...Categories];\r\n          if(Categories.length > 0){\r\n            for (let i = 0; i < Categories.length; i++) {\r\n              arr.push(Categories[i].fullCateName); //此处的字段是错误的\r\n              cateIds.push(Categories[i].cateId);\r\n            }\r\n            this.cateNames = arr.join(\"、\");\r\n          }\r\n          this.getClassData(cateIds);\r\n      });\r\n    },\r\n    //后退\r\n    routerback() {\r\n      this.$router.go(-1);\r\n    }\r\n  },\r\n  computed: {\r\n    //季节\r\n    seasonOptions() {\r\n      let codeSet = this.$store.getters.codeData;\r\n      if (codeSet.PRO005) {\r\n        return codeSet.PRO005.codeItemList;\r\n      }\r\n    }\r\n  },\r\n  components: {\r\n    ElUploadImg\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.tlogy-item {\r\n  background-color: #ffffff;\r\n  margin: 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-footer {\r\n  background-color: #ffffff;\r\n  margin: 0 10px 10px;\r\n  padding: 10px;\r\n}\r\n.tlogy-title {\r\n  font-size: 22px ;\r\n  height: 50px;\r\n  line-height: 50px;\r\n  text-indent: 40px;\r\n  border-bottom: 1px solid #eeeeee;\r\n  margin-bottom: 20px;\r\n  em {\r\n    margin-left: 20px;\r\n    font-size: 14px;\r\n    color: #ff6677;\r\n  }\r\n}\r\n\r\n.popularYear-w {\r\n  width: 280px !important;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/product/custom_attrs"}]}