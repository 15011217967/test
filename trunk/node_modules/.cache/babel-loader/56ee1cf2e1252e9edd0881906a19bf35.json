{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\scb\\components\\sellTransferSlipGoodsTable.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\scb\\components\\sellTransferSlipGoodsTable.vue","mtime":1585054517007},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ImagePopover from \"@/views/collocation/components/ImagePopover\";\nimport { numberPrice } from \"@/utils/validate\";\nexport default {\n  name: '',\n  props: {\n    // 提交门店信息\n    transferSlipAddInfo: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    },\n    // 是否显示\n    checkedGoodsShow: {\n      type: Boolean,\n      default: false\n    },\n    // 表格数据\n    tableData: {\n      type: Array\n    }\n  },\n  // 数据\n  data: function data() {\n    return {\n      id: this.$route.query.id,\n      value: '',\n      // 分页显示的数据\n      showTableData: [],\n      formData: {\n        pageIndex: 1,\n        pageSize: 10\n      },\n      // 选择的商品总信息\n      checkedAllSKUInfo: {\n        retailPriceTotal: 0,\n        typeTotal: 0,\n        goodsTotal: 0,\n        actualPriceTotal: 0,\n        discount: ''\n      }\n    };\n  },\n  // 组件\n  components: {\n    ImagePopover: ImagePopover\n  },\n  // 初始化数据\n  mounted: function mounted() {\n    var _this = this;\n\n    this.$nextTick(function () {\n      _this.init();\n    });\n  },\n  // 方法\n  methods: {\n    init: function init() {\n      var _this2 = this;\n\n      this.formData.pageIndex = 1; // 获取显示的数据\n\n      this.getShowTableData(); // 计算选中的商品总信息\n\n      this.getCheckedAllSKUInfo();\n      this.tableData.forEach(function (item, index) {\n        item.availableQuantity = item.availableQuantity != null ? item.availableQuantity : item.skuStockQuantity;\n\n        _this2.$set(item, 'modifyPriceCopy', item.modifyPrice);\n\n        _this2.$set(item, 'modifyPriceType', 0);\n      });\n    },\n    // 获取显示数据\n    getShowTableData: function getShowTableData() {\n      if (this.tableData.length <= 10) {\n        this.showTableData = this.tableData;\n      }\n\n      if (this.tableData.length > 10) {\n        this.showTableData = this.tableData.slice((this.formData.pageIndex - 1) * this.formData.pageSize, this.formData.pageIndex * this.formData.pageSize);\n      }\n    },\n    // 数量输入改变\n\n    /**\n     *\n     * @param $event dom节点\n     * @param scope el-table 行数据的所有信息\n     */\n    handleInput: function handleInput($event, scope) {\n      var _this3 = this;\n\n      this.$nextTick(function () {\n        var val = $event.target.value;\n        scope.row.quantity = $event.target.value = val.replace(/[^\\d.]/g, '');\n\n        _this3.handleChange(scope);\n      });\n    },\n\n    /**\n     * 数量点击改变\n     * @param scope el-table 行数据的所有信息\n     */\n    handleChange: function handleChange(scope) {\n      var _this4 = this;\n\n      if (scope.row.quantity == 0) {\n        this.$confirm('返货量为0时，将删除该商品', '提示', {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          showClose: false\n        }).then(function () {\n          _this4.tableData.splice(scope.$index + (_this4.formData.pageIndex - 1) * _this4.formData.pageSize, 1);\n\n          if (_this4.showTableData.length === 1 && _this4.formData.pageIndex > 1) {\n            _this4.formData.pageIndex = _this4.formData.pageIndex - 1;\n          }\n\n          _this4.getShowTableData();\n\n          _this4.$nextTick(function () {\n            // 计算选中的商品总信息\n            _this4.getCheckedAllSKUInfo();\n          });\n        }).catch(function () {\n          scope.row.quantity = 1;\n        });\n      } else {\n        this.$nextTick(function () {\n          // 计算选中的商品总信息\n          _this4.getCheckedAllSKUInfo();\n        });\n      }\n    },\n\n    /**\n     * 单价改变\n     * @param $event dom节点\n     * @param row 修改单价的行数据\n     */\n    purchasePriceChange: function purchasePriceChange($event, row) {\n      var _this5 = this;\n\n      var val = $event.target.value;\n\n      if (!val) {\n        row.allotPrice = 0;\n        return;\n      }\n\n      numberPrice($event);\n      row.allotPrice = $event.target.value;\n      this.$nextTick(function () {\n        // 计算选中的商品总信息\n        _this5.getCheckedAllSKUInfo();\n      });\n    },\n    // 计算选中的商品总信息\n    getCheckedAllSKUInfo: function getCheckedAllSKUInfo() {\n      var _this6 = this;\n\n      this.checkedAllSKUInfo = {\n        retailPriceTotal: 0,\n        typeTotal: 0,\n        goodsTotal: 0,\n        actualPriceTotal: 0,\n        discount: this.checkedAllSKUInfo.discount,\n        skuNum: null,\n        purchasePriceTotal: null\n      }; // 获取所有的 商品货号 + 颜色  集合\n\n      var typeTotalObj = {};\n\n      if (this.tableData.length) {\n        this.tableData.forEach(function (item) {\n          _this6.checkedAllSKUInfo.skuNum += 1;\n          _this6.checkedAllSKUInfo.purchasePriceTotal += Number(item.modifyPrice) * Number(item.quantity);\n          _this6.checkedAllSKUInfo.retailPriceTotal += Number(item.retailPrice) * Number(item.quantity);\n          _this6.checkedAllSKUInfo.goodsTotal += Number(item.quantity);\n          _this6.checkedAllSKUInfo.actualPriceTotal += Number(item.allotPrice) * Number(item.quantity);\n          var goodsCodeColor = item.goodsCode + item.color;\n\n          if (!typeTotalObj[goodsCodeColor]) {\n            typeTotalObj[goodsCodeColor] = 1;\n          }\n        });\n        this.checkedAllSKUInfo.purchasePriceTotal = this.checkedAllSKUInfo.purchasePriceTotal.toFixed(2);\n        this.checkedAllSKUInfo.retailPriceTotal = this.checkedAllSKUInfo.retailPriceTotal.toFixed(2);\n        this.checkedAllSKUInfo.actualPriceTotal = this.checkedAllSKUInfo.actualPriceTotal.toFixed(2);\n        this.checkedAllSKUInfo.typeTotal = Object.keys(typeTotalObj).length;\n      }\n    },\n\n    /**\n     * 输入全部商品的折扣过滤\n     * @param $event dom节点\n     */\n    goodsAllDiscount: function goodsAllDiscount($event) {\n      var value = $event.target.value;\n      this.checkedAllSKUInfo.discount = $event.target.value = value.match(/\\d(\\.\\d?)?/g) && value.match(/\\d(\\.\\d?)?/g)[0] || null;\n    },\n    // 折扣回车\n    goodsAllDiscountEnter: function goodsAllDiscountEnter() {\n      var _this7 = this;\n\n      if (!this.checkedAllSKUInfo.discount) return;\n      this.checkedAllSKUInfo.discount = this.checkedAllSKUInfo.discount.replace(/\\.$/, '');\n\n      if (this.tableData.length) {\n        this.tableData.forEach(function (item) {\n          item.allotPrice = (item.retailPrice * Number(_this7.checkedAllSKUInfo.discount) / 10).toFixed(2);\n        }); // 计算选中的商品总信息\n\n        this.getCheckedAllSKUInfo();\n      }\n    },\n    // 继续选货\n    continueCheckGoods: function continueCheckGoods() {\n      this.$emit('update:checkedGoodsShow', false);\n    },\n    // 取消\n    href: function href() {\n      this.$router.push({\n        path: '/scb/order/sell_order'\n      });\n    },\n\n    /**\n     * 最终提交\n     */\n    saveDraft: function saveDraft(type) {\n      var _this8 = this;\n\n      if (!this.tableData.length) {\n        return;\n      }\n\n      var Info = this.transferSlipAddInfo;\n      var data = {\n        \"purchaseAgentId\": Info.inStoreId,\n        \"purchaseAgentName\": Info.inStoreName,\n        \"orderId\": this.$route.query.id,\n        \"orderNum\": this.$route.query.orderNum,\n        \"purchaseOrderStatus\": Info.purchaseOrderStatus,\n        divisionId: Info.divisionId,\n        \"receiveMan\": Info.receiveMan,\n        \"phone\": Info.phone,\n        \"provinceCode\": Info.provinceCode,\n        \"provinceName\": Info.provinceName,\n        \"cityCode\": Info.cityCode,\n        \"cityName\": Info.cityName,\n        \"areaCode\": Info.areaCode,\n        \"areaName\": Info.areaName,\n        \"addressInfo\": Info.addressInfo,\n        \"carriage\": \"到付\",\n        purchaseOrderProductVOS: []\n      };\n      this.tableData.forEach(function (item) {\n        var obj = {\n          id: item.id,\n          \"brandId\": item.productBrandId || item.brandId,\n          \"brandName\": item.productBrandName || item.brandName,\n          \"color\": item.color,\n          \"colorSeries\": item.colorSeries,\n          \"goodsCode\": item.code || item.goodsCode,\n          \"goodsName\": item.name || item.goodsName,\n          \"image\": item.image,\n          \"price\": item.retailPrice || item.price,\n          \"productCode\": item.productCode,\n          // \"productName\": item.productName,\n          purchasePrice: item.purchasePrice,\n          \"modifyPrice\": item.modifyPrice,\n          \"size\": item.size,\n          \"skuModifyQuantity\": item.quantity || item.skuQuantity,\n          skuQuantity: item.quantity || item.skuQuantity,\n          \"skuRefundQuantity\": 0\n        };\n\n        if (item.modifyPriceCopy !== item.modifyPrice) {\n          obj.modifyPriceType = 1;\n        } else {\n          obj.modifyPriceType = 0;\n        }\n\n        ; // if(type == 0 && !this.$route.query.orderNum) {\n        //   obj.purchasePrice = item.purchasePrice;\n        // }\n        // if(type == 1) {\n        //   obj.purchasePrice = item.purchasePrice;\n        // }\n\n        data.purchaseOrderProductVOS.push(obj);\n      });\n      var url = null;\n\n      switch (type) {\n        case 0:\n          url = this.api.scb.purchaseOrder_saveDraft;\n          break;\n\n        case 1:\n          url = this.$route.query.orderNum ? this.api.scb.purchaseOrder_modification : this.api.scb.purchaseOrder_allocateCargo;\n          break;\n      }\n\n      ;\n      this.request(url, data).then(function (data) {\n        sessionStorage.removeItem(\"TRANSFER_SLIP_APP_INFO\");\n\n        if (data && data.length) {\n          var html = '';\n          data.forEach(function (errItem) {\n            for (var i = _this8.tableData.length - 1; i >= 0; i--) {\n              if (_this8.tableData[i].code == errItem.code) {\n                if (errItem.stockQty == 0) {\n                  _this8.tableData.splice(i, 1);\n\n                  html += '<p>' + errItem.code + '：可用库存为0，已删除该商品；</p>';\n                } else {\n                  html += '<p>' + errItem.code + '：可用库存不足，已更新为最大值' + errItem.stockQty + '；</p>';\n                  _this8.tableData[i].stockQty = errItem.stockQty;\n                  _this8.tableData[i].quantity = errItem.stockQty;\n                }\n\n                break;\n              }\n            }\n          });\n\n          _this8.$notify({\n            title: '提示',\n            duration: 0,\n            dangerouslyUseHTMLString: true,\n            message: html\n          });\n\n          _this8.$nextTick(function () {\n            _this8.init();\n          });\n        } else {\n          _this8.$notify.success({\n            title: '成功',\n            message: type == 1 ? '新增成功！' : '修改成功！'\n          });\n\n          _this8.$router.push({\n            path: '/scb/order/sell_order'\n          });\n        }\n      });\n    },\n\n    /**\n     * 表格更改条数\n     * @param val 每页的条数\n     */\n    handleSizeChange: function handleSizeChange(val) {\n      this.formData.pageSize = val;\n      this.formData.pageIndex = 1;\n      this.getShowTableData();\n    },\n\n    /**\n     * 表格更改页数\n     * @param val 页码\n     */\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.formData.pageIndex = val;\n      this.getShowTableData();\n    }\n  },\n  // 计算属性\n  computed: {},\n  // 监听数据变化\n  watch: {}\n};",{"version":3,"sources":["sellTransferSlipGoodsTable.vue"],"names":[],"mappings":"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","sourcesContent":["<style lang=\"less\" scoped>\r\n  .goods-table{\r\n    .pagination{margin-top: 20px;}\r\n    .item-cont{\r\n      .btns{float: right;}\r\n    }\r\n    .text-info{\r\n      li{line-height: 32px;margin-bottom: 18px;\r\n        .discount-remarks{padding-left: 72px;margin-bottom: 30px;}\r\n      }\r\n    }\r\n  }\r\n  .goods-table .txt-red /deep/ .el-input__inner{color: red;}\r\n</style>\r\n<template>\r\n  <div class=\"goods-table\">\r\n    <el-table :data=\"showTableData\" style=\"width: 100%\">\r\n      <el-table-column prop=\"productCode\" label=\"商品款号\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"code\" label=\"商品货号\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"goodsName\" label=\"名称\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column label=\"商品图片\">\r\n        <template slot-scope=\"scope\">\r\n          <image-popover :img-src=\"scope.row.image\"></image-popover>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"color\" label=\"颜色\" max-width=\"70\"></el-table-column>\r\n      <el-table-column prop=\"size\" label=\"尺码\" max-width=\"70\"></el-table-column>\r\n      <el-table-column prop=\"brandName\" label=\"品牌\" :show-overflow-tooltip=\"true\"></el-table-column>\r\n      <el-table-column prop=\"retailPrice\" label=\"吊牌价\"></el-table-column>\r\n      <el-table-column prop=\"modifyPrice\" label=\"结算价\" width=\"150\">\r\n        <template slot-scope=\"scope\">\r\n          <el-input width=\"50\" @input.native=\"purchasePriceChange($event, scope.row)\" v-model=\"scope.row.modifyPrice\"  @change=\"handleChange(scope)\" :min=\"0\" label=\"选择的数量\" size=\"mini\"></el-input>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column prop=\"availableQuantity\" label=\"库存量\"></el-table-column>\r\n      <el-table-column label=\"数量\" width=\"150\">\r\n        <template slot-scope=\"scope\">\r\n          <el-input-number v-model=\"scope.row.quantity\"  @input.native=\"handleInput($event, scope)\" @change=\"handleChange(scope)\" :min=\"0\" label=\"选择的数量\" size=\"mini\" :class=\"{'txt-red' : scope.row.availableQuantity < scope.row.quantity}\"></el-input-number>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <div class=\"pagination\" v-if=\"tableData.length > 0\">\r\n      <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :page-sizes=\"[10, 20, 30, 40]\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"tableData.length\" :page-size=\"formData.pageSize\" :current-page=\"formData.pageIndex\">\r\n      </el-pagination>\r\n    </div>\r\n    <div class=\"item-cont clearfix\">\r\n      <ul class=\"text-info\">\r\n        <li>吊牌总价：{{ checkedAllSKUInfo.retailPriceTotal }}</li>\r\n        <li>sku种类数：{{ checkedAllSKUInfo.skuNum }}</li>\r\n        <li>商品总数：{{ checkedAllSKUInfo.goodsTotal }}</li>\r\n        <li>结算价总额：{{ checkedAllSKUInfo.purchasePriceTotal }}</li>\r\n      </ul>\r\n      <div class=\"btns\">\r\n        <el-button type=\"primary\" @click=\"href\" size=\"small\" plain>取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveDraft(0)\" size=\"small\" plain>存为草稿</el-button>\r\n        <el-button type=\"primary\" @click=\"continueCheckGoods\" size=\"small\" plain>继续选货</el-button>\r\n        <el-button type=\"primary\" @click=\"saveDraft(1)\" size=\"small\">确认配货</el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  import ImagePopover from \"@/views/collocation/components/ImagePopover\";\r\n  import { numberPrice } from \"@/utils/validate\";\r\n  export default {\r\n    name: '',\r\n    props: {\r\n      // 提交门店信息\r\n      transferSlipAddInfo: {\r\n        type: Object,\r\n        default(){\r\n          return {}\r\n        }\r\n      },\r\n      // 是否显示\r\n      checkedGoodsShow: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      // 表格数据\r\n      tableData: {\r\n        type: Array\r\n      }\r\n    },\r\n    // 数据\r\n    data() {\r\n      return {\r\n        id:this.$route.query.id,\r\n        value: '',\r\n        // 分页显示的数据\r\n        showTableData: [],\r\n        formData: {\r\n          pageIndex: 1,\r\n          pageSize: 10\r\n        },\r\n        // 选择的商品总信息\r\n        checkedAllSKUInfo: {\r\n          retailPriceTotal: 0,\r\n          typeTotal: 0,\r\n          goodsTotal: 0,\r\n          actualPriceTotal: 0,\r\n          discount: ''\r\n        },\r\n      }\r\n    },\r\n    // 组件\r\n    components: {\r\n      ImagePopover\r\n    },\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        this.init();\r\n      })\r\n    },\r\n    // 方法\r\n    methods: {\r\n      init(){\r\n        this.formData.pageIndex = 1;\r\n        // 获取显示的数据\r\n        this.getShowTableData();\r\n        // 计算选中的商品总信息\r\n        this.getCheckedAllSKUInfo();\r\n        this.tableData.forEach((item, index) => {\r\n          item.availableQuantity = item.availableQuantity != null ? item.availableQuantity : item.skuStockQuantity;\r\n          this.$set(item, 'modifyPriceCopy', item.modifyPrice);\r\n          this.$set(item, 'modifyPriceType', 0);\r\n        });\r\n      },\r\n      // 获取显示数据\r\n      getShowTableData(){\r\n        if(this.tableData.length <= 10){\r\n          this.showTableData = this.tableData;\r\n        }\r\n        if(this.tableData.length > 10){\r\n          this.showTableData = this.tableData.slice((this.formData.pageIndex - 1) * this.formData.pageSize, this.formData.pageIndex * this.formData.pageSize )\r\n        }\r\n      },\r\n      // 数量输入改变\r\n      /**\r\n       *\r\n       * @param $event dom节点\r\n       * @param scope el-table 行数据的所有信息\r\n       */\r\n      handleInput($event, scope){\r\n        this.$nextTick(()=>{\r\n          let val = $event.target.value;\r\n          scope.row.quantity = $event.target.value = val.replace(/[^\\d.]/g,'');\r\n          this.handleChange(scope)\r\n        })\r\n      },\r\n      /**\r\n       * 数量点击改变\r\n       * @param scope el-table 行数据的所有信息\r\n       */\r\n      handleChange(scope){\r\n        if(scope.row.quantity == 0){\r\n          this.$confirm('返货量为0时，将删除该商品', '提示', {\r\n            confirmButtonText: '确认',\r\n            cancelButtonText: '取消',\r\n            showClose:false\r\n          }).then(() => {\r\n            this.tableData.splice(scope.$index + (this.formData.pageIndex - 1) * this.formData.pageSize, 1);\r\n            if(this.showTableData.length === 1 && this.formData.pageIndex > 1){\r\n              this.formData.pageIndex = this.formData.pageIndex -1;\r\n            }\r\n            this.getShowTableData();\r\n            this.$nextTick(()=>{\r\n              // 计算选中的商品总信息\r\n              this.getCheckedAllSKUInfo();\r\n            })\r\n          }).catch(() => {\r\n            scope.row.quantity = 1;\r\n          });\r\n        }else {\r\n          this.$nextTick(()=>{\r\n            // 计算选中的商品总信息\r\n            this.getCheckedAllSKUInfo();\r\n          });\r\n        }\r\n      },\r\n      /**\r\n       * 单价改变\r\n       * @param $event dom节点\r\n       * @param row 修改单价的行数据\r\n       */\r\n      purchasePriceChange($event, row){\r\n        let val = $event.target.value;\r\n        if(!val) {\r\n          row.allotPrice = 0;\r\n          return\r\n        }\r\n        numberPrice($event);\r\n        row.allotPrice = $event.target.value;\r\n        this.$nextTick(()=>{\r\n          // 计算选中的商品总信息\r\n          this.getCheckedAllSKUInfo();\r\n        })\r\n      },\r\n      // 计算选中的商品总信息\r\n      getCheckedAllSKUInfo(){\r\n        this.checkedAllSKUInfo = {\r\n          retailPriceTotal: 0,\r\n          typeTotal: 0,\r\n          goodsTotal: 0,\r\n          actualPriceTotal: 0,\r\n          discount: this.checkedAllSKUInfo.discount,\r\n          skuNum:null,\r\n          purchasePriceTotal:null\r\n        };\r\n        // 获取所有的 商品货号 + 颜色  集合\r\n        let typeTotalObj = {};\r\n        if(this.tableData.length){\r\n          this.tableData.forEach(item => {  \r\n            this.checkedAllSKUInfo.skuNum += 1;\r\n            this.checkedAllSKUInfo.purchasePriceTotal += Number(item.modifyPrice) * Number(item.quantity);\r\n            this.checkedAllSKUInfo.retailPriceTotal += Number(item.retailPrice) * Number(item.quantity);\r\n            this.checkedAllSKUInfo.goodsTotal += Number(item.quantity);\r\n            this.checkedAllSKUInfo.actualPriceTotal += Number(item.allotPrice) * Number(item.quantity);\r\n            let goodsCodeColor = item.goodsCode + item.color;\r\n            if(!typeTotalObj[goodsCodeColor]){\r\n              typeTotalObj[goodsCodeColor] = 1\r\n            }\r\n          });\r\n          this.checkedAllSKUInfo.purchasePriceTotal = this.checkedAllSKUInfo.purchasePriceTotal.toFixed(2);\r\n          this.checkedAllSKUInfo.retailPriceTotal = this.checkedAllSKUInfo.retailPriceTotal.toFixed(2);\r\n          this.checkedAllSKUInfo.actualPriceTotal = this.checkedAllSKUInfo.actualPriceTotal.toFixed(2);\r\n          this.checkedAllSKUInfo.typeTotal = Object.keys(typeTotalObj).length;\r\n        }\r\n      },\r\n      /**\r\n       * 输入全部商品的折扣过滤\r\n       * @param $event dom节点\r\n       */\r\n      goodsAllDiscount($event){\r\n        let value = $event.target.value;\r\n        this.checkedAllSKUInfo.discount = $event.target.value = value.match(/\\d(\\.\\d?)?/g) && value.match(/\\d(\\.\\d?)?/g)[0] || null;\r\n      },\r\n      // 折扣回车\r\n      goodsAllDiscountEnter(){\r\n        if(!this.checkedAllSKUInfo.discount) return;\r\n        this.checkedAllSKUInfo.discount = this.checkedAllSKUInfo.discount.replace(/\\.$/, '');\r\n        if(this.tableData.length){\r\n          this.tableData.forEach(item => {\r\n            item.allotPrice = (item.retailPrice * Number(this.checkedAllSKUInfo.discount) / 10).toFixed(2)\r\n          });\r\n          // 计算选中的商品总信息\r\n          this.getCheckedAllSKUInfo();\r\n        }\r\n      },\r\n      // 继续选货\r\n      continueCheckGoods(){\r\n        this.$emit('update:checkedGoodsShow', false)\r\n      },\r\n      // 取消\r\n      href() {\r\n        this.$router.push({\r\n          path: '/scb/order/sell_order'\r\n        });\r\n      },\r\n      /**\r\n       * 最终提交\r\n       */\r\n      saveDraft(type){\r\n        if(!this.tableData.length){\r\n          return\r\n        }\r\n        let Info = this.transferSlipAddInfo;\r\n        let data = {\r\n          \"purchaseAgentId\": Info.inStoreId,\r\n          \"purchaseAgentName\": Info.inStoreName,\r\n          \"orderId\": this.$route.query.id,\r\n          \"orderNum\": this.$route.query.orderNum,\r\n          \"purchaseOrderStatus\":Info.purchaseOrderStatus,\r\n          divisionId:Info.divisionId,\r\n          \"receiveMan\": Info.receiveMan,\r\n          \"phone\": Info.phone,\r\n          \"provinceCode\": Info.provinceCode,\r\n          \"provinceName\": Info.provinceName,\r\n          \"cityCode\": Info.cityCode,\r\n          \"cityName\": Info.cityName,\r\n          \"areaCode\": Info.areaCode,\r\n          \"areaName\": Info.areaName,\r\n          \"addressInfo\": Info.addressInfo,\r\n          \"carriage\": \"到付\",\r\n          purchaseOrderProductVOS: []\r\n        };\r\n\r\n        this.tableData.forEach(item => {\r\n          let obj = {\r\n            id:item.id,\r\n            \"brandId\": item.productBrandId || item.brandId,\r\n            \"brandName\": item.productBrandName || item.brandName,\r\n            \"color\": item.color,\r\n            \"colorSeries\": item.colorSeries,\r\n            \"goodsCode\": item.code || item.goodsCode,\r\n            \"goodsName\": item.name || item.goodsName,\r\n            \"image\": item.image,\r\n            \"price\": item.retailPrice || item.price,\r\n            \"productCode\": item.productCode,\r\n            // \"productName\": item.productName,\r\n            purchasePrice:item.purchasePrice,\r\n            \"modifyPrice\": item.modifyPrice,\r\n            \"size\": item.size,\r\n            \"skuModifyQuantity\": item.quantity || item.skuQuantity, \r\n            skuQuantity: item.quantity || item.skuQuantity,\r\n            \"skuRefundQuantity\": 0\r\n          };\r\n          if(item.modifyPriceCopy !== item.modifyPrice) {\r\n            obj.modifyPriceType = 1;\r\n          }else{\r\n            obj.modifyPriceType = 0;\r\n          };\r\n          // if(type == 0 && !this.$route.query.orderNum) {\r\n          //   obj.purchasePrice = item.purchasePrice;\r\n          // }\r\n          // if(type == 1) {\r\n          //   obj.purchasePrice = item.purchasePrice;\r\n          // }\r\n          data.purchaseOrderProductVOS.push(obj);\r\n        });\r\n\r\n        let url = null;\r\n        switch(type) {\r\n          case 0:\r\n            url = this.api.scb.purchaseOrder_saveDraft;\r\n            break;\r\n          case 1:\r\n            url = this.$route.query.orderNum \r\n            ? this.api.scb.purchaseOrder_modification \r\n            : this.api.scb.purchaseOrder_allocateCargo;\r\n            break;\r\n        };\r\n        this.request(url, data).then(data => {\r\n          sessionStorage.removeItem(\"TRANSFER_SLIP_APP_INFO\");\r\n          if(data && data.length){\r\n            let html = '';\r\n            data.forEach(errItem => {\r\n              for(let i = this.tableData.length - 1; i >= 0; i--){\r\n                if(this.tableData[i].code == errItem.code){\r\n                  if(errItem.stockQty == 0){  \r\n                    this.tableData.splice(i, 1);\r\n                    html += '<p>'+ errItem.code + '：可用库存为0，已删除该商品；</p>';\r\n                  }else {\r\n                    html += '<p>'+ errItem.code + '：可用库存不足，已更新为最大值' + errItem.stockQty + '；</p>';\r\n                    this.tableData[i].stockQty = errItem.stockQty;\r\n                    this.tableData[i].quantity = errItem.stockQty;\r\n                  }\r\n                  break;\r\n                }\r\n              }\r\n            });\r\n            this.$notify({\r\n              title: '提示',\r\n              duration: 0,\r\n              dangerouslyUseHTMLString: true,\r\n              message: html\r\n            });\r\n            this.$nextTick(() => {\r\n              this.init();\r\n            })\r\n          }else {\r\n            this.$notify.success({ title: '成功',message: type == 1 ? '新增成功！' : '修改成功！'});\r\n            this.$router.push({\r\n              path: '/scb/order/sell_order'\r\n            })\r\n          }\r\n        });\r\n      },\r\n      /**\r\n       * 表格更改条数\r\n       * @param val 每页的条数\r\n       */\r\n      handleSizeChange(val){\r\n        this.formData.pageSize = val;\r\n        this.formData.pageIndex = 1;\r\n        this.getShowTableData();\r\n      },\r\n      /**\r\n       * 表格更改页数\r\n       * @param val 页码\r\n       */\r\n      handleCurrentChange(val){\r\n        this.formData.pageIndex=val;\r\n        this.getShowTableData();\r\n      }\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {\r\n\r\n    }\r\n  }\r\n</script>\r\n"],"sourceRoot":"src/views/scb/components"}]}