{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\uploadImg\\el_upload_img.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\components\\uploadImg\\el_upload_img.vue","mtime":1587347931303},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/**\r\n * 因时间问题\r\n * 部分功能未从父级传入\r\n * 如有调用 请 梳理并增加默认参数\r\n *\r\n */\nimport { getToken } from \"@/utils/auth\";\nvar token = getToken(); /// localStorage.getItem('token') // 要保证取到\n\nexport default {\n  name: \"el-upload-img\",\n  model: {\n    prop: \"productImg\",\n    event: 'parentRef'\n  },\n  props: {\n    productImg: [Array, String],\n    disabled: {\n      //禁用\n      default: false,\n      type: Boolean\n    },\n    LssUpimgLimit: {\n      //图片上传限制  已做 超出隐藏\n      default: 1,\n      type: [Number, String]\n    },\n    CatalogName: {\n      //catalog名称\n      default: 'product',\n      type: String\n    },\n    //上传显示样式\n    lssListType: {\n      default: 'picture-card',\n      type: String\n    },\n    // 回显 图片\n    EchoDisplayImages: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    //图片大小\n    ImgSize: {\n      default: 2,\n      type: [Number, String]\n    },\n    ImgTips: {\n      default: '',\n      type: String\n    }\n  },\n  data: function data() {\n    return {\n      hideUpload: false,\n      elImgSize: null,\n      //单图上传\n      dialogImageUrl: \"\",\n      dialogImgVisible: false,\n      productImgs: [],\n      isMultiple: false,\n      imgLimit: 6,\n      tokenHeaders: {\n        accessToken: token\n      },\n      uploadData: {},\n      imgTxt: '',\n      //多图上传\n      arrMultiple: true //是否支持多选文件\n\n    };\n  },\n  created: function created() {\n    this.init();\n    this.productImgs = this.EchoDisplayImages;\n    this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\n    this.imgTxt = !!this.ImgTips ? this.ImgTips : \"\\u53EA\\u80FD\\u4E0A\\u4F20\\u5355\\u5F20\\u56FE\\u7247\\uFF0C\\u5927\\u5C0F\\u4E0D\\u8D85\\u8FC7\".concat(this.ImgSize, \"M\");\n  },\n  watch: {\n    EchoDisplayImages: function EchoDisplayImages() {\n      this.productImgs = this.EchoDisplayImages;\n      this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\n    }\n  },\n  methods: {\n    init: function init() {\n      this.uploadData = {\n        catalog: this.CatalogName\n      };\n      this.elImgSize = Number(this.ImgSize);\n    },\n    imgAction: function imgAction() {\n      return this.api.FN_ALLPATH(this.api.content.picture_upload);\n    },\n    handlePictureCardPreview: function handlePictureCardPreview(file) {\n      //预览图片时调用\n      this.dialogImageUrl = file.url;\n      this.dialogImgVisible = true;\n    },\n    beforeAvatarUpload: function beforeAvatarUpload(file) {\n      //文件上传之前调用做一些拦截限制\n      this.uploadData = {\n        catalog: \"content\",\n        name: \"photo\"\n      };\n      var isJPG = true;\n      var isLtM = true;\n\n      if (this.elImgSize < 1) {\n        isLtM = file.size / 1024 < Number(this.elImgSize) * 1000;\n      } else {\n        isLtM = file.size / 1024 / 1024 < Number(this.elImgSize);\n      }\n\n      if (!isLtM) {\n        if (this.elImgSize < 1) {\n          var _size = Number(this.elImgSize) * 1000;\n\n          this.$message.error('上传图片大小不能超过' + _size + 'KB!');\n        } else {\n          this.$message.error('上传图片大小不能超过' + this.elImgSize + 'MB!');\n        }\n      }\n\n      return isJPG && isLtM;\n    },\n    handleAvatarSuccess: function handleAvatarSuccess(res, file) {\n      //图片上传成功\n      //console.log(res.data.imageUrl);\n      this.$emit('parentRef', res.data.imageUrl); // this.imageUrl = URL.createObjectURL(file.raw);\n    },\n    handleExceed: function handleExceed(files, fileList) {\n      //图片上传超过数量限制\n      this.$message.error(\"只能上传一张!\");\n    },\n    imgUploadError: function imgUploadError(err, file, fileList) {\n      //图片上传失败调用\n      this.$message.error(\"上传图片失败!\");\n    },\n\n    /**\r\n     * @Date: 2019-10-24 14:39:10\r\n     * @description: 删除图片  TODO 不能通过服务器删除 因为卡券使用的了默认图片 删除后影响数据\r\n     * @author: elephant\r\n     * @param {file,fileList} \r\n     * @return: \r\n     */\n    handleRemove: function handleRemove(file, fileList) {\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\n      this.$emit('remove-img', file, fileList); //移除图片\n      // let fileImgUrl = null;\n      // if (file.response) {\n      //   fileImgUrl = file.response.data.imageUrl;\n      // } else {\n      //   fileImgUrl = file.url;\n      // }\n      // let imgArr = this.productImgs;\n      // let index = imgArr.findIndex(item => item.path == fileImgUrl);\n      // if(imgArr[index].id != undefined){\n      //     this.request(this.api.product.enterpriseArchivalInformation_logicDelete,{id:imgArr[index].id});\n      // }\n      // imgArr.splice(index, 1);\n    },\n    handleChange: function handleChange(files, fileList) {\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\n    }\n  }\n};",{"version":3,"sources":["el_upload_img.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <el-upload\r\n      :class=\"{hide:hideUpload,imgdisabled:disabled}\"\r\n      :action=\"imgAction()\"\r\n      :list-type=\"lssListType\"\r\n      accept=\"image/*\"\r\n      :limit=\"LssUpimgLimit\"\r\n      :headers=\"tokenHeaders\"\r\n      :file-list=\"productImgs\"\r\n      :multiple=\"isMultiple\"\r\n      :on-preview=\"handlePictureCardPreview\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleAvatarSuccess\"\r\n      :on-change=\"handleChange\"\r\n      :data=\"uploadData\"\r\n      :before-upload=\"beforeAvatarUpload\"\r\n      :on-exceed=\"handleExceed\"\r\n      :on-error=\"imgUploadError\"\r\n    >\r\n      <el-button v-if=\"lssListType == 'picture'\" :disabled=\"disabled\" size=\"small\" type=\"primary\">上传图片</el-button>\r\n      <i  v-else class=\"el-icon-plus\"></i>\r\n    </el-upload>\r\n     <p class=\"img-tips\">{{imgTxt}}</p>\r\n    <el-dialog :visible.sync=\"dialogImgVisible\"  append-to-body>\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\n/**\r\n * 因时间问题\r\n * 部分功能未从父级传入\r\n * 如有调用 请 梳理并增加默认参数\r\n *\r\n */\r\nimport { getToken } from \"@/utils/auth\";\r\nlet token = getToken(); /// localStorage.getItem('token') // 要保证取到\r\nexport default {\r\n  name: \"el-upload-img\",\r\n  model:{\r\n      prop:\"productImg\",\r\n      event:'parentRef'\r\n  },\r\n  props: {\r\n    productImg:[Array,String],\r\n    disabled:{ //禁用\r\n      default: false,\r\n      type:Boolean\r\n    },\r\n    LssUpimgLimit:{ //图片上传限制  已做 超出隐藏\r\n      default: 1,\r\n      type:[Number,String]\r\n    },\r\n    CatalogName:{  //catalog名称\r\n      default: 'product',\r\n      type: String\r\n    },\r\n    //上传显示样式\r\n    lssListType:{\r\n      default:'picture-card',\r\n      type:String\r\n    },\r\n    // 回显 图片\r\n    EchoDisplayImages:{\r\n      type: Array,\r\n       default() {\r\n      return []\r\n    }\r\n    },\r\n    //图片大小\r\n    ImgSize:{\r\n      default:2,\r\n      type:[Number,String]\r\n    },\r\n    ImgTips:{\r\n      default:'',\r\n      type:String\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      hideUpload: false,\r\n      elImgSize:null,\r\n      //单图上传\r\n      dialogImageUrl: \"\",\r\n      dialogImgVisible: false,\r\n      productImgs: [],\r\n      isMultiple: false,\r\n      imgLimit: 6,\r\n      tokenHeaders:{accessToken: token},\r\n      uploadData:{},\r\n      imgTxt: '',\r\n      //多图上传\r\n      arrMultiple: true //是否支持多选文件\r\n    };\r\n  },\r\n  created() {\r\n  this.init();\r\n   this.productImgs=this.EchoDisplayImages;\r\n   this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\r\n   this.imgTxt = !!this.ImgTips ? this.ImgTips : `只能上传单张图片，大小不超过${this.ImgSize}M`;\r\n\r\n  },\r\n  watch: {\r\n    EchoDisplayImages(){\r\n      this.productImgs = this.EchoDisplayImages;\r\n      this.hideUpload = this.EchoDisplayImages.length >= this.LssUpimgLimit || this.disabled;\r\n    }\r\n  },\r\n  methods: {\r\n    init(){\r\n      this.uploadData = { catalog: this.CatalogName};\r\n      this.elImgSize=Number(this.ImgSize)\r\n    },\r\n    imgAction() {\r\n      return this.api.FN_ALLPATH(this.api.content.picture_upload);\r\n    },\r\n    handlePictureCardPreview(file) {\r\n      //预览图片时调用\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogImgVisible = true;\r\n    },\r\n    beforeAvatarUpload(file) {\r\n      //文件上传之前调用做一些拦截限制\r\n      this.uploadData = { catalog: \"content\", name: \"photo\" };\r\n      let isJPG = true;\r\n      let isLtM = true;\r\n      if(this.elImgSize < 1){\r\n        isLtM = file.size / 1024 < Number(this.elImgSize) * 1000;\r\n      }else{\r\n        isLtM = file.size / 1024 / 1024 < Number(this.elImgSize);\r\n      }\r\n      if (!isLtM) {\r\n        if(this.elImgSize < 1){\r\n          let _size= Number(this.elImgSize) * 1000;\r\n          this.$message.error('上传图片大小不能超过'+_size+'KB!');\r\n        }else{\r\n          this.$message.error('上传图片大小不能超过'+this.elImgSize+'MB!');\r\n        }\r\n      }\r\n      return isJPG && isLtM;\r\n    },\r\n    handleAvatarSuccess(res, file) {\r\n      //图片上传成功\r\n      //console.log(res.data.imageUrl);\r\n      this.$emit('parentRef',res.data.imageUrl);\r\n      // this.imageUrl = URL.createObjectURL(file.raw);\r\n    },\r\n    handleExceed(files, fileList) {\r\n      //图片上传超过数量限制\r\n      this.$message.error(\"只能上传一张!\");\r\n    },\r\n    imgUploadError(err, file, fileList) {\r\n      //图片上传失败调用\r\n      this.$message.error(\"上传图片失败!\");\r\n    },\r\n    /**\r\n     * @Date: 2019-10-24 14:39:10\r\n     * @description: 删除图片  TODO 不能通过服务器删除 因为卡券使用的了默认图片 删除后影响数据\r\n     * @author: elephant\r\n     * @param {file,fileList} \r\n     * @return: \r\n     */\r\n    handleRemove(file, fileList) {\r\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\r\n      this.$emit('remove-img',file,fileList)\r\n      //移除图片\r\n      // let fileImgUrl = null;\r\n      // if (file.response) {\r\n      //   fileImgUrl = file.response.data.imageUrl;\r\n      // } else {\r\n      //   fileImgUrl = file.url;\r\n      // }\r\n      // let imgArr = this.productImgs;\r\n      // let index = imgArr.findIndex(item => item.path == fileImgUrl);\r\n      // if(imgArr[index].id != undefined){\r\n      //     this.request(this.api.product.enterpriseArchivalInformation_logicDelete,{id:imgArr[index].id});\r\n      // }\r\n      // imgArr.splice(index, 1);\r\n    },\r\n    handleChange(files, fileList){\r\n      this.hideUpload = fileList.length >= this.LssUpimgLimit;\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.hide /deep/ .el-upload--picture-card {\r\n    display: none;\r\n}\r\n.imgdisabled /deep/ .el-upload-list__item-delete {\r\n    display: none !important;\r\n}\r\n</style>\r\n\r\n"],"sourceRoot":"src/components/uploadImg"}]}