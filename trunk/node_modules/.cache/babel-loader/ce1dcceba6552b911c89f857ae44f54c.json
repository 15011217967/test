{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OS\\store\\other_bill\\refund_list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\OS\\store\\other_bill\\refund_list.vue","mtime":1574160265280},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _objectSpread from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { isBankAccount } from '@/utils/validate';\nimport { mapGetters } from \"vuex\";\nimport * as userTypes from \"@/types/userConfig\";\n\nvar bankaccount = function bankaccount(rule, value, callback) {\n  if (!value) {\n    callback(new Error('请输入银行账号'));\n  } else if (!isBankAccount(value) && value) {\n    callback(new Error('请输入正确的银行账号'));\n  } else {\n    callback();\n  }\n};\n\nexport default {\n  data: function data() {\n    return {\n      signData: {\n        // orderType:'0202',\n        fuzzyQuery: \"\",\n        //标记单据状态\n        refundMoneyOrderStatus: \"\",\n        //标记门店状态\n        storeId: \"\",\n        //标记生成时间\n        startDate: \"\",\n        endDate: \"\",\n        //标记退款时间\n        refundStartDate: \"\",\n        refundEndDate: \"\",\n        //当前页数\n        pageIndex: 1,\n        //每页要显示的数据条数,默认10条\n        pageSize: 10\n      },\n      //退款金额\n      refundMoney: null,\n      //退款Dialog的数据源\n      accountVO: {\n        id: \"\",\n        //银行账号\n        refundMoneyAccountNum: \"\",\n        //备注\n        remark: \"\"\n      },\n      accountVORules: {\n        refundMoneyAccountNum: [{\n          required: true,\n          trigger: \"blur\",\n          validator: bankaccount\n        }]\n      },\n      //标识是否显示退款dialog\n      showRefundDialog: false,\n      //添加备注Dialog的数据源\n      remarkFormData: {\n        id: \"\"\n      },\n      //确认收款校验规则\n      remarkFormRules: {\n        remark: [{\n          required: true,\n          message: \"备注不能为空\",\n          trigger: \"blur\"\n        }]\n      },\n      //标识是否显示添加备注的dialog\n      showRemarkDialog: false,\n      //存储表格选择项改变时的数据\n      multipleSelectionData: [],\n      //表格数据\n      tableData: [],\n      //总条数\n      totalCount: 1,\n      //存储门店数据\n      storeListData: [],\n      //生成时间\n      startTime: \"\",\n      //退款时间\n      refundStarTime: \"\"\n    };\n  },\n  computed: _objectSpread({}, mapGetters({\n    userInfo: userTypes.GETTER_USERINFO\n  })),\n  //过滤器\n  filters: {\n    //过滤单据状态\n    filterRefundMoneyOrderStatus: function filterRefundMoneyOrderStatus(val) {\n      switch (val) {\n        case 0:\n          return \"退款中\";\n          break;\n\n        case 1:\n          return \"已退款\";\n          break;\n\n        case 2:\n          return \"退款异常\";\n          break;\n      }\n    },\n    //过滤退款方式\n    filterRefundMoneyWayCode: function filterRefundMoneyWayCode(val) {\n      switch (val) {\n        case 1:\n          return \"现金\";\n          break;\n\n        case 2:\n          return \"微信付款\";\n          break;\n\n        case 3:\n          return \"刷卡\";\n          break;\n\n        case 4:\n          return \"余额支付\";\n          break;\n\n        case 5:\n          return \"支付宝付款\";\n          break;\n      }\n    },\n    //过滤退款来源\n    filterRefundMoneySource: function filterRefundMoneySource(val) {\n      switch (val) {\n        case 0:\n          return \"门店\";\n          break;\n\n        default:\n          return \"--\";\n          break;\n      }\n    }\n  },\n  mounted: function mounted() {\n    //得到组织机构数据\n    this.getWarehouseListData(); //得到列表数据\n\n    this.getChannelReturnListData();\n  },\n  watch: {\n    \"accountVO.refundMoneyAccountNum\": function accountVORefundMoneyAccountNum(val) {\n      var _this = this;\n\n      this.$nextTick(function () {\n        _this.accountVO.refundMoneyAccountNum = val.replace(/\\D/g, \"\").replace(/....(?!$)/g, \"$& \");\n      });\n    }\n  },\n  methods: {\n    //得到组织机构数据\n    getWarehouseListData: function () {\n      var _getWarehouseListData = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        var info;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.request(this.api.user.get_userinfo, {}, true);\n\n              case 2:\n                info = _context.sent;\n                console.log(info); //得到部门Id\n                // this.signData.relationDepId = info.departId;\n\n                this.request(this.api.user.userCompany_getUserOrgByUserId, {\n                  userId: info.userId,\n                  type: 0\n                }).then(function (data) {\n                  //得到门店列表数据\n                  _this2.getStoreBasicListData(data.id);\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getWarehouseListData() {\n        return _getWarehouseListData.apply(this, arguments);\n      }\n\n      return getWarehouseListData;\n    }(),\n    //得到门店列表数据\n    getStoreBasicListData: function getStoreBasicListData(organizationId) {\n      var _this3 = this;\n\n      this.request(this.api.store.storeBasic_list, {}).then(function (res) {\n        console.log(res);\n        _this3.storeListData = res.data;\n      });\n    },\n    //得到列表数据\n    getChannelReturnListData: function getChannelReturnListData() {\n      var _this4 = this;\n\n      if (this.startTime) {\n        this.signData.startDate = this.startTime[0];\n        this.signData.endDate = this.startTime[1];\n      }\n\n      if (this.refundStarTime) {\n        this.signData.refundStartDate = this.refundStarTime[0];\n        this.signData.refundEndDate = this.refundStarTime[1];\n      }\n\n      this.request(this.api.retailStore.storeConsumerRefundMoney_list, this.signData).then(function (data) {\n        _this4.totalCount = data.totalCount;\n        _this4.tableData = data.data;\n        console.log(data);\n      });\n    },\n    //查询表单数据\n    searchFormData: function searchFormData(ref) {\n      var _this5 = this;\n\n      this.$refs[ref].validate(function (valid) {\n        console.log(valid);\n\n        if (valid) {\n          _this5.getChannelReturnListData();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    //重置表单数据\n    resetFormData: function resetFormData(formData) {\n      console.log(this.$refs[formData]);\n      this.$refs[formData].resetFields();\n      this.signData.startDate = \"\";\n      this.signData.endDate = \"\";\n      this.signData.refundStartDate = \"\";\n      this.signData.refundEndDate = \"\";\n      this.startTime = \"\";\n      this.refundStarTime = \"\";\n    },\n    //导出\n    exportExcel: function exportExcel() {\n      var _this6 = this;\n\n      console.log(\"导出Excel表格...+++++++++++++++++++\");\n\n      require.ensure([], function () {\n        var _require = require(\"@/vendor/Export2Excel\"),\n            export_json_to_excel = _require.export_json_to_excel;\n\n        var tHeader = [\"退款单号\", \"单据状态\", \"退款方式\", \"退款金额\", \"退款原因\", \"退款时间\", \"生成时间\", \"源订单号\", \"退款来源\", \"支付订单号\", \"所属门店\"]; // 上面设置Excel的表格第一行的标题\n\n        var filterVal = [\"refundMoneyOrderNum\", \"refundMoneyOrderStatusName\", \"refundMoneyWayCodeName\", \"refundMoney\", \"reason\", \"refundMoneyTimeFilter\", \"createTimeFilter\", \"sourceOrderNum\", \"refundMoneySourceName\", \"paymentNum\", \"storeName\"]; // 上面的index、nickName、name是tableData里对象的属性\n\n        var list = _this6.multipleSelectionData; //把data里的multipleSelectionData存到list\n\n        var data = _this6.formatJson(filterVal, list);\n\n        export_json_to_excel(tHeader, data, \"渠道退款表单\");\n      });\n    },\n    formatJson: function formatJson(filterVal, jsonData) {\n      return jsonData.map(function (v) {\n        return filterVal.map(function (j) {\n          return v[j];\n        });\n      });\n    },\n    //表格选择项改变时触发\n    selectionChange: function selectionChange(val) {\n      var _this7 = this;\n\n      val.forEach(function (item) {\n        item.refundMoneyOrderStatusName = _this7.$options.filters.filterRefundMoneyOrderStatus(item.refundMoneyOrderStatus);\n        item.refundMoneyWayCodeName = _this7.$options.filters.filterRefundMoneyWayCode(item.refundMoneyWayCode);\n        item.refundMoneySourceName = _this7.$options.filters.filterRefundMoneySource(item.refundMoneySource);\n        item.refundMoneyTimeFilter = _this7.$options.filters.timestampToTime(item.refundMoneyTime);\n        item.createTimeFilter = _this7.$options.filters.timestampToTime(item.createTime);\n      });\n      console.log(val);\n      this.multipleSelectionData = val;\n    },\n    //查看Btn的事件\n    checkBtnClick: function checkBtnClick(row) {\n      console.log(row);\n      this.$router.push({\n        path: \"/OS/store/other_bill/refund_check\",\n        query: {\n          refundId: row.id\n        }\n      });\n    },\n    //退款Btn的事件\n    refundBtnClick: function refundBtnClick(row) {\n      console.log(row); // updateName: row.goodsOwner\n\n      switch (row.refundMoneyWayCode) {\n        case 2:\n          //微信支付\n          this.wxPay(row);\n          break;\n\n        case 3:\n          this.refundMoney = row.refundMoney;\n          this.accountVO.id = row.id; //银行卡支付\n\n          this.showRefundDialog = true;\n          break;\n      }\n    },\n    //添加备注Btn的事件\n    addRemarkBtnClick: function addRemarkBtnClick(row) {\n      this.showRemarkDialog = true;\n      this.accountVO.id = row.id;\n    },\n    //退款-微信支付\n    wxPay: function wxPay(row) {\n      var _this8 = this;\n\n      this.$confirm(\"确认再次发起退款？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(function () {\n        _this8.request(_this8.api.retailStore.storeConsumerRefundMoney_againRefundMoney, {\n          id: row.id,\n          updateName: _this8.userInfo.name\n        }).then(function (data) {\n          console.log(data); //刷新数据\n\n          _this8.getChannelReturnListData();\n        });\n      }).catch(function (action) {});\n    },\n    //每页条数改变时\n    handleSizeChange: function handleSizeChange(page) {\n      this.signData.pageSize = page;\n      this.getChannelReturnListData();\n    },\n    //当前页改变时\n    handleCurrentChange: function handleCurrentChange(page) {\n      this.signData.pageIndex = page;\n      this.getChannelReturnListData();\n    },\n    //退款dialog中确认btn的点击事件\n    sureRefundDailogBtnClick: function sureRefundDailogBtnClick(ref) {\n      var _this9 = this;\n\n      console.log(\"sureRefundDailogBtnClick--------\");\n      this.$refs[ref].validate(function (valid) {\n        console.log(valid);\n\n        if (valid) {\n          _this9.request(_this9.api.retailStore.storeConsumerRefundMoney_updateStoreConsumerRefundMoney, _this9.accountVO).then(function (res) {\n            _this9.hideRefundDialogEvent();\n\n            _this9.getChannelReturnListData();\n          });\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    //退款Dialog的隐藏事件\n    hideRefundDialogEvent: function hideRefundDialogEvent() {\n      this.$refs.refundForm.resetFields();\n      this.showRefundDialog = false;\n      console.log(\"hideRefundDialogEvent-------\");\n    },\n    //添加备注Dialog中确认btn的点击事件\n    sureRemarkDailogBtnClick: function sureRemarkDailogBtnClick(ref) {\n      var _this10 = this;\n\n      this.$refs[ref].validate(function (valid) {\n        console.log(valid);\n\n        if (valid) {\n          _this10.request(_this10.api.retailStore.storeConsumerRefundMoney_updateStoreConsumerRefundMoney, _this10.accountVO).then(function (res) {\n            _this10.hideRemarksDialogEvent();\n\n            _this10.getChannelReturnListData();\n          });\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n    //添加备注Dialog的隐藏事件\n    hideRemarksDialogEvent: function hideRemarksDialogEvent() {\n      this.showRemarkDialog = false;\n      this.$refs.remarkForm.resetFields();\n    }\n  }\n};",{"version":3,"sources":["refund_list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"search_div\">\r\n      <el-form ref=\"formData\" :model=\"signData\" label-width=\"110px\" :inline=\"true\">\r\n        <el-form-item label=\"模糊查询：\" prop=\"fuzzyQuery\">\r\n          <el-input class=\"first-input\" v-model=\"signData.fuzzyQuery\" placeholder=\"退款单号/源订单号\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"单据状态：\" prop=\"refundMoneyOrderStatus\">\r\n          <el-select v-model=\"signData.refundMoneyOrderStatus\" placeholder=\"请选择\">\r\n            <el-option label=\"退款中\" value=\"0\"></el-option>\r\n            <el-option label=\"已退款\" value=\"1\"></el-option>\r\n            <el-option label=\"退款异常\" value=\"2\"></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"所属门店：\" prop=\"storeId\" label-width=\"140px\">\r\n          <el-select v-model=\"signData.storeId\" placeholder=\"请选择\">\r\n            <el-option\r\n              v-for=\"item in storeListData\"\r\n              :label=\"item.name\"\r\n              :key=\"item.id\"\r\n              :value=\"item.id\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"生成时间：\" prop=\"startTime\">\r\n          <el-date-picker\r\n            v-model=\"startTime\"\r\n            type=\"daterange\"\r\n            range-separator=\"-\"\r\n            start-placeholder=\"开始日期\"\r\n            end-placeholder=\"结束日期\"\r\n          ></el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item label=\"退款时间：\" prop=\"endTime\">\r\n          <el-date-picker\r\n            v-model=\"refundStarTime\"\r\n            type=\"daterange\"\r\n            range-separator=\"-\"\r\n            start-placeholder=\"开始日期\"\r\n            end-placeholder=\"结束日期\"\r\n          ></el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"searchFormData('formData')\" size=\"small\">查询</el-button>\r\n          <el-button @click=\"resetFormData('formData')\" size=\"small\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <div class=\"table_div\">\r\n      <el-button\r\n        :disabled=\"multipleSelectionData.length==0\"\r\n        plain\r\n        @click=\"exportExcel\"\r\n        size=\"small\"\r\n      >导出</el-button>\r\n      <el-table\r\n        ref=\"multipleTable\"\r\n        :data=\"tableData\"\r\n        tooltip-effect=\"dark\"\r\n        style=\"width: 100%\"\r\n        header-row-class-name=\"item-table-header\"\r\n        @selection-change=\"selectionChange\"\r\n      >\r\n        <el-table-column type=\"selection\" width=\"55\"></el-table-column>\r\n        <el-table-column label=\"退款单号\" width=\"210\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.refundMoneyOrderNum }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"refundMoneyOrderStatus\" label=\"单据状态\" width=\"120\" align=\"center\">\r\n          <template\r\n            slot-scope=\"scope\"\r\n          >{{ scope.row.refundMoneyOrderStatus | filterRefundMoneyOrderStatus }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"refundMoneyWayCode\" label=\"退款方式\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.refundMoneyWayCode | filterRefundMoneyWayCode }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"refundMoney\" label=\"退款金额\" width=\"120\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"reason\" label=\"退款原因\" width=\"120\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.reason?scope.row.reason:\"--\" }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"refundMoneyTime\" label=\"退款时间\" width=\"160\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.refundMoneyTime | timestampToTime }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"createTime\" label=\"生成时间\" width=\"160\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.createTime | timestampToTime }}</template>\r\n        </el-table-column>\r\n        <el-table-column label=\"源订单号\" width=\"210\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.sourceOrderNum }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"refundMoneySource\" label=\"退款来源\" width=\"100\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.refundMoneySource | filterRefundMoneySource}}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"paymentNum\" label=\"支付订单号\" width=\"180\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.paymentNum?scope.row.paymentNum:'--'}}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"storeName\" label=\"所属门店\" width=\"120\" align=\"center\">\r\n          <template slot-scope=\"scope\">{{ scope.row.storeName }}</template>\r\n        </el-table-column>\r\n        <el-table-column fixed=\"right\" label=\"操作\" width=\"160\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button @click=\"checkBtnClick(scope.row)\" type=\"text\" size=\"small\">查看</el-button>\r\n            <el-button\r\n              v-show=\"(scope.row.refundMoneyOrderStatus==2&&scope.row.refundMoneyWayCode==2)||(scope.row.refundMoneyOrderStatus==0&&scope.row.refundMoneyWayCode==3)\"\r\n              @click=\"refundBtnClick(scope.row)\"\r\n              type=\"text\"\r\n              size=\"small\"\r\n            >退款</el-button>\r\n            <el-button\r\n              v-show=\"scope.row.refundMoneyOrderStatus==0&&scope.row.refundMoneyWayCode==3\"\r\n              @click=\"addRemarkBtnClick(scope.row)\"\r\n              type=\"text\"\r\n              size=\"small\"\r\n            >添加备注</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <div style=\"margin-top:20px;padding-bottom:10px;margin-right:20px;\">\r\n        <el-pagination\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n          :current-page.sync=\"signData.pageIndex\"\r\n          :page-sizes=\"[10, 20, 30, 40]\"\r\n          :page-size=\"signData.pageSize\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"totalCount\"\r\n        ></el-pagination>\r\n      </div>\r\n      <el-dialog\r\n        title=\"提示\"\r\n        :visible.sync=\"showRefundDialog\"\r\n        @close=\"hideRefundDialogEvent\"\r\n        width=\"600px\"\r\n        height=\"600px\"\r\n      >\r\n        <el-form :model=\"accountVO\" ref=\"refundForm\" :rules=\"accountVORules\">\r\n          <el-form-item label=\"退款金额：\" label-width=\"100px\">\r\n            <span>￥{{refundMoney}}</span>\r\n          </el-form-item>\r\n          <el-form-item label=\"退款账户：\" label-width=\"100px\" prop=\"refundMoneyAccountNum\">\r\n            <el-input\r\n              v-model=\"accountVO.refundMoneyAccountNum\"\r\n              :maxlength=\"23\"\r\n              style=\"width:260px;\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"showRefundDialog=false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"sureRefundDailogBtnClick('refundForm')\">确 定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n      <el-dialog\r\n        title=\"添加备注\"\r\n        :visible.sync=\"showRemarkDialog\"\r\n        @close=\"hideRemarksDialogEvent\"\r\n        width=\"600px\"\r\n        height=\"600px\"\r\n      >\r\n        <el-form :model=\"accountVO\" ref=\"remarkForm\" :rules=\"remarkFormRules\">\r\n          <el-form-item label=\"添加备注：\" label-width=\"100px\" prop=\"remark\">\r\n            <el-input\r\n              v-model=\"accountVO.remark\"\r\n              style=\"width:300px;\"\r\n              class=\"remark\"\r\n              type=\"textarea\"\r\n              resize=\"none\"\r\n              placeholder=\"请输入内容\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"showRemarkDialog=false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"sureRemarkDailogBtnClick('remarkForm')\">确 定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {isBankAccount} from '@/utils/validate'\r\nimport { mapGetters } from \"vuex\";\r\nimport * as userTypes from \"@/types/userConfig\";\r\nlet bankaccount=(rule, value,callback)=>{\r\n  if(!value){\r\n    callback(new Error('请输入银行账号'));\r\n  }else if (!isBankAccount(value) && value){\r\n    callback(new Error('请输入正确的银行账号'));\r\n  }else {\r\n    callback();\r\n  }\r\n};\r\nexport default {\r\n  data() {\r\n    return {\r\n      signData: {\r\n        // orderType:'0202',\r\n        fuzzyQuery: \"\",\r\n        //标记单据状态\r\n        refundMoneyOrderStatus: \"\",\r\n        //标记门店状态\r\n        storeId: \"\",\r\n        //标记生成时间\r\n        startDate: \"\",\r\n        endDate: \"\",\r\n        //标记退款时间\r\n        refundStartDate: \"\",\r\n        refundEndDate: \"\",\r\n        //当前页数\r\n        pageIndex: 1,\r\n        //每页要显示的数据条数,默认10条\r\n        pageSize: 10\r\n      },\r\n      //退款金额\r\n      refundMoney: null,\r\n      //退款Dialog的数据源\r\n      accountVO: {\r\n        id: \"\",\r\n        //银行账号\r\n        refundMoneyAccountNum: \"\",\r\n        //备注\r\n        remark: \"\"\r\n      },\r\n      accountVORules: {\r\n        refundMoneyAccountNum: [\r\n          { required: true, trigger: \"blur\", validator: bankaccount}\r\n        ]\r\n      },\r\n      //标识是否显示退款dialog\r\n      showRefundDialog: false,\r\n      //添加备注Dialog的数据源\r\n      remarkFormData: {\r\n        id: \"\"\r\n      },\r\n      //确认收款校验规则\r\n      remarkFormRules: {\r\n        remark: [{ required: true, message: \"备注不能为空\", trigger: \"blur\" }]\r\n      },\r\n      //标识是否显示添加备注的dialog\r\n      showRemarkDialog: false,\r\n      //存储表格选择项改变时的数据\r\n      multipleSelectionData: [],\r\n      //表格数据\r\n      tableData: [],\r\n      //总条数\r\n      totalCount: 1,\r\n      //存储门店数据\r\n      storeListData: [],\r\n      //生成时间\r\n      startTime: \"\",\r\n      //退款时间\r\n      refundStarTime: \"\"\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      userInfo: userTypes.GETTER_USERINFO\r\n    })\r\n  },\r\n  //过滤器\r\n  filters: {\r\n    //过滤单据状态\r\n    filterRefundMoneyOrderStatus(val) {\r\n      switch (val) {\r\n        case 0:\r\n          return \"退款中\";\r\n          break;\r\n        case 1:\r\n          return \"已退款\";\r\n          break;\r\n        case 2:\r\n          return \"退款异常\";\r\n          break;\r\n      }\r\n    },\r\n    //过滤退款方式\r\n    filterRefundMoneyWayCode(val) {\r\n      switch (val) {\r\n        case 1:\r\n          return \"现金\";\r\n          break;\r\n        case 2:\r\n          return \"微信付款\";\r\n          break;\r\n        case 3:\r\n          return \"刷卡\";\r\n          break;\r\n        case 4:\r\n          return \"余额支付\";\r\n          break;\r\n        case 5:\r\n          return \"支付宝付款\";\r\n          break;\r\n      }\r\n    },\r\n    //过滤退款来源\r\n    filterRefundMoneySource(val) {\r\n      switch (val) {\r\n        case 0:\r\n          return \"门店\";\r\n          break;\r\n        default:\r\n          return \"--\";\r\n          break;\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    //得到组织机构数据\r\n    this.getWarehouseListData();\r\n    //得到列表数据\r\n    this.getChannelReturnListData();\r\n  },\r\n  watch: {\r\n    \"accountVO.refundMoneyAccountNum\": function(val) {\r\n      this.$nextTick(() => {\r\n        this.accountVO.refundMoneyAccountNum = val.replace(/\\D/g, \"\").replace(/....(?!$)/g, \"$& \");\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    //得到组织机构数据\r\n    async getWarehouseListData() {\r\n      let info = await this.request(this.api.user.get_userinfo, {}, true);\r\n      console.log(info);\r\n      //得到部门Id\r\n      // this.signData.relationDepId = info.departId;\r\n      this.request(this.api.user.userCompany_getUserOrgByUserId, {\r\n        userId: info.userId,\r\n        type: 0\r\n      }).then(data => {\r\n        //得到门店列表数据\r\n        this.getStoreBasicListData(data.id);\r\n      });\r\n    },\r\n    //得到门店列表数据\r\n    getStoreBasicListData(organizationId) {\r\n      this.request(this.api.store.storeBasic_list, {}).then(res => {\r\n        console.log(res);\r\n        this.storeListData = res.data;\r\n      });\r\n    },\r\n    //得到列表数据\r\n    getChannelReturnListData() {\r\n      if (this.startTime) {\r\n        this.signData.startDate = this.startTime[0];\r\n        this.signData.endDate = this.startTime[1];\r\n      }\r\n      if (this.refundStarTime) {\r\n        this.signData.refundStartDate = this.refundStarTime[0];\r\n        this.signData.refundEndDate = this.refundStarTime[1];\r\n      }\r\n      this.request(\r\n        this.api.retailStore.storeConsumerRefundMoney_list,\r\n        this.signData\r\n      ).then(data => {\r\n        this.totalCount = data.totalCount;\r\n        this.tableData = data.data;\r\n        console.log(data);\r\n      });\r\n    },\r\n    //查询表单数据\r\n    searchFormData(ref) {\r\n      this.$refs[ref].validate(valid => {\r\n        console.log(valid);\r\n        if (valid) {\r\n          this.getChannelReturnListData();\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //重置表单数据\r\n    resetFormData(formData) {\r\n      console.log(this.$refs[formData]);\r\n      this.$refs[formData].resetFields();\r\n      this.signData.startDate = \"\";\r\n      this.signData.endDate = \"\";\r\n      this.signData.refundStartDate = \"\";\r\n      this.signData.refundEndDate = \"\";\r\n\r\n      this.startTime = \"\";\r\n      this.refundStarTime = \"\";\r\n    },\r\n    //导出\r\n    exportExcel() {\r\n      console.log(\"导出Excel表格...+++++++++++++++++++\");\r\n      require.ensure([], () => {\r\n        let { export_json_to_excel } = require(\"@/vendor/Export2Excel\");\r\n        let tHeader = [\r\n          \"退款单号\",\r\n          \"单据状态\",\r\n          \"退款方式\",\r\n          \"退款金额\",\r\n          \"退款原因\",\r\n          \"退款时间\",\r\n          \"生成时间\",\r\n          \"源订单号\",\r\n          \"退款来源\",\r\n          \"支付订单号\",\r\n          \"所属门店\"\r\n        ];\r\n        // 上面设置Excel的表格第一行的标题\r\n        let filterVal = [\r\n          \"refundMoneyOrderNum\",\r\n          \"refundMoneyOrderStatusName\",\r\n          \"refundMoneyWayCodeName\",\r\n          \"refundMoney\",\r\n          \"reason\",\r\n          \"refundMoneyTimeFilter\",\r\n          \"createTimeFilter\",\r\n          \"sourceOrderNum\",\r\n          \"refundMoneySourceName\",\r\n          \"paymentNum\",\r\n          \"storeName\"\r\n        ];\r\n        // 上面的index、nickName、name是tableData里对象的属性\r\n        let list = this.multipleSelectionData; //把data里的multipleSelectionData存到list\r\n        let data = this.formatJson(filterVal, list);\r\n        export_json_to_excel(tHeader, data, \"渠道退款表单\");\r\n      });\r\n    },\r\n    formatJson(filterVal, jsonData) {\r\n      return jsonData.map(v => filterVal.map(j => v[j]));\r\n    },\r\n    //表格选择项改变时触发\r\n    selectionChange(val) {\r\n      val.forEach(item => {\r\n        item.refundMoneyOrderStatusName = this.$options.filters.filterRefundMoneyOrderStatus(\r\n          item.refundMoneyOrderStatus\r\n        );\r\n        item.refundMoneyWayCodeName = this.$options.filters.filterRefundMoneyWayCode(\r\n          item.refundMoneyWayCode\r\n        );\r\n        item.refundMoneySourceName = this.$options.filters.filterRefundMoneySource(\r\n          item.refundMoneySource\r\n        );\r\n        item.refundMoneyTimeFilter = this.$options.filters.timestampToTime(\r\n          item.refundMoneyTime\r\n        );\r\n        item.createTimeFilter = this.$options.filters.timestampToTime(\r\n          item.createTime\r\n        );\r\n      });\r\n      console.log(val);\r\n      this.multipleSelectionData = val;\r\n    },\r\n    //查看Btn的事件\r\n    checkBtnClick(row) {\r\n      console.log(row);\r\n      this.$router.push({\r\n        path: \"/OS/store/other_bill/refund_check\",\r\n        query: {\r\n          refundId: row.id\r\n        }\r\n      });\r\n    },\r\n    //退款Btn的事件\r\n    refundBtnClick(row) {\r\n      console.log(row);\r\n\r\n      // updateName: row.goodsOwner\r\n      switch (row.refundMoneyWayCode) {\r\n        case 2:\r\n          //微信支付\r\n          this.wxPay(row);\r\n          break;\r\n        case 3:\r\n          this.refundMoney = row.refundMoney;\r\n          this.accountVO.id = row.id;\r\n          //银行卡支付\r\n          this.showRefundDialog = true;\r\n          break;\r\n      }\r\n    },\r\n    //添加备注Btn的事件\r\n    addRemarkBtnClick(row) {\r\n      this.showRemarkDialog = true;\r\n      this.accountVO.id = row.id;\r\n    },\r\n    //退款-微信支付\r\n    wxPay(row) {\r\n      this.$confirm(\"确认再次发起退款？\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      })\r\n        .then(() => {\r\n          this.request(\r\n            this.api.retailStore.storeConsumerRefundMoney_againRefundMoney,\r\n            {\r\n              id: row.id,\r\n              updateName: this.userInfo.name\r\n            }\r\n          ).then(data => {\r\n            console.log(data);\r\n            //刷新数据\r\n            this.getChannelReturnListData();\r\n          });\r\n        })\r\n        .catch(action => {});\r\n    },\r\n    //每页条数改变时\r\n    handleSizeChange(page) {\r\n      this.signData.pageSize = page;\r\n      this.getChannelReturnListData();\r\n    },\r\n    //当前页改变时\r\n    handleCurrentChange(page) {\r\n      this.signData.pageIndex = page;\r\n      this.getChannelReturnListData();\r\n    },\r\n    //退款dialog中确认btn的点击事件\r\n    sureRefundDailogBtnClick(ref) {\r\n      console.log(\"sureRefundDailogBtnClick--------\");\r\n      this.$refs[ref].validate(valid => {\r\n        console.log(valid);\r\n        if (valid) {\r\n          this.request(\r\n            this.api.retailStore\r\n              .storeConsumerRefundMoney_updateStoreConsumerRefundMoney,\r\n            this.accountVO\r\n          ).then(res => {\r\n            this.hideRefundDialogEvent();\r\n            this.getChannelReturnListData();\r\n          });\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //退款Dialog的隐藏事件\r\n    hideRefundDialogEvent() {\r\n      this.$refs.refundForm.resetFields();\r\n      this.showRefundDialog = false;\r\n      console.log(\"hideRefundDialogEvent-------\");\r\n    },\r\n    //添加备注Dialog中确认btn的点击事件\r\n    sureRemarkDailogBtnClick(ref) {\r\n      this.$refs[ref].validate(valid => {\r\n        console.log(valid);\r\n        if (valid) {\r\n          this.request(\r\n            this.api.retailStore\r\n              .storeConsumerRefundMoney_updateStoreConsumerRefundMoney,\r\n            this.accountVO\r\n          ).then(res => {\r\n            this.hideRemarksDialogEvent();\r\n            this.getChannelReturnListData();\r\n          });\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    //添加备注Dialog的隐藏事件\r\n    hideRemarksDialogEvent() {\r\n      this.showRemarkDialog = false;\r\n      this.$refs.remarkForm.resetFields();\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.search_div {\r\n  margin: 0 10px;\r\n  padding-top: 20px;\r\n  background-color: #fff;\r\n  .first-input {\r\n    width: 300px;\r\n  }\r\n}\r\n.remark /deep/ .el-textarea__inner {\r\n  height: 100px;\r\n}\r\n.table_div {\r\n  margin: 10px;\r\n  background-color: #fff;\r\n  padding-top: 20px;\r\n  padding-left: 10px;\r\n}\r\n</style>\r\n\r\n\r\n\r\n"],"sourceRoot":"src/views/OS/store/other_bill"}]}