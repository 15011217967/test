{"remainingRequest":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\create\\release.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\src\\views\\content\\create\\release.vue","mtime":1574160264869},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\babel-loader\\lib\\index.js","mtime":1558492720858},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558492728398},{"path":"C:\\Users\\EDZ\\Desktop\\研发项目\\vue-project\\trunk\\node_modules\\vue-loader\\lib\\index.js","mtime":1558492728890}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\EDZ\\\\Desktop\\\\\\u7814\\u53D1\\u9879\\u76EE\\\\vue-project\\\\trunk\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Article from '@/views/content/create/components/Article';\nimport Atlas from '@/views/content/create/components/Atlas';\nimport Video from '@/views/content/create/components/Video';\nexport default {\n  name: 'release',\n  // 组件\n  components: {\n    'my-article': Article,\n    'my-atlas': Atlas,\n    'my-video': Video\n  },\n  // 数据\n  data: function data() {\n    return {\n      tabs: [{\n        type: '4',\n        name: 'myArticle'\n      }, {\n        type: '3',\n        name: 'myAtlas'\n      }, {\n        type: '2',\n        name: 'videoSmall'\n      }, {\n        type: '1',\n        name: 'video'\n      }],\n      // 提交表单\n      formData: {\n        // 类型\n        contentType: '',\n        // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\n        // 标题\n        title: '',\n        //副标题\n        smallTitle: '',\n        // 封面\n        coverList: [],\n        // 分类\n        contentCategory: [],\n        // 标签\n        tagList: [],\n        // 地狱\n        region: '',\n        regions: [],\n        // 商品链接\n        relationInfoList: [],\n        relationInfo: '',\n        // 是否草稿\n        contentStatus: '',\n        // 是否定时\n        isTime: 0,\n        // 定时时间\n        pubDate: '',\n        // 文章\n        // 富文本信息\n        article: {\n          content: ''\n        },\n        // 图集\n        atlasList: [],\n        // 视频\n        // 是否素材\n        libraryId: '',\n        videoInfoParams: {\n          info: null\n        },\n        mediaUrl: '',\n        fileId: ''\n      },\n      timeDialog: false,\n      rules: {\n        pubDate: [{\n          required: true,\n          message: '请选择发布时间',\n          trigger: 'blur'\n        }]\n      },\n      // 默认显示的tabs\n      activeName: '',\n      editId: null\n    };\n  },\n  created: function created() {\n    this.editId = this.$route.query.id;\n\n    if (this.editId) {\n      this.getDetails();\n    } else {\n      this.activeName = 'myArticle';\n      this.formData.contentType = '4';\n    }\n  },\n  // 初始化数据\n  mounted: function mounted() {\n    this.$nextTick(function () {});\n  },\n  // keepAlive 页面显示时\n  activated: function activated() {\n    this.getTableList();\n  },\n  // 方法\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.formDataInit();\n      /* this.$nextTick(()=>{\n        })*/\n\n      setTimeout(function () {\n        if (_this.$refs[_this.activeName]) {\n          _this.$refs[_this.activeName].init();\n        }\n      }, 0);\n    },\n    formDataInit: function formDataInit() {\n      // 初始化数据\n      this.formData = {\n        // 类型\n        contentType: this.formData.contentType,\n        // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\n        // 标题\n        title: '',\n        //副标题\n        smallTitle: '',\n        // 封面\n        coverList: [],\n        // 分类\n        contentCategory: [],\n        // 标签\n        tagList: [],\n        // 地狱\n        region: '',\n        regions: [],\n        // 商品链接\n        relationInfoList: [],\n        relationInfo: '',\n        // 是否草稿\n        contentStatus: '',\n        // 是否定时\n        isTime: 0,\n        // 定时时间\n        pubDate: '',\n        // 文章\n        // 富文本信息\n        article: {\n          content: ''\n        },\n        // 图集\n        atlasList: [],\n        // 视频\n        // 是否素材\n        libraryId: '',\n        videoInfoParams: {\n          info: null\n        },\n        mediaUrl: '',\n        fileId: ''\n      };\n    },\n    handleBeforeClick: function () {\n      var _handleBeforeClick = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(activeName, oldActiveName) {\n        var activeItem, flag;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(!oldActiveName || oldActiveName == '0')) {\n                  _context.next = 4;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", true);\n\n              case 4:\n                activeItem = this.tabs.find(function (item) {\n                  return activeName == item.name;\n                });\n\n                if (!this.editId) {\n                  _context.next = 21;\n                  break;\n                }\n\n                _context.next = 8;\n                return this.$confirm('点击确认视为放弃本次编辑，开始其他类型的发布', '切换', {\n                  confirmButtonText: '确认',\n                  cancelButtonText: '取消',\n                  showClose: false\n                });\n\n              case 8:\n                flag = _context.sent;\n\n                if (!flag) {\n                  _context.next = 18;\n                  break;\n                }\n\n                this.formData.id = null;\n                this.editId = null;\n                this.formData.contentType = activeItem.type;\n                this.$route.query.id = null;\n                this.init();\n                return _context.abrupt(\"return\", true);\n\n              case 18:\n                return _context.abrupt(\"return\", false);\n\n              case 19:\n                _context.next = 24;\n                break;\n\n              case 21:\n                this.formData.contentType = activeItem.type;\n                this.init();\n                return _context.abrupt(\"return\", true);\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function handleBeforeClick(_x, _x2) {\n        return _handleBeforeClick.apply(this, arguments);\n      }\n\n      return handleBeforeClick;\n    }(),\n    // 确认定时\n    timeDialogSub: function timeDialogSub() {\n      var _this2 = this;\n\n      this.$refs.pubDateForm.validate(function (valid) {\n        if (valid) {\n          _this2.formData.isTime = 1;\n\n          _this2.contentSave(true);\n        } else {\n          return false;\n        }\n      });\n    },\n    // 发布\n    contentSave: function contentSave(state) {\n      var _this3 = this;\n\n      if (!this.formData.title) {\n        this.$notify.error({\n          title: '错误',\n          message: '请输入标题'\n        });\n        return;\n      }\n\n      if (this.formData.title.length > 15) {\n        this.$notify.error({\n          title: '错误',\n          message: '标题过长，最大15位'\n        });\n        return;\n      }\n\n      if (this.formData.smallTitle.length && this.formData.smallTitle.length > 20) {\n        this.$notify.error({\n          title: '错误',\n          message: '副标题过长，最大20位'\n        });\n        return;\n      }\n\n      if (!this.formData.coverList.length) {\n        this.$notify.error({\n          title: '错误',\n          message: '请选择封面'\n        });\n        return;\n      }\n\n      if (!this.formData.contentCategory.length) {\n        this.$notify.error({\n          title: '错误',\n          message: '请选择分类'\n        });\n        return;\n      }\n\n      if (!this.formData.tagList.length) {\n        this.$notify.error({\n          title: '错误',\n          message: '请添加标签'\n        });\n        return;\n      }\n\n      switch (this.formData.contentType) {\n        // 发布文章\n        case '4':\n          var html = this.$refs.myArticle.$refs.editor.getEditorHtml();\n\n          if (html == '<p><br></p>') {\n            this.$notify.error({\n              title: '错误',\n              message: '请输入文章内容'\n            });\n            return;\n          }\n\n          this.formData.article.content = html;\n          break;\n        // 发布图集\n\n        case '3':\n          // 加 sort 后端排序\n          if (this.formData.atlasList && this.formData.atlasList.length) {\n            this.formData.atlasList.forEach(function (item, index) {\n              item.sort = ++index;\n            });\n          } else {\n            this.$notify.error({\n              title: '错误',\n              message: '请选择图片'\n            });\n            return;\n          }\n\n          break;\n        // 获取视频信息\n\n        case '2':\n          var infoVideo = this.formData.videoInfoParams.info;\n\n          if (!infoVideo.mediaUrl) {\n            this.$notify.error({\n              title: '错误',\n              message: '请选择视频'\n            });\n            return;\n          }\n\n          this.formData.mediaUrl = infoVideo.mediaUrl;\n\n          if (infoVideo.fileId) {\n            this.formData.fileId = infoVideo.fileId;\n            this.formData.libraryId = ''; // 如果本地后端存一次\n\n            this.request(this.api.contentCore.video_save, [infoVideo]).then(function (data) {}).catch(function (err) {});\n          } else {\n            this.formData.libraryId = infoVideo.libraryId;\n          }\n\n          break;\n\n        case '1':\n          var info = this.formData.videoInfoParams.info;\n\n          if (!info.mediaUrl) {\n            this.$notify.error({\n              title: '错误',\n              message: '请选择视频'\n            });\n            return;\n          }\n\n          this.formData.mediaUrl = info.mediaUrl;\n\n          if (info.fileId) {\n            this.formData.fileId = info.fileId;\n            this.formData.libraryId = ''; // 如果本地后端存一次\n\n            this.request(this.api.contentCore.video_save, [info]).then(function (data) {}).catch(function (err) {});\n          } else {\n            this.formData.libraryId = info.libraryId;\n          }\n\n          break;\n      } // 公共的处理参数\n      // 是否存草稿\n\n\n      if (!state) {\n        this.formData.contentStatus = '0';\n      } else {\n        this.formData.contentStatus = 1;\n      } // 分类转格式\n\n\n      var categoryAry = this.formData.contentCategory[this.formData.contentCategory.length - 1].split('&');\n      this.formData.contentCategoryId = categoryAry[0];\n      this.formData.cIdentifier = categoryAry[1];\n      this.formData.showIdentifier = this.formData.contentCategory.join('$'); // 地域格式转换\n\n      this.formData.region = this.formData.regions.join('$'); // 关联商品转换\n\n      if (this.formData.relationInfoList && this.formData.relationInfoList.length) {\n        this.formData.relationInfo = JSON.stringify(this.formData.relationInfoList);\n      } // 请求\n\n\n      var url = this.api.contentCore.content_save;\n\n      if (this.formData.id) {\n        url = this.api.contentCore.content_edit;\n      }\n\n      this.request(url, this.formData).then(function (data) {\n        if (_this3.editId) {\n          _this3.$notify.success({\n            title: '成功',\n            message: '修改成功'\n          });\n        } else {\n          if (_this3.timeDialog) {\n            _this3.$notify.success({\n              title: '成功',\n              message: '发布成功'\n            });\n\n            _this3.timeDialog = false;\n          } else if (_this3.formData.contentStatus === '0') {\n            _this3.$notify.success({\n              title: '成功',\n              message: '草稿保存成功'\n            });\n          } else {\n            _this3.$notify.success({\n              title: '成功',\n              message: '发布成功'\n            });\n          }\n        }\n\n        _this3.init();\n\n        _this3.$router.push({\n          path: '/content/manage/content_manage'\n        });\n      });\n    },\n    // 获取详情\n    getDetails: function getDetails() {\n      var _this4 = this;\n\n      this.request(this.api.contentCore.content_get, {\n        id: this.editId\n      }).then(function (data) {\n        var activeItem = _this4.tabs.find(function (item) {\n          return data.contentType == item.type;\n        });\n\n        _this4.activeName = activeItem.name;\n        var contentCategory, regions, relationInfoList; // 初始分类\n\n        if (data.showIdentifier.indexOf('$') > -1) {\n          contentCategory = data.showIdentifier.split('$');\n        } else {\n          contentCategory = [data.showIdentifier];\n        } // 初始区域\n\n\n        if (data.region.indexOf('$') > -1) {\n          regions = data.region.split('$');\n        } else if (regions) {\n          regions = [data.region];\n        } else {\n          regions = [];\n        } // 初始关联列表\n\n\n        if (data.relationInfo.length) {\n          relationInfoList = JSON.parse(data.relationInfo);\n        } else {\n          relationInfoList = [];\n        }\n\n        _this4.formData = {\n          id: _this4.editId,\n          contentType: data.contentType.toString(),\n          // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\n          // 标题\n          title: data.title,\n          //副标题\n          smallTitle: data.smallTitle,\n          // 封面\n          coverList: data.coverList,\n          // 分类\n          contentCategory: contentCategory,\n          // 标签\n          tagList: data.tagList,\n          // 地域\n          region: '',\n          regions: regions,\n          relationInfoList: relationInfoList,\n          relationInfo: '',\n          // 是否草稿\n          contentStatus: '',\n          // 是否定时\n          isTime: 0,\n          // 定时时间\n          pubDate: '',\n          // 文章\n          // 富文本信息\n          article: {\n            content: ''\n          },\n          // 图集\n          atlasList: [],\n          // 视频\n          // 是否素材\n          libraryId: data.libraryId,\n          videoInfoParams: {},\n          mediaUrl: '',\n          fileId: '' // 标签表结构修改 新加字段判断 新字段 tagList(Array)    旧字段  tags(String)\n\n          /*if(data.tagList && data.tagList.length){\n            this.formData.tagList = data.tagList\n          }else{\n            if(data.tags){\n              if(data.tags.indexOf('$') > -1){\n                this.formData.tagList = data.tags.split('$').map(item => {\n                  return {\n                    name: item\n                  }\n                })\n              }else{\n                this.formData.tagList = [{\n                  name: data.tags\n                }]\n              }\n            }else {\n              this.formData.tagList = []\n            }\n          }*/\n\n        };\n\n        switch (data.contentType) {\n          // 发布文章\n          case 4:\n            var html = data.articleDomain.content;\n            setTimeout(function () {\n              _this4.$refs.myArticle.$refs.editor.setEditorHtml(html);\n            }, 0);\n            _this4.formData.article.sourceId = data.articleDomain.sourceId;\n            _this4.formData.article.id = data.articleDomain.id;\n            break;\n          // 发布图集\n\n          case 3:\n            _this4.formData.atlasList = data.atlasList;\n            break;\n          // 获取视频信息\n\n          case 2:\n            _this4.formData.videoInfoParams.info = {\n              mediaUrl: data.mediaUrl,\n              libraryId: data.libraryId\n            };\n            break;\n\n          case 1:\n            _this4.formData.videoInfoParams.info = {\n              mediaUrl: data.mediaUrl,\n              libraryId: data.libraryId\n            };\n            break;\n        }\n      });\n    }\n  },\n  // 计算属性\n  computed: {},\n  // 监听数据变化\n  watch: {\n    '$route': {\n      handler: function handler(val, oldVal) {\n        if (val.path === oldVal.path) {\n          this.init();\n          this.editId = null;\n          this.activeName = 'myArticle';\n          this.formData.contentType = '4';\n        }\n      },\n      deep: true\n    }\n  }\n};",{"version":3,"sources":["release.vue"],"names":[],"mappings":"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","sourcesContent":["<style lang=\"less\" scoped>\r\n  @import \"../style/contentPublic.less\";\r\n  .release{\r\n    .tabs{background: #fff;\r\n      width: 100%;\r\n    }\r\n    .footer-btns{background: #fff;padding: 10px 20px;\r\n      div{float: right;}\r\n    }\r\n  }\r\n</style>\r\n<template>\r\n  <div class=\"release page-public\">\r\n    <div class=\"page-main item-margin\">\r\n      <div class=\"page-main-inner\">\r\n        <el-tabs v-model=\"activeName\" class=\"tabs\" :before-leave=\"handleBeforeClick\" type=\"card\">\r\n          <el-tab-pane label=\"发布文章\" name=\"myArticle\" contentType=\"4\">\r\n            <my-article :form-data=\"formData\" ref=\"myArticle\" v-if=\"activeName == 'myArticle'\"></my-article>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"发布图集\" name=\"myAtlas\" contentType=\"3\">\r\n            <my-atlas :form-data=\"formData\" ref=\"myAtlas\" v-if=\"activeName == 'myAtlas'\"></my-atlas>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"发布小视频\" name=\"videoSmall\" contentType=\"2\">\r\n            <my-video  :form-data=\"formData\" ref=\"videoSmall\"  v-if=\"activeName == 'videoSmall'\"></my-video>\r\n<!--            <my-small-video :formData=\"formData\" ref=\"videoSmall\" v-if=\"activeName == 'videoSmall'\"></my-small-video>-->\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"发布视频\" name=\"video\" contentType=\"1\" ref=\"video\">\r\n            <my-video  :form-data=\"formData\" ref=\"video\"  v-if=\"activeName == 'video'\"></my-video>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n    </div>\r\n    <div class=\"footer-btns clearfix item-margin\">\r\n      <div>\r\n        <el-button type=\"primary\" size=\"small\" @click=\"contentSave(true)\">发布</el-button>\r\n        <el-button size=\"small\" @click=\"contentSave(false)\">存草稿</el-button>\r\n        <el-button size=\"small\" @click=\"timeDialog = true\">定时发布</el-button>\r\n        <el-button size=\"small\">预览</el-button>\r\n      </div>\r\n    </div>\r\n    <!--定时弹窗-->\r\n    <el-dialog title=\"添加定时\" :visible.sync=\"timeDialog\" width=\"40%\" :close-on-click-modal=\"false\">\r\n      <el-form :model=\"formData\" :rules=\"rules\" ref=\"pubDateForm\" label-width=\"130px\" class=\"demo-ruleForm\">\r\n        <el-form-item label=\"选择发布时间\" prop=\"pubDate\">\r\n          <el-date-picker v-model=\"formData.pubDate\" type=\"datetime\" placeholder=\"选择日期时间\" size=\"small\"></el-date-picker>\r\n        </el-form-item>\r\n      </el-form>\r\n      <p v-show=\"formData.pubDate\">本内容将于{{ formData.pubDate | timestampToTime }} 发表</p>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"timeDialog = false\" size=\"small\">取 消</el-button>\r\n        <el-button @click=\"timeDialogSub\" type=\"primary\" size=\"small\">确定并发布</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\n  import Article from '@/views/content/create/components/Article'\r\n  import Atlas from '@/views/content/create/components/Atlas'\r\n  import Video from '@/views/content/create/components/Video'\r\n  export default {\r\n    name: 'release',\r\n    // 组件\r\n    components: {\r\n      'my-article': Article,\r\n      'my-atlas': Atlas,\r\n      'my-video': Video\r\n    },\r\n    // 数据\r\n    data() {\r\n      return {\r\n        tabs: [\r\n          {type: '4', name: 'myArticle'},\r\n          {type: '3', name: 'myAtlas'},\r\n          {type: '2', name: 'videoSmall'},\r\n          {type: '1', name: 'video'}\r\n        ],\r\n        // 提交表单\r\n        formData: {\r\n          // 类型\r\n          contentType: '',     // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\r\n          // 标题\r\n          title: '',\r\n          //副标题\r\n          smallTitle: '',\r\n          // 封面\r\n          coverList: [],\r\n          // 分类\r\n          contentCategory:[],\r\n          // 标签\r\n          tagList: [],\r\n          // 地狱\r\n          region: '',\r\n          regions: [],\r\n          // 商品链接\r\n          relationInfoList:[],\r\n          relationInfo: '',\r\n          // 是否草稿\r\n          contentStatus: '',\r\n          // 是否定时\r\n          isTime: 0,\r\n          // 定时时间\r\n          pubDate: '',\r\n\r\n          // 文章\r\n          // 富文本信息\r\n          article: {\r\n            content:''\r\n          },\r\n\r\n          // 图集\r\n          atlasList: [],\r\n\r\n          // 视频\r\n          // 是否素材\r\n          libraryId: '',\r\n          videoInfoParams:{\r\n            info: null\r\n          },\r\n          mediaUrl: '',\r\n          fileId: ''\r\n        },\r\n        timeDialog: false,\r\n        rules: {\r\n          pubDate: [\r\n            {required: true, message: '请选择发布时间', trigger: 'blur'}\r\n          ]\r\n        },\r\n\r\n        // 默认显示的tabs\r\n        activeName: '',\r\n        editId: null\r\n      }\r\n    },\r\n    created(){\r\n      this.editId =  this.$route.query.id\r\n      if(this.editId){\r\n        this.getDetails()\r\n      }else{\r\n        this.activeName = 'myArticle'\r\n        this.formData.contentType = '4'\r\n      }\r\n    },\r\n    // 初始化数据\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n\r\n      })\r\n    },\r\n    // keepAlive 页面显示时\r\n    activated() {\r\n      this.getTableList();\r\n    },\r\n    // 方法\r\n    methods: {\r\n      init(){\r\n        this.formDataInit()\r\n       /* this.$nextTick(()=>{\r\n\r\n        })*/\r\n       setTimeout(()=>{\r\n         if(this.$refs[this.activeName]){\r\n           this.$refs[this.activeName].init()\r\n         }\r\n       },0)\r\n      },\r\n      formDataInit(){\r\n        // 初始化数据\r\n        this.formData = {\r\n          // 类型\r\n          contentType: this.formData.contentType,     // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\r\n          // 标题\r\n          title: '',\r\n          //副标题\r\n          smallTitle: '',\r\n          // 封面\r\n          coverList: [],\r\n          // 分类\r\n          contentCategory:[],\r\n          // 标签\r\n          tagList: [],\r\n          // 地狱\r\n          region: '',\r\n          regions: [],\r\n          // 商品链接\r\n          relationInfoList:[],\r\n          relationInfo: '',\r\n          // 是否草稿\r\n          contentStatus: '',\r\n          // 是否定时\r\n          isTime: 0,\r\n          // 定时时间\r\n          pubDate: '',\r\n          // 文章\r\n          // 富文本信息\r\n          article: {\r\n            content:''\r\n          },\r\n          // 图集\r\n          atlasList: [],\r\n          // 视频\r\n          // 是否素材\r\n          libraryId: '',\r\n          videoInfoParams:{\r\n            info: null\r\n          },\r\n          mediaUrl: '',\r\n          fileId: ''\r\n        }\r\n      },\r\n      async handleBeforeClick(activeName, oldActiveName){\r\n        if(!oldActiveName || oldActiveName == '0'){\r\n          return true\r\n        }else{\r\n          let activeItem = this.tabs.find(item => {\r\n            return activeName == item.name\r\n          })\r\n          if(this.editId){\r\n            const flag = await this.$confirm('点击确认视为放弃本次编辑，开始其他类型的发布', '切换', {\r\n              confirmButtonText: '确认',\r\n              cancelButtonText: '取消',\r\n              showClose:false\r\n            });\r\n            if(flag){\r\n              this.formData.id = null\r\n              this.editId = null\r\n              this.formData.contentType = activeItem.type\r\n              this.$route.query.id = null\r\n              this.init()\r\n              return true\r\n            }else{\r\n              return false\r\n            }\r\n          }else{\r\n            this.formData.contentType = activeItem.type\r\n            this.init()\r\n            return true\r\n          }\r\n        }\r\n      },\r\n      // 确认定时\r\n      timeDialogSub(){\r\n        this.$refs.pubDateForm.validate((valid) => {\r\n          if (valid) {\r\n            this.formData.isTime = 1\r\n            this.contentSave(true);\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      // 发布\r\n      contentSave(state){\r\n        if(!this.formData.title){\r\n          this.$notify.error({ title: '错误',message: '请输入标题'})\r\n          return\r\n        }\r\n        if(this.formData.title.length > 15){\r\n          this.$notify.error({ title: '错误',message: '标题过长，最大15位'})\r\n          return\r\n        }\r\n        if(this.formData.smallTitle.length && this.formData.smallTitle.length > 20){\r\n          this.$notify.error({ title: '错误',message: '副标题过长，最大20位'})\r\n          return\r\n        }\r\n        if(!this.formData.coverList.length){\r\n          this.$notify.error({ title: '错误',message: '请选择封面'})\r\n          return\r\n        }\r\n        if(!this.formData.contentCategory.length){\r\n          this.$notify.error({ title: '错误',message: '请选择分类'})\r\n          return\r\n        }\r\n        if(!this.formData.tagList.length){\r\n          this.$notify.error({ title: '错误',message: '请添加标签'})\r\n          return\r\n        }\r\n        switch(this.formData.contentType) {\r\n          // 发布文章\r\n          case '4':\r\n            let html = this.$refs.myArticle.$refs.editor.getEditorHtml()\r\n            if(html == '<p><br></p>'){\r\n              this.$notify.error({ title: '错误',message: '请输入文章内容'})\r\n              return;\r\n            }\r\n            this.formData.article.content = html\r\n            break;\r\n          // 发布图集\r\n          case '3':\r\n            // 加 sort 后端排序\r\n            if(this.formData.atlasList && this.formData.atlasList.length){\r\n              this.formData.atlasList.forEach((item, index) => {\r\n                item.sort = ++index\r\n              })\r\n            }else {\r\n              this.$notify.error({ title: '错误',message: '请选择图片'})\r\n              return;\r\n            }\r\n            break;\r\n          // 获取视频信息\r\n          case '2':\r\n            let infoVideo = this.formData.videoInfoParams.info\r\n            if(!infoVideo.mediaUrl){\r\n              this.$notify.error({ title: '错误',message: '请选择视频'})\r\n              return;\r\n            }\r\n            this.formData.mediaUrl = infoVideo.mediaUrl\r\n            if(infoVideo.fileId){\r\n              this.formData.fileId = infoVideo.fileId\r\n              this.formData.libraryId = ''\r\n              // 如果本地后端存一次\r\n              this.request(this.api.contentCore.video_save, [infoVideo]).then(data => {\r\n\r\n              }).catch(err => {\r\n              });\r\n            }else {\r\n              this.formData.libraryId = infoVideo.libraryId\r\n            }\r\n            break;\r\n          case '1':\r\n            let info = this.formData.videoInfoParams.info\r\n            if(!info.mediaUrl){\r\n              this.$notify.error({ title: '错误',message: '请选择视频'})\r\n              return;\r\n            }\r\n            this.formData.mediaUrl = info.mediaUrl\r\n            if(info.fileId){\r\n              this.formData.fileId = info.fileId\r\n              this.formData.libraryId = ''\r\n              // 如果本地后端存一次\r\n              this.request(this.api.contentCore.video_save, [info]).then(data => {\r\n\r\n              }).catch(err => {\r\n\r\n              });\r\n            }else {\r\n              this.formData.libraryId = info.libraryId\r\n            }\r\n            break;\r\n        }\r\n        // 公共的处理参数\r\n        // 是否存草稿\r\n        if(!state){\r\n          this.formData.contentStatus = '0'\r\n        }else{\r\n          this.formData.contentStatus = 1\r\n        }\r\n        // 分类转格式\r\n        const categoryAry = this.formData.contentCategory[this.formData.contentCategory.length-1].split('&')\r\n        this.formData.contentCategoryId = categoryAry[0]\r\n        this.formData.cIdentifier = categoryAry[1]\r\n        this.formData.showIdentifier = this.formData.contentCategory.join('$')\r\n        // 地域格式转换\r\n        this.formData.region = this.formData.regions.join('$')\r\n        // 关联商品转换\r\n        if(this.formData.relationInfoList && this.formData.relationInfoList.length){\r\n          this.formData.relationInfo = JSON.stringify(this.formData.relationInfoList)\r\n        }\r\n        // 请求\r\n        let url = this.api.contentCore.content_save\r\n        if(this.formData.id){\r\n          url = this.api.contentCore.content_edit\r\n        }\r\n        this.request(url, this.formData).then(data => {\r\n          if(this.editId){\r\n            this.$notify.success({ title: '成功',message: '修改成功'})\r\n          }else{\r\n            if(this.timeDialog){\r\n              this.$notify.success({ title: '成功',message: '发布成功'})\r\n              this.timeDialog = false\r\n            }else if(this.formData.contentStatus === '0'){\r\n              this.$notify.success({ title: '成功',message: '草稿保存成功'})\r\n            }else{\r\n              this.$notify.success({ title: '成功',message: '发布成功'})\r\n            }\r\n          }\r\n          this.init()\r\n          this.$router.push({\r\n            path:'/content/manage/content_manage'\r\n          });\r\n        });\r\n      },\r\n      // 获取详情\r\n      getDetails(){\r\n        this.request(this.api.contentCore.content_get, {id: this.editId}).then(data => {\r\n          let activeItem = this.tabs.find(item => {\r\n            return data.contentType == item.type\r\n          })\r\n          this.activeName = activeItem.name\r\n          let contentCategory,regions,relationInfoList\r\n          // 初始分类\r\n          if(data.showIdentifier.indexOf('$') > -1){\r\n            contentCategory = data.showIdentifier.split('$')\r\n          }else {\r\n            contentCategory = [data.showIdentifier]\r\n          }\r\n          // 初始区域\r\n          if(data.region.indexOf('$') > -1){\r\n            regions = data.region.split('$')\r\n          }else if(regions){\r\n            regions = [data.region]\r\n          }else {\r\n            regions = []\r\n          }\r\n          // 初始关联列表\r\n          if(data.relationInfo.length){\r\n            relationInfoList = JSON.parse(data.relationInfo)\r\n          }else {\r\n            relationInfoList = []\r\n          }\r\n          this.formData = {\r\n            id: this.editId,\r\n            contentType: data.contentType.toString(),     // 4 文章发布  3 图集发布   2 小视频发布  1 视频发布\r\n            // 标题\r\n            title: data.title,\r\n            //副标题\r\n            smallTitle: data.smallTitle,\r\n            // 封面\r\n            coverList: data.coverList,\r\n            // 分类\r\n            contentCategory: contentCategory,\r\n            // 标签\r\n            tagList: data.tagList,\r\n            // 地域\r\n            region: '',\r\n            regions: regions,\r\n            relationInfoList:relationInfoList,\r\n            relationInfo: '',\r\n            // 是否草稿\r\n            contentStatus: '',\r\n            // 是否定时\r\n            isTime: 0,\r\n            // 定时时间\r\n            pubDate: '',\r\n            // 文章\r\n            // 富文本信息\r\n            article: {\r\n              content: ''\r\n            },\r\n            // 图集\r\n            atlasList: [],\r\n            // 视频\r\n            // 是否素材\r\n            libraryId: data.libraryId,\r\n            videoInfoParams: {},\r\n            mediaUrl: '',\r\n            fileId: ''\r\n          }\r\n          // 标签表结构修改 新加字段判断 新字段 tagList(Array)    旧字段  tags(String)\r\n          /*if(data.tagList && data.tagList.length){\r\n            this.formData.tagList = data.tagList\r\n          }else{\r\n            if(data.tags){\r\n              if(data.tags.indexOf('$') > -1){\r\n                this.formData.tagList = data.tags.split('$').map(item => {\r\n                  return {\r\n                    name: item\r\n                  }\r\n                })\r\n              }else{\r\n                this.formData.tagList = [{\r\n                  name: data.tags\r\n                }]\r\n              }\r\n            }else {\r\n              this.formData.tagList = []\r\n            }\r\n          }*/\r\n          switch(data.contentType) {\r\n            // 发布文章\r\n            case 4:\r\n              let html = data.articleDomain.content\r\n              setTimeout(()=>{\r\n                this.$refs.myArticle.$refs.editor.setEditorHtml(html)\r\n              },0)\r\n              this.formData.article.sourceId = data.articleDomain.sourceId\r\n              this.formData.article.id = data.articleDomain.id\r\n              break;\r\n            // 发布图集\r\n            case 3:\r\n              this.formData.atlasList = data.atlasList\r\n              break;\r\n            // 获取视频信息\r\n            case 2:\r\n              this.formData.videoInfoParams.info = {\r\n                mediaUrl: data.mediaUrl,\r\n                libraryId: data.libraryId\r\n              }\r\n              break;\r\n            case 1:\r\n              this.formData.videoInfoParams.info = {\r\n                mediaUrl: data.mediaUrl,\r\n                libraryId: data.libraryId\r\n              }\r\n              break;\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 计算属性\r\n    computed: {},\r\n    // 监听数据变化\r\n    watch: {\r\n      '$route':{\r\n        handler: function (val, oldVal) {\r\n          if(val.path === oldVal.path){\r\n            this.init()\r\n            this.editId = null\r\n            this.activeName = 'myArticle'\r\n            this.formData.contentType = '4'\r\n          }\r\n        },\r\n        deep: true\r\n      }\r\n    }\r\n  }\r\n</script>\r\n"],"sourceRoot":"src/views/content/create"}]}